
<!DOCTYPE html>

<html lang="zh-tw">
<head>
<meta charset="utf-8"/>
<meta charset="utf-8" content="text/html" http-equiv="Content-Type">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/>
<title>Python Table Manners - 程式碼風格 </title>
<meta content="True" name="HandheldFriendly"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="origin" name="referrer"/>
<meta content="Pelican" name="generator"/>
<link href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-coding-style" rel="canonical"/>
<!-- Feed -->
<link href="https://blog.wei-lee.me/feeds/all.atom.xml" rel="alternate" title="Those aren't written down are meant to be forgotten Full Atom Feed" type="application/atom+xml"/>
<!-- TODO: combine -->
<link href="https://blog.wei-lee.me/theme/css/style.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/pygments.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/pagefind-ui-custom.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/code.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/code-copy.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/custom.css" rel="stylesheet" type="text/css"/>
<link href="/pagefind/pagefind-ui.css" rel="stylesheet"/>
<!-- Custom fonts -->
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,300" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css"/>
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
<script>
    var siteUrl = 'https://blog.wei-lee.me';
  </script>
<script>
    var localTheme = localStorage.getItem('attila_theme');
    switch (localTheme) {
      case 'dark':
        document.documentElement.classList.add('theme-dark');
        break;
      case 'light':
        document.documentElement.classList.add('theme-light');
        break;
      default:
        break;
    }
  </script>
<meta content="接下來要介紹的是 linters 它們是用來檢查程式是否符合特定程式碼風格的一類工具 以 Python 來說，則可能是判斷有沒有遵守 PEP 8 linter 除了能檢查是否不符風格，通常也能用來檢查語法錯誤" name="description"/>
<meta content="Wei Lee" name="author"/>
<meta content="Python" name="tags"/>
<meta content="Code Quality" name="tags"/>
<!-- Open Graph -->
<meta content="Those aren't written down are meant to be forgotten" prefix="og: http://ogp.me/ns#" property="og:site_name">
<meta content="Python Table Manners - 程式碼風格 " prefix="og: http://ogp.me/ns#" property="og:title">
<meta content="接下來要介紹的是 linters 它們是用來檢查程式是否符合特定程式碼風格的一類工具 以 Python 來說，則可能是判斷有沒有遵守 PEP 8 linter 除了能檢查是否不符風格，通常也能用來檢查語法錯誤" prefix="og: http://ogp.me/ns#" property="og:description">
<meta content="zh-tw" prefix="og: http://ogp.me/ns#" property="og:locale">
<meta content="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-coding-style" prefix="og: http://ogp.me/ns#" property="og:url"/>
<meta content="article" prefix="og: http://ogp.me/ns#" property="og:type"/>
<meta content="2020-02-26 18:39:00+08:00" prefix="og: http://ogp.me/ns#" property="article:published_time"/>
<meta content="2020-10-04 15:57:00+08:00" prefix="og: http://ogp.me/ns#" property="article:modified_time"/>
<meta content="https://blog.wei-lee.me/author/wei-lee.html" prefix="og: http://ogp.me/ns#" property="article:author"/>
<meta content="Tech" prefix="og: http://ogp.me/ns#" property="article:section">
<meta content="Python" prefix="og: http://ogp.me/ns#" property="article:tag"/>
<meta content="Code Quality" prefix="og: http://ogp.me/ns#" property="article:tag"/>
<meta content="https://blog.wei-lee.me/images/cover.jpeg" prefix="og: http://ogp.me/ns#" property="og:image"/>
<!-- Twitter Card -->
<meta content="summary_large_image" name="twitter:card"/>
<meta content="@clleew" name="twitter:site"/>
<meta content="Python Table Manners - 程式碼風格 " name="twitter:title"/>
<meta content="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-coding-style" name="twitter:url"/>
<meta content="https://blog.wei-lee.me/images/cover.jpeg" name="twitter:image:src"/>
<meta content="接下來要介紹的是 linters 它們是用來檢查程式是否符合特定程式碼風格的一類工具 以 Python 來說，則可能是判斷有沒有遵守 PEP 8 linter 除了能檢查是否不符風格，通常也能用來檢查語法錯誤" name="twitter:description"/>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "Python Table Manners - 程式碼風格",
  "headline": "Python Table Manners - 程式碼風格",
  "datePublished": "2020-02-26 18:39:00+08:00",
  "dateModified": "2020-10-04 15:57:00+08:00",
  "author": {
    "@type": "Person",
    "name": "Wei Lee",
    "url": "https://blog.wei-lee.me/author/wei-lee.html"
  },
  "image": "https://blog.wei-lee.me//images/cover.jpeg",
  "url": "https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-coding-style",
  "description": "接下來要介紹的是 linters 它們是用來檢查程式是否符合特定程式碼風格的一類工具 以 Python 來說，則可能是判斷有沒有遵守 PEP 8 linter 除了能檢查是否不符風格，通常也能用來檢查語法錯誤"
}
</script>
</meta></meta></meta></meta></meta></link></meta><link href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-coding-style" rel="canonical"/><script type="application/ld+json">{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "Those aren't written down are meant to be forgotten", "item": "https://blog.wei-lee.me"}, {"@type": "ListItem", "position": 2, "name": "Posts", "item": "https://blog.wei-lee.me/posts"}, {"@type": "ListItem", "position": 3, "name": "Tech", "item": "https://blog.wei-lee.me/posts/tech"}, {"@type": "ListItem", "position": 4, "name": "2020", "item": "https://blog.wei-lee.me/posts/tech/2020"}, {"@type": "ListItem", "position": 5, "name": "02", "item": "https://blog.wei-lee.me/posts/tech/2020/02"}, {"@type": "ListItem", "position": 6, "name": "Python table manners coding style", "item": "https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-coding-style"}, {"@type": "ListItem", "position": 7, "name": "Index", "item": "https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-coding-style/index.html"}]}</script><script type="application/ld+json">{"@context": "https://schema.org", "@type": "Article", "author": {"@type": "Person", "name": "Wei Lee"}, "publisher": {"@type": "Organization", "name": "Those aren't written down are meant to be forgotten"}, "headline": "Python Table Manners - 程式碼風格", "about": "Tech", "datePublished": "2020-02-26 18:39"}</script><meta content="summary" name="twitter:card"/><meta content="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-coding-style" property="og:url"/><meta content="article" property="og:type"/><meta content="Python Table Manners - 程式碼風格" property="og:title"/><meta content="C" property="og:locale"/></head>
<body class="category-template">
<div class="nav-header">
<nav aria-label="Main" class="nav-wrapper">
<ul>
<li class="nav-🏠 Home" role="presentation"><a href="/"><span>🏠 Home</span></a></li>
<li class="nav-About Me" role="presentation"><a href="/pages/about-me.html"><span>About Me</span></a></li>
<li class="nav-👨‍💻 Tech active" role="presentation"><a href="/category/tech.html"><span>👨‍💻 Tech</span></a></li>
<li class="nav-📚 Book Digest" role="presentation"><a href="/category/book.html"><span>📚 Book Digest</span></a></li>
<li class="nav-💬 Gossiping" role="presentation"><a href="/category/gossiping.html"><span>💬 Gossiping</span></a></li>
<li class="nav-🏷️ Tags" role="presentation"><a href="/tags.html"><span>🏷️ Tags</span></a></li>
<li class="nav-🗄️ Archives" role="presentation"><a href="/archives.html"><span>🗄️ Archives</span></a></li>
<li class="nav-📚 Series" role="presentation"><a href="/series_list.html"><span>📚 Series</span></a></li>
<li class="nav-🔍 Search" role="presentation"><a href="/search.html"><span>🔍 Search</span></a></li>
</ul>
<ul class="nav-meta">
<li class="nav-linkedin"><a aria-label="Linkedin" href="https://tw.linkedin.com/in/clleew" target="_blank"><i aria-hidden="true" class="icon icon-linkedin"></i>
<span>Linkedin</span>
</a></li>
<li class="nav-github"><a aria-label="Github" href="https://github.com/Lee-W" target="_blank"><i aria-hidden="true" class="icon icon-github"></i>
<span>GitHub</span>
</a></li>
<li class="nav-twitter"><a aria-label="Twitter" href="https://twitter.com/clleew" target="_blank"><i aria-hidden="true" class="icon icon-twitter"></i>
<span>Twitter</span>
</a></li>
<li class="nav-search" style="display: none;">
<a title="Search">
<i aria-hidden="true" class="icon icon-search"></i>
<span>Search</span>
</a>
</li>
</ul> </nav>
<div class="nav-wrapper-control">
<div class="inner">
<a class="nav-menu" role="button"><i aria-hidden="true" class="icon icon-menu"></i>Menu</a>
<a class="nav-search" role="button" style="display: none;" title="Search"><i aria-hidden="true" class="icon icon-search"></i></a>
</div>
</div>
</div>
<div aria-label="Close" class="nav-close" role="button"></div>
<section class="page-wrapper" id="wrapper">
<!-- Progressbar -->
<div class="progress-container">
<span class="progress-bar"></span>
</div>
<!-- Page Header -->
<!-- Set your background image for this header on the line below. -->
<header class="post-header has-cover">
<div class="inner">
<span class="post-info">
<span class="post-type">Article</span>
<span class="post-count">Tech</span>
</span>
<h1 class="post-title">
            Python Table Manners - 程式碼風格
        </h1>
<div class="post-meta">
<div class="post-meta-avatars">
<figure class="post-meta-avatar avatar">
<a class="author-avatar" href="https://blog.wei-lee.me/author/wei-lee.html">
<img alt="Wei Lee" class="author-profile-image" src="https://blog.wei-lee.me//images/avatar.jpeg"/>
</a>
</figure>
</div>
<h4 class="post-meta-author">
            Wei Lee
          </h4>
<time datetime="2020/02/26 - Wed">2020/02/26 - Wed</time>
          • <time datetime="2020/10/04 - Sun"> Updated on 2020/10/04 - Sun</time>
          • 4 min read
        </div>
<div class="post-cover cover">
<img alt="Category Tech" src="https://blog.wei-lee.me/images/cover.jpeg"/>
</div>
</div>
</header>
<!-- Post content -->
<main class="content" data-pagefind-body="" role="main">
<article class="post">
<div class="inner">
<section class="post-content">
<p>接下來要介紹的是 linters<br/>
它們是用來檢查程式是否符合特定程式碼風格的一類工具<br/>
以 Python 來說，則可能是判斷有沒有遵守 <a href="https://www.python.org/dev/peps/pep-0008/">PEP 8</a><br/>
linter 除了能檢查是否不符風格，通常也能用來檢查語法錯誤</p>
<!--more-->
<div class="toc">
<ul>
<li><a href="#-flake8">風格檢查 - flake8</a><ul>
<li><a href="#_1">使用</a></li>
<li><a href="#_2">設定</a></li>
<li><a href="#_3">局部跳過檢查</a></li>
</ul>
</li>
<li><a href="#-pylint">風格檢查 - pylint</a><ul>
<li><a href="#_4">使用</a></li>
<li><a href="#_5">設定</a></li>
<li><a href="#_6">局部跳過檢查</a></li>
</ul>
</li>
<li><a href="#flake8-vs-pylint">flake8 v.s. pylint</a></li>
<li><a href="#-mypy">型別檢查 - mypy</a><ul>
<li><a href="#_7">使用</a></li>
<li><a href="#_8">設定</a></li>
</ul>
</li>
<li><a href="#-black">自動排版 - black</a><ul>
<li><a href="#_9">使用</a></li>
<li><a href="#_10">設定</a></li>
</ul>
</li>
<li><a href="#-isort">排序函式庫 - isort</a><ul>
<li><a href="#_11">執行</a></li>
<li><a href="#_12">設定</a></li>
</ul>
</li>
<li><a href="#_13">其他工具</a></li>
<li><a href="#bonus">Bonus: 設定檔的選用</a></li>
<li><a href="#reference">Reference</a></li>
</ul>
</div>
<h2 id="-flake8">風格檢查 - flake8</h2>
<p><a href="https://flake8.pycqa.org/en/latest/">flake8</a> 是 Python 最常被使用的 linter 之一<br/>
幾乎是所有 Python 開源專案的標準配備</p>
<h3 id="_1">使用</h3>
<p>以下面這段程式碼為例</p>
<!-- blacken-docs:off -->
<div class="highlight"><pre><span></span><code><span class="c1"># bad_code.py</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">os</span> <span class="o">=</span>  <span class="s2">"My Operating system"</span>
</code></pre></div>
<!-- blacken-docs:on -->
<p>這段程式碼出現了兩個問題</p>
<ul>
<li>把模組 <code>os</code> 指派成一個字串，會導致無法使用 <code>os</code> 模組內的函式（因為 <code>os</code> 已經變成一個字串）</li>
<li><code>os</code> 的 <code>=</code> 後面加上兩個空白是不必要的，不符合 PEP 8 的規範</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 安裝 flake8</span>
pipenv<span class="w"> </span>install<span class="w"> </span>flake8<span class="w"> </span>--dev

<span class="c1"># 執行 flake8</span>
pipenv<span class="w"> </span>run<span class="w"> </span>flake8
</code></pre></div>
<p>flake8 預設對當前目錄下所有 Python 的檔案做檢查</p>
<p>執行後，<code>flake8</code> 會將這些錯誤找出來</p>
<div class="highlight"><pre><span></span><code>./bad_code.py:4:1: F811 redefinition of unused 'os' from line 1
./bad_code.py:4:5: E222 multiple spaces after operator
</code></pre></div>
<p>透過錯誤碼（e.g., <code>F811</code>）可以在 <a href="https://www.flake8rules.com/">flake8 rules</a> 找到為什麼這是個錯誤和怎麼修正比較好</p>
<h3 id="_2">設定</h3>
<p>某些狀況下，我們會不完全依照 flake8 的風格<br/>
例如 <a href="https://www.python.org/dev/peps/pep-0008/">PEP 8</a> 的每行只能有 79 個字元，已經越來越不被使用</p>
<p>除了可以直接在 <code>flake8</code> 指令後面加上參數<br/>
也可以直接寫入設定檔 <code>setup.cfg</code> (或 <code>.flake8</code>, <code>tox.ini</code>）<br/>
以下是我所使用的設定</p>
<div class="highlight"><pre><span></span><code><span class="k">[flake8]</span>
<span class="na">ignore</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="c1"># F632: use ==/!= to compare str, bytes, and int literals</span>
<span class="w">    </span><span class="na">F632,</span>
<span class="w">    </span><span class="c1"># W503: Line break occurred before a binary operator</span>
<span class="w">    </span><span class="na">W503,</span>
<span class="w">    </span><span class="c1"># E501: Line too long</span>
<span class="w">    </span><span class="na">E501,</span>
<span class="w">    </span><span class="c1"># E203: Whitespace before ':' (for black)</span>
<span class="w">    </span><span class="na">E203</span>
<span class="na">exclude</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="na">.git,</span>
<span class="w">    </span><span class="na">__pycache__,</span>
<span class="w">    </span><span class="na">build,</span>
<span class="w">    </span><span class="na">dist</span>

<span class="na">max-line-length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">88</span>
</code></pre></div>
<ul>
<li><code>ignore</code>: 指定要忽略的錯誤類型（可以從 <a href="https://www.flake8rules.com/">flake8 rules</a> 找到這些錯誤碼）</li>
<li><code>exclude</code>: 不用被檢查的檔案</li>
<li><code>max-line-length</code>: 每行最長長度（這裡設定的 88，是後面會介紹到的 <a href="https://black.readthedocs.io/en/stable/">black</a> 的預設值）</li>
</ul>
<p>Read More 👉 <a href="https://flake8.pycqa.org/en/latest/user/configuration.html">Configuring Flake8</a></p>
<h3 id="_3">局部跳過檢查</h3>
<p>另一種狀況是，我們只想在讓一兩行程式碼跳過 flake8 的檢查<br/>
但這份檔案的其他地方還是希望能被檢查<br/>
這時候可以在那行程式碼加上 <code># noqa: [error]</code></p>
<p>e.g.,</p>
<div class="highlight"><pre><span></span><code><span class="n">example</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="s2">"example"</span>  <span class="c1"># noqa: E731</span>
</code></pre></div>
<h2 id="-pylint">風格檢查 - pylint</h2>
<p><a href="https://www.pylint.org/">pylint</a> 同樣是相當常見的 Python linter<br/>
一般來說，比 <code>flake8</code> 檢查的更加嚴格</p>
<h3 id="_4">使用</h3>
<p>與 flake8 不同， <code>pylint</code> 指令需要指定模組或套件名稱才能進行檢查</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 安裝 pylint</span>
pipenv<span class="w"> </span>install<span class="w"> </span>pylint<span class="w"> </span>--dev

<span class="c1"># 執行 pylint</span>
pipenv<span class="w"> </span>run<span class="w"> </span>pylint<span class="w"> </span>&lt;package&gt;<span class="w"> </span>......
</code></pre></div>
<h3 id="_5">設定</h3>
<p>原本我建議使用 <code>pipenv run pylint --generate-rcfile &gt;&gt; .pylintrc</code> 來產生設定檔<br/>
但現在我更傾向在 pyproject.toml 中只寫入想要客製化的設定<br/>
原先的做法會在設定檔 .pylintrc 中有著大量的預設值，不容易找到哪些是修改過的設定，造成維護上的困難<br/>
不過需要注意的是在某些版本的 pylint 這個設定方式會出錯，所以建議安裝版本 2.6.0 以上的 pylint</p>
<div class="highlight"><pre><span></span><code><span class="k">[tool.pylint]</span>
<span class="w">    </span><span class="k">[tool.pylint.messages_control]</span>
<span class="w">    </span><span class="n">disable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">"bad-continuation"</span><span class="p">,</span>
<span class="w">        </span><span class="s2">"missing-function-docstring"</span><span class="p">,</span>
<span class="w">        </span><span class="s2">"missing-module-docstring"</span><span class="p">,</span>
<span class="w">        </span><span class="s2">"invalid-name"</span>
<span class="w">    </span><span class="p">]</span>

<span class="w">    </span><span class="k">[tool.pylint.format]</span>
<span class="w">    </span><span class="n">max-line-length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">88</span>
</code></pre></div>
<p>其中 disable 的錯誤可以在 <a href="http://pylint-messages.wikidot.com/all-codes">pylint-messages</a> 找到</p>
<h3 id="_6">局部跳過檢查</h3>
<p>只要在要忽略的程式碼前面一行加上 <code># pylint: disable=[error]</code><br/>
但需要注意的是，這行以後全部的檢查都會被關閉<br/>
所以要記得在需要開啟檢查的地方再加上 <code># pylint: enable=[error]</code></p>
<div class="highlight"><pre><span></span><code><span class="c1"># pylint: disable=line-too-long</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Imagine this is a really long line!"</span><span class="p">)</span>
<span class="c1"># pylint: enable=line-too-long</span>
</code></pre></div>
<h2 id="flake8-vs-pylint">flake8 v.s. pylint</h2>
<p>除了相關的檢查外， pylint 會比 flake8 做更嚴格的檢查<br/>
也可以做更多的設定，但在執行上也會比較慢</p>
<p>在 PyCon US 2018 的 <a href="https://wei-lee.me/pycon-note/posts/pycon-us-2018/2019/09/automating-code-quality/">Automating Code Quality</a>，Kyle Knapp 很詳細的比較了這兩個工具</p>
<p>我的使用上會把 flake8 作為強制檢查程式碼風格的一環<br/>
只要沒有通過 flake8 的檢查，就應該做修正<br/>
而 pylint 的警告則是只作為參考</p>
<p>flake8 在大多數狀況已經足夠<br/>
花時間去修改成符合某些 pylint 過於嚴格的檢查，或設定 <code>.pylint</code>，對我來說並不值得<br/>
而且 Guido 也是這麼說的 XD</p>
<p><img alt="because-guido-say-so" src="/images/posts-image/2020-02-22-python-table-manner-series/because-guido-say-so.png"/></p>
<h2 id="-mypy">型別檢查 - mypy</h2>
<p><a href="http://mypy-lang.org/">mypy</a> 是 Python 做靜態型別檢查的工具<br/>
Python 是一個動態型別的語言，所以可以隨意地不同型別的值指派給同一個變數<br/>
e.g.,</p>
<div class="highlight"><pre><span></span><code><span class="n">str_var</span> <span class="o">=</span> <span class="s2">"This is a string"</span>

<span class="n">str_var</span> <span class="o">=</span> <span class="mi">1</span>
</code></pre></div>
<p>但這麼做有時候會造成邏輯上的錯誤<br/>
例如 <code>import csv</code> 時，如果使用了 <code>csv</code> 作為其他的變數名稱<br/>
就會將變數的值取代掉原本引入的模組</p>
<p>除此之外，型別標記的程式碼也會增加可讀性<br/>
因此近幾年越來越多人注意 Python 的型別標記</p>
<p>PyCon US 2017 中 Lisa Guo 和 Hui Ding 的 Keynote Session <a href="https://blog.wei-lee.me/posts/tech/2017/06/Python-at-IG">Python@Instagram</a> 講了 Instagram 是為什麼要和如何將龐大的程式庫加上型別標示<br/>
<a href="https://wei-lee.me/pycon-note/posts/pycon-us-2020/2020/05/static-typing-in-python/">Static Typing in Python</a> 則是 PyCon US 2020 年 Dustin 對型別標示和檢查的詳細介紹<br/>
而 Vita Smid 在 EuroPython 2019 的 <a href="https://wei-lee.me/pycon-note/posts/europython-2019/2020/03/static-typing-beyond-the-basics-of-def-foo-x-int-str/">Static typing: beyond the basics of def foo(x: int) -str:</a> 則講到了型別檢查更進階一點的應用<br/>
這幾場演講都非常推薦可以觀看！</p>
<h3 id="_7">使用</h3>
<p>以下列的程式碼為例</p>
<div class="highlight"><pre><span></span><code><span class="c1"># wrong_type_hint.py</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>


<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>


<span class="n">func</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</code></pre></div>
<p><code>func</code> 的參數 <code>val</code> 標記為 <code>List[str]</code><br/>
但在呼叫的時候卻傳入整數陣列</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 安裝 mypy</span>
pipenv<span class="w"> </span>install<span class="w"> </span>--dev

<span class="c1"># 執行 mypy</span>
pipenv<span class="w"> </span>run<span class="w"> </span>mypy<span class="w"> </span><span class="o">[</span>files<span class="o">]</span><span class="w"> </span>--ignore-missing-imports
</code></pre></div>
<p>執行 <code>mypy</code> 後，它就會告訴跳出型別錯誤的警告</p>
<div class="highlight"><pre><span></span><code>wrong_type_hint.py:8:<span class="w"> </span>error:<span class="w"> </span>List<span class="w"> </span>item<span class="w"> </span><span class="m">0</span><span class="w"> </span>has<span class="w"> </span>incompatible<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="s2">"int"</span><span class="p">;</span><span class="w"> </span>expected<span class="w"> </span><span class="s2">"str"</span>

wrong_type_hint.py:8:<span class="w"> </span>error:<span class="w"> </span>List<span class="w"> </span>item<span class="w"> </span><span class="m">1</span><span class="w"> </span>has<span class="w"> </span>incompatible<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="s2">"int"</span><span class="p">;</span><span class="w"> </span>expected<span class="w"> </span><span class="s2">"str"</span>

wrong_type_hint.py:8:<span class="w"> </span>error:<span class="w"> </span>List<span class="w"> </span>item<span class="w"> </span><span class="m">2</span><span class="w"> </span>has<span class="w"> </span>incompatible<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="s2">"int"</span><span class="p">;</span><span class="w"> </span>expected<span class="w"> </span><span class="s2">"str"</span>
</code></pre></div>
<p>mypy 預設會去找所有引入的函式庫是否也有做好型別標記<br/>
所以一般使用上都會加上參數 <code>--ignore-missing-imports</code><br/>
只要確保我們撰寫的部分都是正確的</p>
<h3 id="_8">設定</h3>
<p>以下是我用來設定 mypy 的 <code>setup.cfg</code></p>
<div class="highlight"><pre><span></span><code><span class="k">[mypy]</span>
<span class="na">files</span><span class="o">=</span><span class="s">[your files]</span>
<span class="na">ignore_missing_imports</span><span class="o">=</span><span class="s">true</span>
</code></pre></div>
<h2 id="-black">自動排版 - black</h2>
<p>比起 flake8, pylint 只做風格檢查<br/>
<a href="https://github.com/psf/black">black</a> 會更進一步的直接修正不符合風格的程式碼<br/>
原本我不太喜歡使用這種的工具<br/>
原因是每次執行的結果不一定相同，修正的結果不見得符合我的需求，這時就要再去做設定</p>
<p>black 某種程度上的解決了這些問題<br/>
black 每次執行的結果都會是相同的，而且大致上修正結果我還算滿意<br/>
它最特別的地方是，不太能做客製化設定，也不能只做局部程式碼修正</p>
<p>引述自 black 的文件</p>
<blockquote>
<p>The Black code style</p>
<p>Black reformats entire files in place. It is not configurable. It doesn't take previous formatting into account. It doesn't reformat blocks that start with # fmt: off and end with # fmt: on. # fmt: on/off have to be on the same level of indentation. It also recognizes YAPF's block comments to the same effect, as a courtesy for straddling code.</p>
</blockquote>
<p>為什麼這可能是件好事？<br/>
因為這能讓大家更專注於程式碼的功能本身<br/>
而不是這裡要不要加逗號？要不要斷行？如何去調教設定檔？</p>
<blockquote>
<p>“There should be one-- and preferably only one --obvious way to do it.”<br/>
–The Zen of Python, by Tim Peters</p>
</blockquote>
<h3 id="_9">使用</h3>
<p>因為 black 還是 beta 版<br/>
透過 pipenv 安裝時還要加上 <code>--pre</code> 參數</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 安裝 black</span>
pipenv<span class="w"> </span>install<span class="w"> </span>black<span class="w"> </span>--dev<span class="w"> </span>--pre

<span class="c1"># 執行 black 修正程式碼風格</span>
pipenv<span class="w"> </span>run<span class="w"> </span>black<span class="w"> </span>&lt;package&gt;
</code></pre></div>
<p>因為 black 是直接重新排版程式碼<br/>
我節錄了部分我在 pycontw-postevent-report-generator <a href="https://github.com/pycontw/pycontw-postevent-report-generator/tree/e64a1202c2af08fe9ca5a44b1e52fdafeac2098d">commit e64a</a> 修正風格的結果<br/>
上面紅色的部分是原本的程式碼，下面綠色是修正過的結果<br/>
(p.s. 當時設定的長度是 119)</p>
<p><img alt="black-fix-1" src="/images/posts-image/2020-02-22-python-table-manner-series/black-fix-1.jpg"/></p>
<p><img alt="black-fix-2" src="/images/posts-image/2020-02-22-python-table-manner-series/black-fix-2.jpg"/></p>
<p><img alt="black-fix-3" src="/images/posts-image/2020-02-22-python-table-manner-series/black-fix-3.jpg"/></p>
<p>如果只想要檢查程式碼是否符合 black 的風格<br/>
而不要直接做修正，可以在指令後面加入 <code>--check</code> 參數</p>
<div class="highlight"><pre><span></span><code>pipenv<span class="w"> </span>run<span class="w"> </span>black<span class="w"> </span>&lt;package&gt;<span class="w"> </span>--check
</code></pre></div>
<h3 id="_10">設定</h3>
<p>雖然說 black 不能對風格做太多的設定<br/>
我們還是能先指定哪些檔案是要修正，哪些是不用的<br/>
以下是我放在 <code>pyproject.toml</code> 的設定<br/>
（p.s. <code>line-length = 88</code> 是 black 的預設值）</p>
<div class="highlight"><pre><span></span><code><span class="k">[tool.black]</span>
<span class="n">line-length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">88</span>
<span class="n">include</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'\.pyi?$'</span>
<span class="n">exclude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'''</span>
<span class="s1">/(</span>
<span class="s1">    \.eggs</span>
<span class="s1">  | \.git</span>
<span class="s1">  | \.hg</span>
<span class="s1">  | \.mypy_cache</span>
<span class="s1">  | \.tox</span>
<span class="s1">  | \.venv</span>
<span class="s1">  | _build</span>
<span class="s1">  | buck-out</span>
<span class="s1">  | build</span>
<span class="s1">  | dist</span>
<span class="s1">)/</span>
<span class="s1">'''</span>
</code></pre></div>
<h2 id="-isort">排序函式庫 - isort</h2>
<p><a href="https://github.com/timothycrosley/isort">isort</a> 是自動排列函式庫引入順序的的工具<br/>
PEP 8 建議將引入的函式庫分為三類做排序</p>
<ol>
<li>標準函式庫</li>
<li>第三方函式庫</li>
<li>本地的函式庫</li>
</ol>
<p>並在每一個種類間空一行<br/>
e.g.,</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">flask</span>

<span class="kn">import</span> <span class="nn">models</span>
</code></pre></div>
<p>使用 isort 的原因跟 black 差不多<br/>
就是讓程式來決定比較枝微末節的事，專注在開發本身上面</p>
<h3 id="_11">執行</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 安裝 isort</span>
pipenv<span class="w"> </span>install<span class="w"> </span>isort<span class="w"> </span>--dev

<span class="c1"># 執行 isort 修正函式庫排序</span>
pipenv<span class="w"> </span>run<span class="w"> </span>isort<span class="w"> </span>--atomic<span class="w"> </span>.
</code></pre></div>
<ul>
<li><code>--atomic</code>: 只有重新排序後的結果沒有語法錯誤，才會儲存</li>
</ul>
<h3 id="_12">設定</h3>
<p>自從 5.0.0 後， isort 直接把常見的設定寫成 <a href="https://pycqa.github.io/isort/docs/configuration/profiles/">profile</a><br/>
只要指定 profile 就能直接套用相容的設定</p>
<div class="highlight"><pre><span></span><code><span class="k">[tool.isort]</span>
<span class="n">profile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span>
</code></pre></div>
<p>不過有一個相關的 bug 到 5.0.5 後才修正 (Ref: <a href="https://github.com/PyCQA/isort/issues/1295">Black profile not compatible with Black (ensure_newline_before_comments not working) #1295</a>)<br/>
所以還是建議安裝最新的版本</p>
<h2 id="_13">其他工具</h2>
<ul>
<li><a href="https://github.com/mgedmin/check-manifest">check-manifest</a>: 檢查有沒有少放入 <code>MANIFEST.in</code> 的檔案</li>
<li><a href="https://github.com/asottile/seed-isort-config">seed-isort-config</a></li>
</ul>
<h2 id="bonus">Bonus: 設定檔的選用</h2>
<p>從前面的測試篇到現在有提到很多設定檔的格式<br/>
通常每個工具都會有自己的設定檔 (e.g., <code>.coveragerc</code>, <code>.flake8</code>) 或者用 Python 比較通用的格式 (e.g., <code>pyproject.toml</code>, <code>setup.cfg</code>)<br/>
其中 <code>pyproject.toml</code> 是在 <a href="https://www.python.org/dev/peps/pep-0518/">PEP 518</a> 提出的設定檔格式<br/>
不過還沒有被所有的工具支援<br/>
<a href="https://github.com/carlosperate/awesome-pyproject">awesome-pyproject</a> 整理了目前已經支援或討論是否要支援 <code>proproject.toml</code> 的工具</p>
<p>比起讓多個工具的設定散落在各個設定檔<br/>
我傾向統一管理在 <code>pyproject.toml</code> 或 <code>setup.cfg</code></p>
<ul>
<li><code>pyproject.toml</code><ul>
<li>black</li>
<li>isort</li>
<li>pylint</li>
<li>coverage</li>
<li>pytest</li>
<li>commitizen (之後才會介紹到)</li>
</ul>
</li>
<li>setup.cfg<ul>
<li>flake8</li>
<li>mypy</li>
</ul>
</li>
</ul>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://wei-lee.me/pycon-note/posts/pycon-us-2018/2019/09/automating-code-quality/">Automating Code Quality - PyCon US 2018</a></li>
<li><a href="https://wei-lee.me/pycon-note/posts/pycon-us-2019/2019/11/life-is-better-painted-black-or-how-to-stop-worrying-and-embrace-auto-formatting/">Life Is Better Painted Black, or: How to Stop Worrying and Embrace Auto-Formatting - PyCon US 2019</a></li>
<li><a href="https://www.youtube.com/watch?v=wf-BqAjZb8M&amp;feature=youtu.be">Beyond PEP 8 -- Best practices for beautiful intelligible code - PyCon 2015</a></li>
</ul>
</section>
<section class="post-footer">
<div class="post-share">
<span class="post-info-label">Share</span>
<a aria-label="Twitter" class="twitter" href="https://twitter.com/share?text=Python Table Manners - 程式碼風格 &amp;url=https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-coding-style" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Twitter">
<i aria-hidden="true" class="icon icon-twitter"></i><span class="hidden">Twitter</span>
</a>
<a aria-label="Facebook" class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-coding-style" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Facebook">
<i aria-hidden="true" class="icon icon-facebook"></i><span class="hidden">Facebook</span>
</a>
<a aria-label="LinkedIn" class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-coding-style&amp;title=Python Table Manners - 程式碼風格" onclick="window.open(this.href, 'linkedin-share', 'width=930,height=720');return false;" title="LinkedIn">
<i aria-hidden="true" class="icon icon-linkedin"></i><span class="hidden">LinkedIn</span>
</a>
<a aria-label="Email" class="email" href="mailto:?subject=Python Table Manners - 程式碼風格&amp;body=https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-coding-style" title="Email">
<i aria-hidden="true" class="icon icon-mail"></i><span class="hidden">Email</span>
</a>
<div class="clear"></div>
</div>
<aside class="post-tags">
<a href="https://blog.wei-lee.me/tag/python.html">Python</a><a href="https://blog.wei-lee.me/tag/code-quality.html">Code Quality</a> </aside>
<div class="clear"></div>
<div class="series">
<p>This post is part 5 of the "Python Table Manners" series:</p>
<ol class="parts">
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-series">Python Table Manners 系列</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-dependency-mangement">Python Table Manners - 虛擬環境和套件管理</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-test-1">Python Table Manners - 測試 (一)</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-test-2">Python Table Manners - 測試 (二)</a>
</li>
<li class="active">
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-coding-style">Python Table Manners - 程式碼風格</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-manage-trivial-tasks">Python Table Manners - 管理繁瑣任務</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-pre-commit">Python Table Manners - pre-commit: git commit 前做完檢查</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/03/python-table-manners-commitizen">Python Table Manners - Commitizen: 規格化 commit message</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/03/python-table-manners-security">Python Table Manners - 安全性檢查</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/04/python-table-manners-documentation">Python Table Manners - 文件</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/12/python-table-manner-continuous-integration">Python Table Manners - 持續整合/部署</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2021/01/python-table-manners-cookiecutter">Python Table Manners - Cookiecutter 專案模板</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2021/01/python-table-manner-editor">Python Table Manners 番外 - 編輯器</a>
</li>
</ol>
</div>
</section>
<aside class="post-nav">
<a class="post-nav-next" href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-manage-trivial-tasks">
<section class="post-nav-teaser">
<i class="icon icon-arrow-left"></i>
<h2 class="post-nav-title">Python Table Manners - 管理繁瑣任務</h2>
<p class="post-nav-excerpt">前面幾篇從套件管理、虛擬環境、測試、風格檢查到自動排版，提到了很多的工具 每一個工具又有各自的參數和設定 這麼多指令怎麼可能記得起來 😱</p>
<p class="post-nav-meta"><time datetime="2020/02/27 - Thu">2020/02/27 - Thu</time></p>
</section>
</a>
<a class="post-nav-prev" href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-test-2">
<section class="post-nav-teaser">
<i class="icon icon-arrow-right"></i>
<h2 class="post-nav-title">Python Table Manners - 測試 (二)</h2>
<p class="post-nav-excerpt">接續前一篇提到的 pytest，繼續看它的其他功能吧</p>
<p class="post-nav-meta"><time datetime="2020/02/25 - Tue">2020/02/25 - Tue</time></p>
</section>
</a>
<div class="clear"></div>
</aside>
</div>
<script type="text/javascript">var use_utterance = true;</script>
<section class="post-comments">
<script async="" crossorigin="anonymous" data-issue-term="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-coding-style" data-label="blog-comment" data-repo="Lee-W/main-blog" data-theme="github-light" src="https://utteranc.es/client.js">
</script>
</section>
</article>
</main>
<div class="nav-footer">
<nav aria-label="Footer" class="nav-wrapper">
<span class="nav-copy">Those aren't written down are meant to be forgotten © 2023
          <a class="nav-rss" href="https://blog.wei-lee.me/feeds/all.atom.xml" target="_blank" title="RSS"><i class="icon icon-rss"></i></a>
</span>
<span class="nav-credits">



          Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a> • Theme <a href="https://github.com/arulrajnet/attila" rel="nofollow">Attila</a> •
          <a class="menu-item js-theme" data-dark="Dark theme" data-light="Light theme" data-system="System theme" href="#">
<span class="theme-icon"></span><span class="theme-text">System theme</span>
</a>
</span>
</nav>
</div>
</section>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
<!-- TODO: minify -->
<script src="https://blog.wei-lee.me/theme/js/jquery.fitvids.js" type="text/javascript"></script>
<script src="https://blog.wei-lee.me/theme/js/script.js" type="text/javascript"></script>
<script src="https://blog.wei-lee.me/theme/js/clipboard.min.js" type="text/javascript"></script>
<script src="https://blog.wei-lee.me/theme/js/copy-to-clipboard.js" type="text/javascript"></script>
<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3J7XQ46QH5"></script>
<script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-3J7XQ46QH5', { 'anonymize_ip': true });
    </script>
<script src="/pagefind/pagefind-ui.js"></script>
<script>
      window.addEventListener('DOMContentLoaded', (event) => {
          new PagefindUI({
              element: "#search",
              showImages: false,
          });
      });
  </script>
<!-- 	The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in article.html, but it needs to be included down here, after jQuery has already loaded. -->
<!-- Add MathJax and FontAwesome for Asciidoc -->\
<script>
  $(document).ready(function () {
    var viewport = $(window);
    var post = $('.post-content');
    // Responsive videos with fitVids
    post.fitVids();

    var mdSelector=".highlight pre code";
    var rstSelector=".highlight pre code";
    // For ":source-highlighter: highlight.js`" in asciidoc
    var adocSelector="pre.highlight > code[data-lang]"
    var selector=mdSelector;
    // Format code blocks and add line numbers
    function codestyling() {
      $(selector).each(function(i, e) {
        // Code highlight
        hljs.highlightElement(e);
        // No lines for plain text blocks
        if (!$(this).hasClass('language-text')) {
          var code = $(this);
          // Calculate amount of lines
          var lines = code.html().split(/\n(?!$)/g).length;
          var numbers = [];
          if (lines > 1) {
            lines++;
          }
          for (i = 1; i < lines; i++) {
            numbers += '<span class="line" aria-hidden="true">' + i + '</span>';
          }
          code.parent().append('<div class="lines">' + numbers + '</div>');
        }
      });
    }

    // Format code blocks only
    function codestylingWithoutLineNumbers() {
      $(selector).each(function(i, e) {
        // Code highlight
        hljs.highlightElement(e);
      });
    }

    codestylingWithoutLineNumbers();
    // Reading progress bar on window top
    function readingProgress() {
      var postBottom = post.offset().top + post.height();
      var viewportHeight = viewport.height();
      var progress = 100 - (((postBottom - (viewport.scrollTop() + viewportHeight) + viewportHeight / 3) / (postBottom - viewportHeight + viewportHeight / 3)) * 100);
      $('.progress-bar').css('width', progress + '%');
      (progress > 100) ? $('.progress-container').addClass('complete'): $('.progress-container').removeClass('complete');
    }
    readingProgress();
    // Trigger reading progress
    viewport.on({
      'scroll': function() {
        readingProgress();
      },
      'resize': function() {
        readingProgress();
      },
      'orientationchange': function() {
        readingProgress();
      }
    });

  });
</script>
</body>
</html>
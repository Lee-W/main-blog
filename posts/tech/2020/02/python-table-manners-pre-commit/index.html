
<!DOCTYPE html>

<html lang="zh-tw">
<head>
<meta charset="utf-8"/>
<meta charset="utf-8" content="text/html" http-equiv="Content-Type">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/>
<title>Python Table Manners - pre-commit: git commit 前做完檢查 </title>
<meta content="True" name="HandheldFriendly"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="origin" name="referrer"/>
<meta content="Pelican" name="generator"/>
<link href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-pre-commit" rel="canonical"/>
<!-- Feed -->
<link href="https://blog.wei-lee.me/feeds/all.atom.xml" rel="alternate" title="Those aren't written down are meant to be forgotten Full Atom Feed" type="application/atom+xml"/>
<!-- TODO: combine -->
<link href="https://blog.wei-lee.me/theme/css/style.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/pygments.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/pagefind-ui-custom.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/code.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/code-copy.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/custom.css" rel="stylesheet" type="text/css"/>
<link href="/pagefind/pagefind-ui.css" rel="stylesheet"/>
<!-- Custom fonts -->
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,300" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css"/>
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
<script>
    var siteUrl = 'https://blog.wei-lee.me';
  </script>
<script>
    var localTheme = localStorage.getItem('attila_theme');
    switch (localTheme) {
      case 'dark':
        document.documentElement.classList.add('theme-dark');
        break;
      case 'light':
        document.documentElement.classList.add('theme-light');
        break;
      default:
        break;
    }
  </script>
<meta content="前一篇提到了透過 invoke 簡化繁瑣的指令 但人類除了是懶惰的，還是健忘的 即使已經更簡便了，沒被督促常常還是會忘了執 …" name="description"/>
<meta content="Wei Lee" name="author"/>
<meta content="Python" name="tags"/>
<meta content="Git" name="tags"/>
<meta content="Code Quality" name="tags"/>
<!-- Open Graph -->
<meta content="Those aren't written down are meant to be forgotten" prefix="og: http://ogp.me/ns#" property="og:site_name">
<meta content="Python Table Manners - pre-commit: git commit 前做完檢查 " prefix="og: http://ogp.me/ns#" property="og:title">
<meta content="前一篇提到了透過 invoke 簡化繁瑣的指令 但人類除了是懶惰的，還是健忘的 即使已經更簡便了，沒被督促常常還是會忘了執 …" prefix="og: http://ogp.me/ns#" property="og:description">
<meta content="zh-tw" prefix="og: http://ogp.me/ns#" property="og:locale">
<meta content="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-pre-commit" prefix="og: http://ogp.me/ns#" property="og:url">
<meta content="article" prefix="og: http://ogp.me/ns#" property="og:type"/>
<meta content="2020-02-28 23:10:00+08:00" prefix="og: http://ogp.me/ns#" property="article:published_time"/>
<meta content="2020-10-04 16:10:00+08:00" prefix="og: http://ogp.me/ns#" property="article:modified_time"/>
<meta content="https://blog.wei-lee.me/author/wei-lee.html" prefix="og: http://ogp.me/ns#" property="article:author"/>
<meta content="Tech" prefix="og: http://ogp.me/ns#" property="article:section">
<meta content="Python" prefix="og: http://ogp.me/ns#" property="article:tag"/>
<meta content="Git" prefix="og: http://ogp.me/ns#" property="article:tag"/>
<meta content="Code Quality" prefix="og: http://ogp.me/ns#" property="article:tag"/>
<meta content="https://blog.wei-lee.me/images/cover.jpeg" prefix="og: http://ogp.me/ns#" property="og:image"/>
<!-- Twitter Card -->
<meta content="summary_large_image" name="twitter:card"/>
<meta content="@clleew" name="twitter:site"/>
<meta content="Python Table Manners - pre-commit: git commit 前做完檢查 " name="twitter:title"/>
<meta content="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-pre-commit" name="twitter:url"/>
<meta content="https://blog.wei-lee.me/images/cover.jpeg" name="twitter:image:src"/>
<meta content="前一篇提到了透過 invoke 簡化繁瑣的指令 但人類除了是懶惰的，還是健忘的 即使已經更簡便了，沒被督促常常還是會忘了執 …" name="twitter:description"/>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "Python Table Manners - pre-commit: git commit 前做完檢查",
  "headline": "Python Table Manners - pre-commit: git commit 前做完檢查",
  "datePublished": "2020-02-28 23:10:00+08:00",
  "dateModified": "2020-10-04 16:10:00+08:00",
  "author": {
    "@type": "Person",
    "name": "Wei Lee",
    "url": "https://blog.wei-lee.me/author/wei-lee.html"
  },
  "image": "https://blog.wei-lee.me//images/cover.jpeg",
  "url": "https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-pre-commit",
  "description": "前一篇提到了透過 invoke 簡化繁瑣的指令 但人類除了是懶惰的，還是健忘的 即使已經更簡便了，沒被督促常常還是會忘了執 …"
}
</script>
</meta></meta></meta></meta></meta></meta></link></meta><link href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-pre-commit" rel="canonical"/><script type="application/ld+json">{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "Those aren't written down are meant to be forgotten", "item": "https://blog.wei-lee.me"}, {"@type": "ListItem", "position": 2, "name": "Posts", "item": "https://blog.wei-lee.me/posts"}, {"@type": "ListItem", "position": 3, "name": "Tech", "item": "https://blog.wei-lee.me/posts/tech"}, {"@type": "ListItem", "position": 4, "name": "2020", "item": "https://blog.wei-lee.me/posts/tech/2020"}, {"@type": "ListItem", "position": 5, "name": "02", "item": "https://blog.wei-lee.me/posts/tech/2020/02"}, {"@type": "ListItem", "position": 6, "name": "Python table manners pre commit", "item": "https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-pre-commit"}, {"@type": "ListItem", "position": 7, "name": "Index", "item": "https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-pre-commit/index.html"}]}</script><script type="application/ld+json">{"@context": "https://schema.org", "@type": "Article", "author": {"@type": "Person", "name": "Wei Lee"}, "publisher": {"@type": "Organization", "name": "Those aren't written down are meant to be forgotten"}, "headline": "Python Table Manners - pre-commit: git commit 前做完檢查", "about": "Tech", "datePublished": "2020-02-28 23:10"}</script><meta content="summary" name="twitter:card"/><meta content="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-pre-commit" property="og:url"/><meta content="article" property="og:type"/><meta content="Python Table Manners - pre-commit: git commit 前做完檢查" property="og:title"/><meta content="C" property="og:locale"/></head>
<body class="category-template">
<div class="nav-header">
<nav aria-label="Main" class="nav-wrapper">
<ul>
<li class="nav-🏠 Home" role="presentation"><a href="/"><span>🏠 Home</span></a></li>
<li class="nav-About Me" role="presentation"><a href="/pages/about-me.html"><span>About Me</span></a></li>
<li class="nav-👨‍💻 Tech active" role="presentation"><a href="/category/tech.html"><span>👨‍💻 Tech</span></a></li>
<li class="nav-📚 Book Digest" role="presentation"><a href="/category/book.html"><span>📚 Book Digest</span></a></li>
<li class="nav-💬 Gossiping" role="presentation"><a href="/category/gossiping.html"><span>💬 Gossiping</span></a></li>
<li class="nav-🏷️ Tags" role="presentation"><a href="/tags.html"><span>🏷️ Tags</span></a></li>
<li class="nav-🗄️ Archives" role="presentation"><a href="/archives.html"><span>🗄️ Archives</span></a></li>
<li class="nav-📚 Series" role="presentation"><a href="/series_list.html"><span>📚 Series</span></a></li>
<li class="nav-🔍 Search" role="presentation"><a href="/search.html"><span>🔍 Search</span></a></li>
</ul>
<ul class="nav-meta">
<li class="nav-linkedin"><a aria-label="Linkedin" href="https://tw.linkedin.com/in/clleew" target="_blank"><i aria-hidden="true" class="icon icon-linkedin"></i>
<span>Linkedin</span>
</a></li>
<li class="nav-github"><a aria-label="Github" href="https://github.com/Lee-W" target="_blank"><i aria-hidden="true" class="icon icon-github"></i>
<span>GitHub</span>
</a></li>
<li class="nav-twitter"><a aria-label="Twitter" href="https://twitter.com/clleew" target="_blank"><i aria-hidden="true" class="icon icon-twitter"></i>
<span>Twitter</span>
</a></li>
<li class="nav-search" style="display: none;">
<a title="Search">
<i aria-hidden="true" class="icon icon-search"></i>
<span>Search</span>
</a>
</li>
</ul> </nav>
<div class="nav-wrapper-control">
<div class="inner">
<a class="nav-menu" role="button"><i aria-hidden="true" class="icon icon-menu"></i>Menu</a>
<a class="nav-search" role="button" style="display: none;" title="Search"><i aria-hidden="true" class="icon icon-search"></i></a>
</div>
</div>
</div>
<div aria-label="Close" class="nav-close" role="button"></div>
<section class="page-wrapper" id="wrapper">
<!-- Progressbar -->
<div class="progress-container">
<span class="progress-bar"></span>
</div>
<!-- Page Header -->
<!-- Set your background image for this header on the line below. -->
<header class="post-header has-cover">
<div class="inner">
<span class="post-info">
<span class="post-type">Article</span>
<span class="post-count">Tech</span>
</span>
<h1 class="post-title">
            Python Table Manners - pre-commit: git commit 前做完檢查
        </h1>
<div class="post-meta">
<div class="post-meta-avatars">
<figure class="post-meta-avatar avatar">
<a class="author-avatar" href="https://blog.wei-lee.me/author/wei-lee.html">
<img alt="Wei Lee" class="author-profile-image" src="https://blog.wei-lee.me//images/avatar.jpeg"/>
</a>
</figure>
</div>
<h4 class="post-meta-author">
            Wei Lee
          </h4>
<time datetime="2020/02/28 - Fri">2020/02/28 - Fri</time>
          • <time datetime="2020/10/04 - Sun"> Updated on 2020/10/04 - Sun</time>
          • 2 min read
        </div>
<div class="post-cover cover">
<img alt="Category Tech" src="https://blog.wei-lee.me/images/cover.jpeg"/>
</div>
</div>
</header>
<!-- Post content -->
<main class="content" data-pagefind-body="" role="main">
<article class="post">
<div class="inner">
<section class="post-content">
<p>前一篇提到了透過 <a href="http://www.pyinvoke.org/">invoke</a> 簡化繁瑣的指令<br/>
但人類除了是懶惰的，還是健忘的<br/>
即使已經更簡便了，沒被督促常常還是會忘了執行<br/>
就像這次的系列文，如果沒被寫作松督促，不知道什麼時候才會出現（笑<br/>
這篇來聊聊如何透過 <a href="https://pre-commit.com">pre-commit</a> 強制做檢查</p>
<div class="toc">
<ul>
<li><a href="#pre-commit">pre-commit</a></li>
<li><a href="#pre-commit_1">使用 pre-commit 進行檢查</a><ul>
<li><a href="#pre-commit-hook">設定 pre-commit hook</a></li>
</ul>
</li>
<li><a href="#pre-commit_2">安裝 pre-commit 到專案中</a></li>
<li><a href="#pre-commit-hook_1">使用自定義的 pre-commit hook</a></li>
<li><a href="#pre-commit-hook_2">為自己的工具加上 pre-commit hook</a></li>
<li><a href="#bonus-commit">Bonus: 可以只跳警告不擋下 commit 嗎？</a></li>
<li><a href="#reference">Reference</a></li>
</ul>
</div>
<h2 id="pre-commit">pre-commit</h2>
<p><a href="https://pre-commit.com/">pre-commit</a> 讓我們能方便的加入 <a href="https://git-scm.com/book/zh-tw/v2/Customizing-Git-Git-Hooks">Git Hook</a>，並在各種 git 的相關操作前進行檢查</p>
<p>正如它的命名，它可以在進行 <code>git commit</code> 前執行一些操作<br/>
不過並不僅限於 commit 前，也可以在其它 git 的階段進行<br/>
之所以要這麼做就是為了讓不符合要求的程式碼，從最一開始就不會進入到版本庫 （pre commit）或 git 伺服器 （pre push）</p>
<h2 id="pre-commit_1">使用 pre-commit 進行檢查</h2>
<div class="highlight"><pre><span></span><code><span class="c1"># 安裝 pre-commit</span>
pipenv<span class="w"> </span>install<span class="w"> </span>pre-commit<span class="w"> </span>--dev
</code></pre></div>
<h3 id="pre-commit-hook">設定 pre-commit hook</h3>
<p>先透過設定檔 <code>.pre-commit-config.yaml</code>，告訴 pre-commit 要做哪些檢查<br/>
需要注意的是，專案必須要是一個 git 專案<br/>
這些 git hook 都會被寫入 <code>.git/hooks/</code></p>
<p>e.g.,</p>
<div class="highlight"><pre><span></span><code><span class="nt">repos</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/pre-commit/pre-commit-hooks</span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v3.2.0</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">end-of-file-fixer</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">trailing-whitespace</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">--markdown-linebreak-ext=md</span><span class="p p-Indicator">]</span>
</code></pre></div>
<p>以上面的例子來說</p>
<ul>
<li><code>repos</code> 告訴 pre-commit 要去哪邊找到這些 hook<ul>
<li><code>repo</code>: 去找專案 <a href="https://github.com/pre-commit/pre-commit-hooks">pre-commit-hooks</a></li>
<li><code>rev</code>: 在專案 pre-commit-hooks 找到 rev <a href="https://github.com/pre-commit/pre-commit-hooks/tree/v2.3.0">v2.3.0</a></li>
<li><code>hooks</code>: 在 pre-commit-hooks rev v2.3.0 的 <a href="https://github.com/pre-commit/pre-commit-hooks/blob/v2.3.0/.pre-commit-hooks.yaml">.pre-commit-hooks.yaml</a> 中尋找指定的 hook<ul>
<li><code>id</code>: hook id</li>
<li><code>args</code>: 執行這個 hook 的額外參數</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>pre-commit 整理了較為通用的 hook 在 <a href="https://github.com/pre-commit/pre-commit-hooks">pre-commit-hooks</a><br/>
除此之外，如 <a href="https://github.com/psf/black">black</a> 和 <a href="https://gitlab.com/pycqa/flake8">flake8</a> 等工具也都有提供 pre-commit hook</p>
<p>另外，<strong>建議 rev 不要使用 master，而應該使用版本號等明確的 rev</strong><br/>
原因是預設 pre-commit 會在執行時將 hook 專案 clone 下來<br/>
如果沒有特別設定， pre-commit 不會把最新版 pull 下來<br/>
指到的 master 就會是第一次 pre-commit 抓到時的 master，不是最新版的 master</p>
<p>寫完設定檔後，接著就是把 pre-commit hook 安裝到 git 專案中</p>
<h2 id="pre-commit_2">安裝 pre-commit 到專案中</h2>
<div class="highlight"><pre><span></span><code><span class="c1"># 將 pre-commit hook 安裝到 git 專案</span>
pipenv<span class="w"> </span>run<span class="w"> </span>pre-commit<span class="w"> </span>install
</code></pre></div>
<p>需要注意的是每次重新 clone 之後，都必須要執行一次<br/>
雖然可以將 <code>.pre-commit-config.yaml</code> 加入版本控制<br/>
但 <code>.git/hook/</code> 是不能被加入版本控制的</p>
<p>執行完會出現以下訊息</p>
<div class="highlight"><pre><span></span><code>pre-commit<span class="w"> </span>installed<span class="w"> </span>at<span class="w"> </span>.git/hooks/pre-commit
</code></pre></div>
<p>第一次進行 git commit 時，會將 <a href="https://github.com/pre-commit/pre-commit-hooks">pre-commit-hooks</a> clone 到 pre-commit 統一管理的地方<br/>
之後就會進行 <code>Fix End of Files</code> 跟 <code>Trim Trailing Whitespace</code> 的檢查</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Initializing<span class="w"> </span>environment<span class="w"> </span><span class="k">for</span><span class="w"> </span>https://github.com/pre-commit/pre-commit-hooks.
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Installing<span class="w"> </span>environment<span class="w"> </span><span class="k">for</span><span class="w"> </span>https://github.com/pre-commit/pre-commit-hooks.
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Once<span class="w"> </span>installed<span class="w"> </span>this<span class="w"> </span>environment<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>reused.
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>This<span class="w"> </span>may<span class="w"> </span>take<span class="w"> </span>a<span class="w"> </span>few<span class="w"> </span>minutes...
Fix<span class="w"> </span>End<span class="w"> </span>of<span class="w"> </span>Files.........................................................Passed
Trim<span class="w"> </span>Trailing<span class="w"> </span>Whitespace.................................................Passed
</code></pre></div>
<p>如果沒有通過， git 會阻止你進行 commit</p>
<p>pre-commit 每次都只會針對要 commit 的檔案做檢查<br/>
所以建議第一次將 pre-commit 引入專案時，可以先檢查所有的檔案</p>
<div class="highlight"><pre><span></span><code>pipenv<span class="w"> </span>run<span class="w"> </span>pre-commit<span class="w"> </span>run<span class="w"> </span>--all-files
</code></pre></div>
<h2 id="pre-commit-hook_1">使用自定義的 pre-commit hook</h2>
<p>下面的例子是在 commit 前，要進行 pytest 的檢查</p>
<div class="highlight"><pre><span></span><code><span class="nt">repos</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pytest</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pytest</span>
<span class="w">        </span><span class="nt">stages</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">commit</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">system</span>
<span class="w">        </span><span class="nt">entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pipenv run pytest</span>
<span class="w">        </span><span class="nt">pass_filenames</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">        </span><span class="nt">types</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">python</span><span class="p p-Indicator">]</span>
</code></pre></div>
<ul>
<li><code>repo: local</code>: 直接在本地資料夾執行<ul>
<li><code>hooks</code>: 有哪些 hook 要執行<ul>
<li><code>id</code>, <code>name</code>: hook 的 id / name 是 <code>pytest</code></li>
<li><code>stages</code>: 在 <code>commit</code> 前執行</li>
<li><code>language</code>: 直接使用系統執行 <code>entry</code> 內的指令</li>
<li><code>entry</code>: 這個 hook 要執行的指令是 <code>pipenv run pytest</code></li>
<li><code>types</code>: 只有在 python 這種檔案類型才進行檢查</li>
<li><code>pass_filenames</code>: 是否要將 commit 的檔案名稱作為 <code>entry</code> 中指令的參數</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>其中 <code>stages</code> 總共有六種</p>
<ul>
<li>commit</li>
<li>merge-commit</li>
<li>push</li>
<li>prepare-commit-msg</li>
<li>commit-msg</li>
<li>manual</li>
</ul>
<p>需要注意的是當執行 <code>pipenv run pre-commit commit</code> 時<br/>
預設只會寫入 <code>.git/hooks/pre-commit</code><br/>
如果要加入其他階段，則必須要在後面加入參數 <code>-t [hook-type]</code></p>
<p>e.g.,</p>
<div class="highlight"><pre><span></span><code>pipenv<span class="w"> </span>run<span class="w"> </span>pre-commit<span class="w"> </span>install<span class="w"> </span>-t<span class="w"> </span>pre-push
</code></pre></div>
<p>支援 6 種 hook-type</p>
<ul>
<li>pre-commit</li>
<li>pre-merge-commit</li>
<li>pre-push</li>
<li>prepare-commit-msg</li>
<li>commit-msg</li>
</ul>
<p>像是 pytest 這種需要執行比較久的任務<br/>
我就不見得會在 commit 這個 stage 做檢查<br/>
而是會把 <code>stages</code> 改成 <code>push</code><br/>
並安裝 pre-push 的 hook (i.e., <code>pipenv run pre-commit install -t pre-push</code>)</p>
<p>如果不想要每個 hook 都各自做設定，可以在 <code>.pre-commit-config.yaml</code> 加上 <code>default_stages</code></p>
<div class="highlight"><pre><span></span><code><span class="nt">default_stages</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">push</span><span class="p p-Indicator">]</span>
</code></pre></div>
<p>表示如果沒有特定指定 <code>stages</code> 的 hook 都只在 <code>push</code> 的階段做檢查</p>
<h2 id="pre-commit-hook_2">為自己的工具加上 pre-commit hook</h2>
<p>為你寫的工具加上 pre-commit hook 可以讓人更方便使用你的工具<br/>
在工具專案中加入 <code>.pre-commit-hooks.yaml</code> 讓 pre-commit 知道其他人引入你的工具時要做什麼處理<br/>
撰寫的方式跟 local 的 repo 的寫法相似</p>
<div class="highlight"><pre><span></span><code><span class="nt">repos</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<span class="w">      </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">          </span><span class="nt">entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<h2 id="bonus-commit">Bonus: 可以只跳警告不擋下 commit 嗎？</h2>
<p>根據 <a href="https://github.com/pre-commit/pre-commit/issues/923">Can I show warning message without blocking the commit? #923</a> 提到的， pre-commit 認為這不是好的作法<br/>
但仍然可以透過對 <code>entry</code> 內指令的操作達到類似的效果</p>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://mropengate.blogspot.com/2019/08/pre-commit-git-hooks_4.html">提升程式碼品質：使用 Pre-Commit (Git Hooks)</a></li>
</ul>
</section>
<section class="post-footer">
<div class="post-share">
<span class="post-info-label">Share</span>
<a aria-label="Twitter" class="twitter" href="https://twitter.com/share?text=Python Table Manners - pre-commit: git commit 前做完檢查 &amp;url=https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-pre-commit" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Twitter">
<i aria-hidden="true" class="icon icon-twitter"></i><span class="hidden">Twitter</span>
</a>
<a aria-label="Facebook" class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-pre-commit" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Facebook">
<i aria-hidden="true" class="icon icon-facebook"></i><span class="hidden">Facebook</span>
</a>
<a aria-label="LinkedIn" class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-pre-commit&amp;title=Python Table Manners - pre-commit: git commit 前做完檢查" onclick="window.open(this.href, 'linkedin-share', 'width=930,height=720');return false;" title="LinkedIn">
<i aria-hidden="true" class="icon icon-linkedin"></i><span class="hidden">LinkedIn</span>
</a>
<a aria-label="Email" class="email" href="mailto:?subject=Python Table Manners - pre-commit: git commit 前做完檢查&amp;body=https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-pre-commit" title="Email">
<i aria-hidden="true" class="icon icon-mail"></i><span class="hidden">Email</span>
</a>
<div class="clear"></div>
</div>
<aside class="post-tags">
<a href="https://blog.wei-lee.me/tag/python.html">Python</a><a href="https://blog.wei-lee.me/tag/git.html">Git</a><a href="https://blog.wei-lee.me/tag/code-quality.html">Code Quality</a> </aside>
<div class="clear"></div>
<div class="series">
<p>This post is part 7 of the "Python Table Manners" series:</p>
<ol class="parts">
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-series">Python Table Manners 系列</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-dependency-mangement">Python Table Manners - 虛擬環境和套件管理</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-test-1">Python Table Manners - 測試 (一)</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-test-2">Python Table Manners - 測試 (二)</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-coding-style">Python Table Manners - 程式碼風格</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-manage-trivial-tasks">Python Table Manners - 管理繁瑣任務</a>
</li>
<li class="active">
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-pre-commit">Python Table Manners - pre-commit: git commit 前做完檢查</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/03/python-table-manners-commitizen">Python Table Manners - Commitizen: 規格化 commit message</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/03/python-table-manners-security">Python Table Manners - 安全性檢查</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/04/python-table-manners-documentation">Python Table Manners - 文件</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/12/python-table-manner-continuous-integration">Python Table Manners - 持續整合/部署</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2021/01/python-table-manners-cookiecutter">Python Table Manners - Cookiecutter 專案模板</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2021/01/python-table-manner-editor">Python Table Manners 番外 - 編輯器</a>
</li>
</ol>
</div>
</section>
<script type="text/javascript">var use_utterance = true;</script>
<section class="post-comments">
<script async="" crossorigin="anonymous" data-issue-term="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-pre-commit" data-label="blog-comment" data-repo="Lee-W/main-blog" data-theme="github-light" src="https://utteranc.es/client.js">
</script>
</section>
<aside class="post-nav">
<div class="clear"></div>
</aside>
</div>
</article>
</main>
<div class="nav-footer">
<nav aria-label="Footer" class="nav-wrapper">
<span class="nav-copy">Those aren't written down are meant to be forgotten © 2023
          <a class="nav-rss" href="https://blog.wei-lee.me/feeds/all.atom.xml" target="_blank" title="RSS"><i class="icon icon-rss"></i></a>
</span>
<span class="nav-credits">



          Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a> • Theme <a href="https://github.com/arulrajnet/attila" rel="nofollow">Attila</a> •
          <a class="menu-item js-theme" data-dark="Dark theme" data-light="Light theme" data-system="System theme" href="#">
<span class="theme-icon"></span><span class="theme-text">System theme</span>
</a>
</span>
</nav>
</div>
</section>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
<!-- TODO: minify -->
<script src="https://blog.wei-lee.me/theme/js/jquery.fitvids.js" type="text/javascript"></script>
<script src="https://blog.wei-lee.me/theme/js/script.js" type="text/javascript"></script>
<script src="https://blog.wei-lee.me/theme/js/clipboard.min.js" type="text/javascript"></script>
<script src="https://blog.wei-lee.me/theme/js/copy-to-clipboard.js" type="text/javascript"></script>
<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3J7XQ46QH5"></script>
<script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-3J7XQ46QH5', { 'anonymize_ip': true });
    </script>
<script src="/pagefind/pagefind-ui.js"></script>
<script>
      window.addEventListener('DOMContentLoaded', (event) => {
          new PagefindUI({
              element: "#search",
              showImages: false,
          });
      });
  </script>
<!-- 	The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in article.html, but it needs to be included down here, after jQuery has already loaded. -->
<!-- Add MathJax and FontAwesome for Asciidoc -->\
<script>
  $(document).ready(function () {
    var viewport = $(window);
    var post = $('.post-content');
    // Responsive videos with fitVids
    post.fitVids();

    var mdSelector=".highlight pre code";
    var rstSelector=".highlight pre code";
    // For ":source-highlighter: highlight.js`" in asciidoc
    var adocSelector="pre.highlight > code[data-lang]"
    var selector=mdSelector;
    // Format code blocks and add line numbers
    function codestyling() {
      $(selector).each(function(i, e) {
        // Code highlight
        hljs.highlightElement(e);
        // No lines for plain text blocks
        if (!$(this).hasClass('language-text')) {
          var code = $(this);
          // Calculate amount of lines
          var lines = code.html().split(/\n(?!$)/g).length;
          var numbers = [];
          if (lines > 1) {
            lines++;
          }
          for (i = 1; i < lines; i++) {
            numbers += '<span class="line" aria-hidden="true">' + i + '</span>';
          }
          code.parent().append('<div class="lines">' + numbers + '</div>');
        }
      });
    }

    // Format code blocks only
    function codestylingWithoutLineNumbers() {
      $(selector).each(function(i, e) {
        // Code highlight
        hljs.highlightElement(e);
      });
    }

    codestylingWithoutLineNumbers();
    // Reading progress bar on window top
    function readingProgress() {
      var postBottom = post.offset().top + post.height();
      var viewportHeight = viewport.height();
      var progress = 100 - (((postBottom - (viewport.scrollTop() + viewportHeight) + viewportHeight / 3) / (postBottom - viewportHeight + viewportHeight / 3)) * 100);
      $('.progress-bar').css('width', progress + '%');
      (progress > 100) ? $('.progress-container').addClass('complete'): $('.progress-container').removeClass('complete');
    }
    readingProgress();
    // Trigger reading progress
    viewport.on({
      'scroll': function() {
        readingProgress();
      },
      'resize': function() {
        readingProgress();
      },
      'orientationchange': function() {
        readingProgress();
      }
    });

  });
</script>
</body>
</html>
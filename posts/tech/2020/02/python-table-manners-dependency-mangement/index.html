
<!DOCTYPE html>

<html lang="zh-tw">
<head>
<meta charset="utf-8"/>
<meta charset="utf-8" content="text/html" http-equiv="Content-Type">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/>
<title>Python Table Manners - 虛擬環境和套件管理 </title>
<meta content="True" name="HandheldFriendly"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="origin" name="referrer"/>
<meta content="Pelican" name="generator"/>
<link href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-dependency-mangement" rel="canonical"/>
<!-- Feed -->
<link href="https://blog.wei-lee.me/feeds/all.atom.xml" rel="alternate" title="Those aren't written down are meant to be forgotten Full Atom Feed" type="application/atom+xml"/>
<!-- TODO: combine -->
<link href="https://blog.wei-lee.me/theme/css/style.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/pygments.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/pagefind-ui-custom.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/code.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/code-copy.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/custom.css" rel="stylesheet" type="text/css"/>
<link href="/pagefind/pagefind-ui.css" rel="stylesheet"/>
<!-- Custom fonts -->
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,300" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css"/>
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
<script>
    var siteUrl = 'https://blog.wei-lee.me';
  </script>
<script>
    var localTheme = localStorage.getItem('attila_theme');
    switch (localTheme) {
      case 'dark':
        document.documentElement.classList.add('theme-dark');
        break;
      case 'light':
        document.documentElement.classList.add('theme-light');
        break;
      default:
        break;
    }
  </script>
<meta content="開始 Python 專案時，第一步都是建立一個專屬於專案的虛擬環境 會需要這麼做是為了避免不同的 Python 專案需要使用到不同版本的套件 假設專案 A 需要 lib==2.3.5 而專案 B 需要 lib==1.0.0 如果 lib..." name="description"/>
<meta content="Wei Lee" name="author"/>
<meta content="Python" name="tags"/>
<meta content="Dependency" name="tags"/>
<!-- Open Graph -->
<meta content="Those aren't written down are meant to be forgotten" prefix="og: http://ogp.me/ns#" property="og:site_name">
<meta content="Python Table Manners - 虛擬環境和套件管理 " prefix="og: http://ogp.me/ns#" property="og:title">
<meta content="開始 Python 專案時，第一步都是建立一個專屬於專案的虛擬環境 會需要這麼做是為了避免不同的 Python 專案需要使用到不同版本的套件 假設專案 A 需要 lib==2.3.5 而專案 B 需要 lib==1.0.0 如果 lib..." prefix="og: http://ogp.me/ns#" property="og:description">
<meta content="zh-tw" prefix="og: http://ogp.me/ns#" property="og:locale">
<meta content="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-dependency-mangement" prefix="og: http://ogp.me/ns#" property="og:url"/>
<meta content="article" prefix="og: http://ogp.me/ns#" property="og:type"/>
<meta content="2020-02-23 12:24:00+08:00" prefix="og: http://ogp.me/ns#" property="article:published_time"/>
<meta content="2020-10-04 15:22:00+08:00" prefix="og: http://ogp.me/ns#" property="article:modified_time"/>
<meta content="https://blog.wei-lee.me/author/wei-lee.html" prefix="og: http://ogp.me/ns#" property="article:author"/>
<meta content="Tech" prefix="og: http://ogp.me/ns#" property="article:section">
<meta content="Python" prefix="og: http://ogp.me/ns#" property="article:tag"/>
<meta content="Dependency" prefix="og: http://ogp.me/ns#" property="article:tag"/>
<meta content="https://blog.wei-lee.me//images/cover.jpeg" prefix="og: http://ogp.me/ns#" property="og:image"/>
<!-- Twitter Card -->
<meta content="summary_large_image" name="twitter:card"/>
<meta content="@clleew" name="twitter:site"/>
<meta content="Python Table Manners - 虛擬環境和套件管理 " name="twitter:title"/>
<meta content="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-dependency-mangement" name="twitter:url"/>
<meta content="https://blog.wei-lee.me//images/cover.jpeg" name="twitter:image:src"/>
<meta content="開始 Python 專案時，第一步都是建立一個專屬於專案的虛擬環境 會需要這麼做是為了避免不同的 Python 專案需要使用到不同版本的套件 假設專案 A 需要 lib==2.3.5 而專案 B 需要 lib==1.0.0 如果 lib..." name="twitter:description"/>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "Python Table Manners - 虛擬環境和套件管理",
  "headline": "Python Table Manners - 虛擬環境和套件管理",
  "datePublished": "2020-02-23 12:24:00+08:00",
  "dateModified": "2020-10-04 15:22:00+08:00",
  "author": {
    "@type": "Person",
    "name": "Wei Lee",
    "url": "https://blog.wei-lee.me/author/wei-lee.html"
  },
  "image": "https://blog.wei-lee.me//images/cover.jpeg",
  "url": "https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-dependency-mangement",
  "description": "開始 Python 專案時，第一步都是建立一個專屬於專案的虛擬環境 會需要這麼做是為了避免不同的 Python 專案需要使用到不同版本的套件 假設專案 A 需要 lib==2.3.5 而專案 B 需要 lib==1.0.0 如果 lib..."
}
</script>
</meta></meta></meta></meta></meta></link></meta><link href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-dependency-mangement" rel="canonical"/><script type="application/ld+json">{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "Those aren't written down are meant to be forgotten", "item": "https://blog.wei-lee.me"}, {"@type": "ListItem", "position": 2, "name": "Posts", "item": "https://blog.wei-lee.me/posts"}, {"@type": "ListItem", "position": 3, "name": "Tech", "item": "https://blog.wei-lee.me/posts/tech"}, {"@type": "ListItem", "position": 4, "name": "2020", "item": "https://blog.wei-lee.me/posts/tech/2020"}, {"@type": "ListItem", "position": 5, "name": "02", "item": "https://blog.wei-lee.me/posts/tech/2020/02"}, {"@type": "ListItem", "position": 6, "name": "Python table manners dependency mangement", "item": "https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-dependency-mangement"}, {"@type": "ListItem", "position": 7, "name": "Index", "item": "https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-dependency-mangement/index.html"}]}</script><script type="application/ld+json">{"@context": "https://schema.org", "@type": "Article", "author": {"@type": "Person", "name": "Wei Lee"}, "publisher": {"@type": "Organization", "name": "Those aren't written down are meant to be forgotten"}, "headline": "Python Table Manners - 虛擬環境和套件管理", "about": "Tech", "datePublished": "2020-02-23 12:24"}</script></head>
<body class="category-template">
<div class="nav-header">
<nav aria-label="Main" class="nav-wrapper">
<ul>
<li class="nav-🏠 Home" role="presentation"><a href="/"><span>🏠 Home</span></a></li>
<li class="nav-About Me" role="presentation"><a href="/pages/about-me.html"><span>About Me</span></a></li>
<li class="nav-🗄️ Archives" role="presentation"><a href="/archives.html"><span>🗄️ Archives</span></a></li>
<li class="nav-📚 Series" role="presentation"><a href="/series_list.html"><span>📚 Series</span></a></li>
<li class="nav-🔍 Search" role="presentation"><a href="/search.html"><span>🔍 Search</span></a></li>
<li role="presentation"><a href="https://blog.wei-lee.me/category/book.html"><span>Book</span></a></li>
<li role="presentation"><a href="https://blog.wei-lee.me/category/gossiping.html"><span>Gossiping</span></a></li>
<li class="nav-tech active" role="presentation"><a href="https://blog.wei-lee.me/category/tech.html"><span>Tech</span></a></li>
</ul>
<ul class="nav-meta">
<li class="nav-linkedin"><a aria-label="Linkedin" href="https://tw.linkedin.com/in/clleew" target="_blank"><i aria-hidden="true" class="icon icon-linkedin"></i>
<span>Linkedin</span>
</a></li>
<li class="nav-github"><a aria-label="Github" href="https://github.com/Lee-W" target="_blank"><i aria-hidden="true" class="icon icon-github"></i>
<span>GitHub</span>
</a></li>
<li class="nav-twitter"><a aria-label="Twitter" href="https://twitter.com/clleew" target="_blank"><i aria-hidden="true" class="icon icon-twitter"></i>
<span>Twitter</span>
</a></li>
<li class="nav-search" style="display: none;">
<a title="Search">
<i aria-hidden="true" class="icon icon-search"></i>
<span>Search</span>
</a>
</li>
</ul> </nav>
<div class="nav-wrapper-control">
<div class="inner">
<a class="nav-menu" role="button"><i aria-hidden="true" class="icon icon-menu"></i>Menu</a>
<a class="nav-search" role="button" style="display: none;" title="Search"><i aria-hidden="true" class="icon icon-search"></i></a>
</div>
</div>
</div>
<div aria-label="Close" class="nav-close" role="button"></div>
<section class="page-wrapper" id="wrapper">
<!-- Progressbar -->
<div class="progress-container">
<span class="progress-bar"></span>
</div>
<!-- Page Header -->
<!-- Set your background image for this header on the line below. -->
<header class="post-header has-cover">
<div class="inner">
<span class="post-info">
<span class="post-type">Article</span>
<span class="post-count">Tech</span>
</span>
<h1 class="post-title">
            Python Table Manners - 虛擬環境和套件管理
        </h1>
<div class="post-meta">
<div class="post-meta-avatars">
<figure class="post-meta-avatar avatar">
<a class="author-avatar" href="https://blog.wei-lee.me/author/wei-lee.html">
<img alt="Wei Lee" class="author-profile-image" src="https://blog.wei-lee.me//images/avatar.jpeg"/>
</a>
</figure>
</div>
<h4 class="post-meta-author">
            Wei Lee
          </h4>
<time datetime="2020/02/23 - Sun">2020/02/23 - Sun</time>
          • <time datetime="2020/10/04 - Sun"> Updated on 2020/10/04 - Sun</time>
          • 2 min read
        </div>
<div class="post-cover cover">
<img alt="Category Tech" src="https://blog.wei-lee.me//images/cover.jpeg"/>
</div>
</div>
</header>
<!-- Post content -->
<main class="content" data-pagefind-body="" role="main">
<article class="post">
<div class="inner">
<section class="post-content">
<p>開始 Python 專案時，第一步都是建立一個專屬於專案的虛擬環境<br/>
會需要這麼做是為了避免不同的 Python 專案需要使用到不同版本的套件<br/>
假設專案 A 需要 <code>lib==2.3.5</code> 而專案 B 需要 <code>lib==1.0.0</code><br/>
如果 <code>lib</code> 都被安裝在本機中，就會有其中一個專案跑不起來<br/>
所以只要兩個專案都有建立虛擬環境，它們就都能在自己的虛擬環境中安裝所需的 <code>lib</code> 版本<br/>
理想上，本機的環境是不需要安裝套件的<br/>
因為每一個專案都會在個字的虛擬環境內執行，並安裝各自的套件</p>
<!--more-->
<div class="toc">
<ul>
<li><a href="#venv">venv</a></li>
<li><a href="#pipenv">pipenv</a><ul>
<li><a href="#pipenv_1">安裝 pipenv</a></li>
<li><a href="#_1">初始化環境</a></li>
<li><a href="#_2">安裝套件</a></li>
<li><a href="#_3">安裝開發環境套件</a></li>
<li><a href="#_4">在虛擬環境中執行指令</a></li>
<li><a href="#_5">其他功能</a></li>
</ul>
</li>
<li><a href="#poetry">Poetry</a><ul>
<li><a href="#_6">基本使用</a></li>
</ul>
</li>
<li><a href="#_7">其他工具</a><ul>
<li><a href="#pip-tools">pip-tools</a></li>
<li><a href="#dephell">dephell</a></li>
<li><a href="#_8">自動偵測套件版本並適當升級的服務</a></li>
</ul>
</li>
<li><a href="#bouns-pipx-python">Bouns: pipx - 在系統安裝 Python 工具</a></li>
<li><a href="#reference">Reference</a></li>
</ul>
</div>
<h2 id="venv">venv</h2>
<p>建立虛擬環境，最基本作法是使用 <a href="https://docs.python.org/3/library/venv.html">venv</a><br/>
透過以下幾個指令建立，並把需要的套件寫入 <code>requirements.txt</code></p>
<div class="highlight"><pre><span></span><code><span class="c1"># 建立 Python 虛擬環境到 ./venv</span>
python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>./venv

<span class="c1"># 啟動 Python 虛擬環境 (for Unix like)</span>
<span class="nb">source</span><span class="w"> </span>venv/bin/activate

<span class="c1"># 將虛擬環境用到的套件寫入 requirements.txt</span>
pip<span class="w"> </span>freeze<span class="w"> </span>&gt;&gt;<span class="w"> </span>requirements.txt
</code></pre></div>
<p>p.s. 基本上這個系列文會以 Unix 系統（macOS, Linux）為主</p>
<p>但這個做法會遇到幾個問題</p>
<ol>
<li>忘記開啟/關閉虛擬環境</li>
<li>忘記把新安裝的套件寫入 requirements.txt</li>
<li><code>pip freeze</code> 安裝一些不必要的套件</li>
</ol>
<p>一開始我會使用 <a href="https://github.com/bndr/pipreqs">pipreqs</a> 來解決 <code>pip freeze</code> 所造成的雜亂<br/>
但是忘記更新 requirements.txt 跟開關虛擬環境的問題還是存在<br/>
常常我在本地測試成功，push 到遠端的時候又告訴我少了套件<br/>
只好再送一個 Pull Request 修正......</p>
<h2 id="pipenv">pipenv</h2>
<p><a href="https://pipenv.readthedocs.io/en/latest/">pipenv</a> 可以用來同時管理虛擬環境跟套件<br/>
pipenv 不使用 <code>requriements.txt</code>，而是使用自定義的 <code>Pipfile</code> 跟 <code>Pipfile.lock</code> 管理套件<br/>
它的好處是能透過單一指令將套件安裝到虛擬環境中，並且更新到 <code>Pipfile</code> 以及 <code>Pipfile.lock</code></p>
<h3 id="pipenv_1">安裝 pipenv</h3>
<p>根據不同的系統，可以在 <a href="https://pipenv.readthedocs.io/en/latest/install/#installing-pipenv">Installing Pipenv</a> 找到安裝 pipenv 的方式</p>
<p>不過最簡單的做法還是透過 <code>pip</code> 安裝</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>pipenv
</code></pre></div>
<h3 id="_1">初始化環境</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 初始化虛擬環境</span>
<span class="c1"># 如果 Pipfile 跟 Pipfile.lock 還不存在，則會產生</span>
pipenv<span class="w"> </span>install

<span class="c1"># 指定用特定版本的 Python 來產生虛擬環境</span>
pipenv<span class="w"> </span>install<span class="w"> </span>--python<span class="w"> </span><span class="m">3</span>.6.4

<span class="c1"># 移除虛擬環境</span>
pipenv<span class="w"> </span>--rm

<span class="c1"># 列出虛擬環境的所在位置</span>
pipenv<span class="w"> </span>--where
</code></pre></div>
<p>初始化虛擬環境後，會產生 <code>Pipfile</code> 跟 <code>Pipfile.lock</code></p>
<ul>
<li><code>Pipfile</code> 是 <a href="https://github.com/toml-lang/toml">toml</a> 格式的檔案<ul>
<li><strong>source</strong>: 指定要去找套件的倉儲，預設是 <a href="https://pypi.org/">PyPI</a> ，也可以再加上私有的 PyPI</li>
<li><strong>dev-package</strong>: 開發環境所需套件</li>
<li><strong>packages</strong>: 預設安裝套件（通常是 Production 用）</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">[[source]]</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"pypi"</span>
<span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://pypi.org/simple"</span>
<span class="n">verify_ssl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>

<span class="k">[dev-packages]</span>

<span class="k">[packages]</span>

<span class="k">[requires]</span>
<span class="n">python_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"3.7"</span>
</code></pre></div>
<ul>
<li><code>Pipfile.lock</code> 是 JSON 格式的檔案<ul>
<li>同樣是記錄安裝的套件，但會同時記錄下套件相依的其他套件（假設安裝了 <code>requests</code> 套件，而 <code>requests</code> 相依於 <code>urllib3</code> ，則 <code>requests</code> 跟 <code>urllibs</code> 都會列在這）</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">"_meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"hash"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"sha256"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">"pipfile-spec"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"requires"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"python_version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.7"</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">"sources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pypi"</span><span class="p">,</span>
<span class="w">                </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://pypi.org/simple"</span><span class="p">,</span>
<span class="w">                </span><span class="nt">"verify_ssl"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">"default"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">    </span><span class="nt">"develop"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>
<p>通常沒有什麼特別的理由，可以不用動到 <code>Pipfile</code> 跟 <code>Pipfile.lock</code><br/>
交給 <code>pipenv</code> 管理就好</p>
<h3 id="_2">安裝套件</h3>
<p>pipenv 的另一個好處是，它的 API 基本上跟 <a href="https://pip.pypa.io/en/stable/">pip</a> 是一樣的</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 安裝套件</span>
pipenv<span class="w"> </span>install<span class="w"> </span>&lt;package&gt;<span class="o">==</span>&lt;version&gt;

<span class="c1"># 解除安裝套件</span>
pipenv<span class="w"> </span>uninstall<span class="w"> </span>&lt;package&gt;

<span class="c1"># 更新套件</span>
pipenv<span class="w"> </span>update<span class="w"> </span>&lt;package&gt;
</code></pre></div>
<p>以安裝 <a href="https://requests.readthedocs.io/en/master/">requests</a> 為例<br/>
會更新在 Pipfile 的 <strong>packages</strong> 區段</p>
<div class="highlight"><pre><span></span><code><span class="k">[packages]</span>
<span class="n">requests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"*"</span>
</code></pre></div>
<p>Pipfile.lock 中除了 <code>requests</code> 外，還會列出 <code>requests</code> 的相依套件 <code>urllib3</code> (Ref: <a href="https://github.com/psf/requests/blob/v2.22.0/setup.py#L47">setup.py#L47</a>)</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="err">......</span>
<span class="w">    </span><span class="nt">"default"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">......</span>

<span class="w">        </span><span class="nt">"requests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"hashes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s2">"sha256:11e007a8a2aa0323f5a921e9e6a2d7e4e67d9877e85773fba9ba6419025cbeb4"</span><span class="p">,</span>
<span class="w">                </span><span class="s2">"sha256:9cf5292fcd0f598c671cfc1e0d7d1a7f13bb8085e9a590f48c010551dc6c4b31"</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pypi"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"==2.22.0"</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">"urllib3"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"hashes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s2">"sha256:3de946ffbed6e6746608990594d08faac602528ac7015ac28d33cee6a45b7398"</span><span class="p">,</span>
<span class="w">                </span><span class="s2">"sha256:9a107b99a5393caf59c7aa3c1249c16e6879447533d0887f4336dde834c7be86"</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"==1.25.6"</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="err">......</span>
<span class="p">}</span>
</code></pre></div>
<p>可以注意到每個安裝的套件會有三個欄位 <strong>index</strong>, <strong>version</strong> 和 <strong>hashes</strong></p>
<ul>
<li><strong>index</strong>: 套件從哪裡裝的</li>
<li><strong>version</strong>: 安裝的版本</li>
<li><strong>hashes</strong>: 下載這個套件時產生的雜湊值 (hashing)<br/>
  只要套件內容有改變，就會產生不同的雜湊值<br/>
  可以用於驗證下次安裝時，這個套件的內容是否跟這次相同<br/>
  有些套件雖然改了內容，但沒有更新版本號<br/>
  雜湊值可以用來避免使用者在沒注意到的情況下安裝了不同的套件</li>
</ul>
<p>下面兩個指令就會運用到 <strong>hashes</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># 安裝時同時確認 Pipfile.lock ，如果 lock 檔跟實際安裝的有衝突，則會取消安裝</span>
pipenv<span class="w"> </span>install<span class="w"> </span>--deploy

<span class="c1"># 直接使用 Pipfile.lock 安裝套件</span>
pipenv<span class="w"> </span>install<span class="w"> </span>--ignore-pipfile
</code></pre></div>
<h3 id="_3">安裝開發環境套件</h3>
<p>有些套件（e.g., 測試工具）不需要在 Production 的環境上安裝<br/>
以往會將不同的套件用不同的 <code>requirements.txt</code> 來管理 (e.g.,  <code>requirments/dev.txt</code>, <code>requirements/prod.txt</code>)<br/>
pipenv 則是將開發環境才需要的套件寫在 Pipfile 的 <strong>dev-packages</strong> 內<br/>
只要在安裝時後面加上選項 <code>--dev</code></p>
<p>e.g.,</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 安裝開發環境套件</span>
pipenv<span class="w"> </span>install<span class="w"> </span>&lt;package&gt;<span class="o">==</span>&lt;version&gt;<span class="w"> </span>--dev
</code></pre></div>
<h3 id="_4">在虛擬環境中執行指令</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 在虛擬環境中執行 [command]</span>
pipenv<span class="w"> </span>run<span class="w"> </span>&lt;command&gt;

<span class="c1"># e.g.,</span>
pipenv<span class="w"> </span>run<span class="w"> </span>python<span class="w"> </span>your_program.py
</code></pre></div>
<p>雖然可以透過 <code>pipenv shell</code> 進入到虛擬環境，但我不太建議使用<br/>
原因是我常常會進入虛擬環境後，亂下 <code>pip install &lt;package&gt;</code> 的指令<br/>
然後就沒被 Pipfile 給記錄到...</p>
<h3 id="_5">其他功能</h3>
<ul>
<li><code>pipenv check</code>: 檢查安裝的套件是否有已知的安全性問題</li>
<li><code>pipenv graph</code>: 檢視整個相依套件的相依圖</li>
<li><code>pipenv open &lt;package&gt;</code>: 開啟安裝的套件（不知道什麼時候養成了「懶得看文件，直接 trace code」的習慣...）</li>
</ul>
<h2 id="poetry">Poetry</h2>
<p><a href="https://python-poetry.org/">poetry</a> 是目前很多人說可以取代 pipenv 的工具<br/>
除了 pipenv 包含的功能外，它還能用來初始化專案、上傳套件</p>
<ul>
<li>pipenv 被抱怨的原因<ul>
<li>之前有相隔快兩年沒有新的版本釋出（2020 年倒是更新了幾次）</li>
<li>lock 太慢</li>
<li>不會自動跟 setup.py 中的 <code>install_rquires</code></li>
</ul>
</li>
</ul>
<p>poetry 使用下來體驗還算不錯<br/>
而且它採用 pyproject.toml 來做配置設定，這點我就蠻喜歡的</p>
<p>我會建議如果要寫 Python 函式庫的話，可以使用 poetry<br/>
至於 Python 應用，使用 pipenv 還是 poetry 就看個人的喜好了</p>
<h3 id="_6">基本使用</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 初始化 poetry 專案</span>
poetry<span class="w"> </span>init

<span class="c1"># 安裝套件</span>
poetry<span class="w"> </span>install

<span class="c1"># 加入新的套件</span>
poetry<span class="w"> </span>add<span class="w"> </span>&lt;package&gt;

<span class="c1"># 移除套件</span>
poetry<span class="w"> </span>remove<span class="w"> </span>&lt;package&gt;
</code></pre></div>
<h2 id="_7">其他工具</h2>
<h3 id="pip-tools">pip-tools</h3>
<p><a href="https://github.com/jazzband/pip-tools">pip-tools</a> 主要的功能是產生 hashes ，並不能用來管理虛擬環境<br/>
這套工具比較適合習慣使用 pip 跟 virtualenv ，但又想要有 Pipfile.lock 的功能的情況</p>
<h3 id="dephell">dephell</h3>
<p><a href="https://github.com/dephell/dephell">dephell</a> 是個 all-in-one 的工具<br/>
當初看到覺得很有趣，但還沒有時間好好研究<br/>
目前使用到對我最有幫助的功能是它能在轉換不同的格式 (e.g., Pipfile → pyproject.toml)</p>
<h3 id="_8">自動偵測套件版本並適當升級的服務</h3>
<ul>
<li><a href="https://pyup.io">pyup.io</a></li>
<li><a href="https://dependabot.com">dependabot</a></li>
</ul>
<h2 id="bouns-pipx-python">Bouns: pipx - 在系統安裝 Python 工具</h2>
<p>雖然建議 Python 的套件都裝在虛擬環境，但如果平時要使用的工具 (e.g., <a href="http://www.pyinvoke.org/">invoke</a>, <a href="https://pypi.org/project/awscli/">awscli</a>) 都裝在虛擬環境<br/>
每次使用這些工具都得進入虛擬環境就太麻煩了<br/>
<a href="https://pipxproject.github.io/pipx/">pipx</a> 會為每個工具創建一個專屬的虛擬環境，並且設定好 PATH</p>
<ul>
<li>安裝 pipx，並設定 PATH</li>
</ul>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>pipx
python<span class="w"> </span>-m<span class="w"> </span>pipx<span class="w"> </span>ensurepath
</code></pre></div>
<ul>
<li>安裝工具</li>
</ul>
<div class="highlight"><pre><span></span><code>pipx<span class="w"> </span>install<span class="w"> </span><span class="o">[</span>package<span class="o">]</span>
</code></pre></div>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://wei-lee.me/pycon-note/posts/pycon-tw-2018/2019/10/is-your-dev-env-alright/">這樣的開發環境沒問題嗎？ - PyCon TW 2018</a></li>
<li><a href="https://wei-lee.me/pycon-note/posts/pycon-us-2018/2019/11/pipenv-the-future-of-python-dependency-management/">Pipenv: The Future of Python Dependency Management - PyCon US 2018</a></li>
<li><a href="https://wei-lee.me/pycon-note/posts/pycon-de-2018/2019/12/python-dependency-management/">Python Dependency Management - PyCon DE 2018</a></li>
</ul>
</section>
<section class="post-footer">
<div class="post-share">
<span class="post-info-label">Share</span>
<a aria-label="Twitter" class="twitter" href="https://twitter.com/share?text=Python Table Manners - 虛擬環境和套件管理 &amp;url=https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-dependency-mangement" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Twitter">
<i aria-hidden="true" class="icon icon-twitter"></i><span class="hidden">Twitter</span>
</a>
<a aria-label="Facebook" class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-dependency-mangement" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Facebook">
<i aria-hidden="true" class="icon icon-facebook"></i><span class="hidden">Facebook</span>
</a>
<a aria-label="LinkedIn" class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-dependency-mangement&amp;title=Python Table Manners - 虛擬環境和套件管理" onclick="window.open(this.href, 'linkedin-share', 'width=930,height=720');return false;" title="LinkedIn">
<i aria-hidden="true" class="icon icon-linkedin"></i><span class="hidden">LinkedIn</span>
</a>
<a aria-label="Email" class="email" href="mailto:?subject=Python Table Manners - 虛擬環境和套件管理&amp;body=https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-dependency-mangement" title="Email">
<i aria-hidden="true" class="icon icon-mail"></i><span class="hidden">Email</span>
</a>
<div class="clear"></div>
</div>
<aside class="post-tags">
<a href="https://blog.wei-lee.me/tag/python.html">Python</a><a href="https://blog.wei-lee.me/tag/dependency.html">Dependency</a> </aside>
<div class="clear"></div>
<div class="series">
<p>This post is part 2 of the "Python Table Manners" series:</p>
<ol class="parts">
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-series">Python Table Manners 系列</a>
</li>
<li class="active">
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-dependency-mangement">Python Table Manners - 虛擬環境和套件管理</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-test-1">Python Table Manners - 測試 (一)</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-test-2">Python Table Manners - 測試 (二)</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-coding-style">Python Table Manners - 程式碼風格</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-manage-trivial-tasks">Python Table Manners - 管理繁瑣任務</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-pre-commit">Python Table Manners - pre-commit: git commit 前做完檢查</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/03/python-table-manners-commitizen">Python Table Manners - Commitizen: 規格化 commit message</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/03/python-table-manners-security">Python Table Manners - 安全性檢查</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/04/python-table-manners-documentation">Python Table Manners - 文件</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/12/python-table-manner-continuous-integration">Python Table Manners - 持續整合/部署</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2021/01/python-table-manners-cookiecutter">Python Table Manners - Cookiecutter 專案模板</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2021/01/python-table-manner-editor">Python Table Manners 番外 - 編輯器</a>
</li>
</ol>
</div>
</section>
<script type="text/javascript">var use_utterance = true;</script>
<section class="post-comments">
<script async="" crossorigin="anonymous" data-issue-term="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-dependency-mangement" data-label="blog-comment" data-repo="Lee-W/main-blog" data-theme="github-light" src="https://utteranc.es/client.js">
</script>
</section>
<aside class="post-nav">
<div class="clear"></div>
</aside>
</div>
</article>
</main>
<div class="nav-footer">
<nav aria-label="Footer" class="nav-wrapper">
<span class="nav-copy">Those aren't written down are meant to be forgotten © 2023
          <a class="nav-rss" href="https://blog.wei-lee.me/feeds/all.atom.xml" target="_blank" title="RSS"><i class="icon icon-rss"></i></a>
</span>
<span class="nav-credits">



          Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a> • Theme <a href="https://github.com/arulrajnet/attila" rel="nofollow">Attila</a> •
          <a class="menu-item js-theme" data-dark="Dark theme" data-light="Light theme" data-system="System theme" href="#">
<span class="theme-icon"></span><span class="theme-text">System theme</span>
</a>
</span>
</nav>
</div>
</section>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<!-- TODO: minify -->
<script src="https://blog.wei-lee.me/theme/js/jquery.fitvids.js" type="text/javascript"></script>
<script src="https://blog.wei-lee.me/theme/js/script.js" type="text/javascript"></script>
<script src="https://blog.wei-lee.me/theme/js/clipboard.min.js" type="text/javascript"></script>
<script src="https://blog.wei-lee.me/theme/js/copy-to-clipboard.js" type="text/javascript"></script>
<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3J7XQ46QH5"></script>
<script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-3J7XQ46QH5', { 'anonymize_ip': true });
    </script>
<script src="/pagefind/pagefind-ui.js"></script>
<script>
      window.addEventListener('DOMContentLoaded', (event) => {
          new PagefindUI({
              element: "#search",
              showImages: false,
          });
      });
  </script>
<!-- 	The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in article.html, but it needs to be included down here, after jQuery has already loaded. -->
<script>
  $(document).ready(function () {
    var viewport = $(window);
    var post = $('.post-content');
    // Responsive videos with fitVids
    post.fitVids();

    // Reading progress bar on window top
    function readingProgress() {
      var postBottom = post.offset().top + post.height();
      var viewportHeight = viewport.height();
      var progress = 100 - (((postBottom - (viewport.scrollTop() + viewportHeight) + viewportHeight / 3) / (postBottom - viewportHeight + viewportHeight / 3)) * 100);
      $('.progress-bar').css('width', progress + '%');
      (progress > 100) ? $('.progress-container').addClass('complete'): $('.progress-container').removeClass('complete');
    }
    readingProgress();
    // Trigger reading progress
    viewport.on({
      'scroll': function() {
        readingProgress();
      },
      'resize': function() {
        readingProgress();
      },
      'orientationchange': function() {
        readingProgress();
      }
    });

  });
</script>
</body>
</html>
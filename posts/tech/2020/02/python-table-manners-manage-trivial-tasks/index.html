
<!DOCTYPE html>

<html lang="zh-tw">
<head>
<meta charset="utf-8"/>
<meta charset="utf-8" content="text/html" http-equiv="Content-Type">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/>
<title>Python Table Manners - 管理繁瑣任務 </title>
<meta content="True" name="HandheldFriendly"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="origin" name="referrer"/>
<meta content="Pelican" name="generator"/>
<link href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-manage-trivial-tasks" rel="canonical"/>
<!-- Feed -->
<link href="https://blog.wei-lee.me/feeds/all.atom.xml" rel="alternate" title="Those aren't written down are meant to be forgotten Full Atom Feed" type="application/atom+xml"/>
<!-- TODO: combine -->
<link href="https://blog.wei-lee.me/theme/css/style.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/pygments.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/pagefind-ui-custom.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/code.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/code-copy.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/custom.css" rel="stylesheet" type="text/css"/>
<link href="/pagefind/pagefind-ui.css" rel="stylesheet"/>
<!-- Custom fonts -->
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,300" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css"/>
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
<script>
    var siteUrl = 'https://blog.wei-lee.me';
  </script>
<script>
    var localTheme = localStorage.getItem('attila_theme');
    switch (localTheme) {
      case 'dark':
        document.documentElement.classList.add('theme-dark');
        break;
      case 'light':
        document.documentElement.classList.add('theme-light');
        break;
      default:
        break;
    }
  </script>
<meta content="前面幾篇從套件管理、虛擬環境、測試、風格檢查到自動排版，提到了很多的工具 每一個工具又有各自的參數和設定 這麼多指令怎麼可能記得起來 😱" name="description"/>
<meta content="Wei Lee" name="author"/>
<meta content="Python" name="tags"/>
<meta content="Task" name="tags"/>
<!-- Open Graph -->
<meta content="Those aren't written down are meant to be forgotten" prefix="og: http://ogp.me/ns#" property="og:site_name">
<meta content="Python Table Manners - 管理繁瑣任務 " prefix="og: http://ogp.me/ns#" property="og:title">
<meta content="前面幾篇從套件管理、虛擬環境、測試、風格檢查到自動排版，提到了很多的工具 每一個工具又有各自的參數和設定 這麼多指令怎麼可能記得起來 😱" prefix="og: http://ogp.me/ns#" property="og:description">
<meta content="zh-tw" prefix="og: http://ogp.me/ns#" property="og:locale">
<meta content="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-manage-trivial-tasks" prefix="og: http://ogp.me/ns#" property="og:url"/>
<meta content="article" prefix="og: http://ogp.me/ns#" property="og:type"/>
<meta content="2020-02-27 20:04:00+08:00" prefix="og: http://ogp.me/ns#" property="article:published_time"/>
<meta content="2022-02-03 16:12:00+08:00" prefix="og: http://ogp.me/ns#" property="article:modified_time"/>
<meta content="https://blog.wei-lee.me/author/wei-lee.html" prefix="og: http://ogp.me/ns#" property="article:author"/>
<meta content="Tech" prefix="og: http://ogp.me/ns#" property="article:section">
<meta content="Python" prefix="og: http://ogp.me/ns#" property="article:tag"/>
<meta content="Task" prefix="og: http://ogp.me/ns#" property="article:tag"/>
<meta content="https://blog.wei-lee.me//images/cover.jpeg" prefix="og: http://ogp.me/ns#" property="og:image"/>
<!-- Twitter Card -->
<meta content="summary_large_image" name="twitter:card"/>
<meta content="@clleew" name="twitter:site"/>
<meta content="Python Table Manners - 管理繁瑣任務 " name="twitter:title"/>
<meta content="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-manage-trivial-tasks" name="twitter:url"/>
<meta content="https://blog.wei-lee.me//images/cover.jpeg" name="twitter:image:src"/>
<meta content="前面幾篇從套件管理、虛擬環境、測試、風格檢查到自動排版，提到了很多的工具 每一個工具又有各自的參數和設定 這麼多指令怎麼可能記得起來 😱" name="twitter:description"/>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "Python Table Manners - 管理繁瑣任務",
  "headline": "Python Table Manners - 管理繁瑣任務",
  "datePublished": "2020-02-27 20:04:00+08:00",
  "dateModified": "2022-02-03 16:12:00+08:00",
  "author": {
    "@type": "Person",
    "name": "Wei Lee",
    "url": "https://blog.wei-lee.me/author/wei-lee.html"
  },
  "image": "https://blog.wei-lee.me//images/cover.jpeg",
  "url": "https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-manage-trivial-tasks",
  "description": "前面幾篇從套件管理、虛擬環境、測試、風格檢查到自動排版，提到了很多的工具 每一個工具又有各自的參數和設定 這麼多指令怎麼可能記得起來 😱"
}
</script>
</meta></meta></meta></meta></meta></link></meta><link href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-manage-trivial-tasks" rel="canonical"/><script type="application/ld+json">{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "Those aren't written down are meant to be forgotten", "item": "https://blog.wei-lee.me"}, {"@type": "ListItem", "position": 2, "name": "Posts", "item": "https://blog.wei-lee.me/posts"}, {"@type": "ListItem", "position": 3, "name": "Tech", "item": "https://blog.wei-lee.me/posts/tech"}, {"@type": "ListItem", "position": 4, "name": "2020", "item": "https://blog.wei-lee.me/posts/tech/2020"}, {"@type": "ListItem", "position": 5, "name": "02", "item": "https://blog.wei-lee.me/posts/tech/2020/02"}, {"@type": "ListItem", "position": 6, "name": "Python table manners manage trivial tasks", "item": "https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-manage-trivial-tasks"}, {"@type": "ListItem", "position": 7, "name": "Index", "item": "https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-manage-trivial-tasks/index.html"}]}</script><script type="application/ld+json">{"@context": "https://schema.org", "@type": "Article", "author": {"@type": "Person", "name": "Wei Lee"}, "publisher": {"@type": "Organization", "name": "Those aren't written down are meant to be forgotten"}, "headline": "Python Table Manners - 管理繁瑣任務", "about": "Tech", "datePublished": "2020-02-27 20:04"}</script></head>
<body class="category-template">
<div class="nav-header">
<nav aria-label="Main" class="nav-wrapper">
<ul>
<li class="nav-🏠 Home" role="presentation"><a href="/"><span>🏠 Home</span></a></li>
<li class="nav-About Me" role="presentation"><a href="/pages/about-me.html"><span>About Me</span></a></li>
<li class="nav-👨‍💻 Tech active" role="presentation"><a href="/category/tech.html"><span>👨‍💻 Tech</span></a></li>
<li class="nav-📚 Book Digest" role="presentation"><a href="/category/book.html"><span>📚 Book Digest</span></a></li>
<li class="nav-💬 Gossiping" role="presentation"><a href="/category/gossiping.html"><span>💬 Gossiping</span></a></li>
<li class="nav-🏷️ Tags" role="presentation"><a href="/tags.html"><span>🏷️ Tags</span></a></li>
<li class="nav-🗄️ Archives" role="presentation"><a href="/archives.html"><span>🗄️ Archives</span></a></li>
<li class="nav-📚 Series" role="presentation"><a href="/series_list.html"><span>📚 Series</span></a></li>
<li class="nav-🔍 Search" role="presentation"><a href="/search.html"><span>🔍 Search</span></a></li>
</ul>
<ul class="nav-meta">
<li class="nav-linkedin"><a aria-label="Linkedin" href="https://tw.linkedin.com/in/clleew" target="_blank"><i aria-hidden="true" class="icon icon-linkedin"></i>
<span>Linkedin</span>
</a></li>
<li class="nav-github"><a aria-label="Github" href="https://github.com/Lee-W" target="_blank"><i aria-hidden="true" class="icon icon-github"></i>
<span>GitHub</span>
</a></li>
<li class="nav-twitter"><a aria-label="Twitter" href="https://twitter.com/clleew" target="_blank"><i aria-hidden="true" class="icon icon-twitter"></i>
<span>Twitter</span>
</a></li>
<li class="nav-search" style="display: none;">
<a title="Search">
<i aria-hidden="true" class="icon icon-search"></i>
<span>Search</span>
</a>
</li>
</ul> </nav>
<div class="nav-wrapper-control">
<div class="inner">
<a class="nav-menu" role="button"><i aria-hidden="true" class="icon icon-menu"></i>Menu</a>
<a class="nav-search" role="button" style="display: none;" title="Search"><i aria-hidden="true" class="icon icon-search"></i></a>
</div>
</div>
</div>
<div aria-label="Close" class="nav-close" role="button"></div>
<section class="page-wrapper" id="wrapper">
<!-- Progressbar -->
<div class="progress-container">
<span class="progress-bar"></span>
</div>
<!-- Page Header -->
<!-- Set your background image for this header on the line below. -->
<header class="post-header has-cover">
<div class="inner">
<span class="post-info">
<span class="post-type">Article</span>
<span class="post-count">Tech</span>
</span>
<h1 class="post-title">
            Python Table Manners - 管理繁瑣任務
        </h1>
<div class="post-meta">
<div class="post-meta-avatars">
<figure class="post-meta-avatar avatar">
<a class="author-avatar" href="https://blog.wei-lee.me/author/wei-lee.html">
<img alt="Wei Lee" class="author-profile-image" src="https://blog.wei-lee.me//images/avatar.jpeg"/>
</a>
</figure>
</div>
<h4 class="post-meta-author">
            Wei Lee
          </h4>
<time datetime="2020/02/27 - Thu">2020/02/27 - Thu</time>
          • <time datetime="2022/02/03 - Thu"> Updated on 2022/02/03 - Thu</time>
          • 3 min read
        </div>
<div class="post-cover cover">
<img alt="Category Tech" src="https://blog.wei-lee.me//images/cover.jpeg"/>
</div>
</div>
</header>
<!-- Post content -->
<main class="content" data-pagefind-body="" role="main">
<article class="post">
<div class="inner">
<section class="post-content">
<p>前面幾篇從套件管理、虛擬環境、測試、風格檢查到自動排版，提到了很多的工具<br/>
每一個工具又有各自的參數和設定<br/>
這麼多指令怎麼可能記得起來 😱</p>
<p><img alt="too-many-commands" src="/images/posts-image/2020-02-22-python-table-manner-series/too-many-commands.jpg"/></p>
<!--more-->
<p>所以在這篇要介紹如何用 <a href="http://www.pyinvoke.org/">invoke</a> 管理這些指令</p>
<div class="toc">
<ul>
<li><a href="#invoke">invoke 是什麼</a></li>
<li><a href="#invoke_1">安裝 invoke</a></li>
<li><a href="#invoke_2">如何使用 invoke</a></li>
<li><a href="#invoke_3">實作 invoke 任務</a></li>
<li><a href="#_1">任務相依</a></li>
<li><a href="#_2">任務模組化</a></li>
<li><a href="#auto-completion">自動補完 （Auto-completion）</a></li>
<li><a href="#makefile">為什麼不用 Makefile 就好？</a></li>
<li><a href="#_3">其他進階應用</a></li>
<li><a href="#reference">Reference</a></li>
</ul>
</div>
<h2 id="invoke">invoke 是什麼</h2>
<p>invoke 是一套任務執行工具 (task execution tool)，主要用來是統一管理各種指令<br/>
有點像是 Python 的 <code>Makefile</code></p>
<h2 id="invoke_1">安裝 invoke</h2>
<p>不同於 pytest, flake8 等套件，我會同時將 invoke 安裝在系統和虛擬環境中</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 安裝 invoke 到系統</span>
pipx<span class="w"> </span>install<span class="w"> </span>invoke

<span class="c1"># 安裝 invoke 到虛擬環境中</span>
pipenv<span class="w"> </span>install<span class="w"> </span>invoke<span class="w"> </span>--dev
</code></pre></div>
<p>裝在系統的原因是想把它當成類似 <code>make</code> 的指令來使用</p>
<p>在虛擬環境還需要裝的原因是，部署時系統通常不會預裝 invoke<br/>
如果想在部署時也能使用 invoke 的功能，最方便的方法透過 pipenv 安裝</p>
<h2 id="invoke_2">如何使用 invoke</h2>
<p>再回到 <a href="https://github.com/pycontw/pycontw-postevent-report-generator">pycontw-postevent-report-generator</a> 的例子<br/>
checkout 到 <a href="https://github.com/pycontw/pycontw-postevent-report-generator/tree/83e48c6443303045ed1de2f020297c3110bb1300">commit 83e4</a>，回到使用 invoke 管理指令前<br/>
從當時的文件可以看到，還需要使用相對冗長的指令</p>
<p><img alt="before-invoke" src="/images/posts-image/2020-02-22-python-table-manner-series/before-invoke.jpg"/></p>
<p>到了 <a href="https://github.com/pycontw/pycontw-postevent-report-generator/tree/72ad956fd200867dc292a156c97a99a09ebe0104">commit 72ad</a> (實作已經在 <a href="https://github.com/pycontw/pycontw-postevent-report-generator/commit/bc98eec28037a9bed5063fef0f0f564893fce3ac">commit bc98</a> 完成，只是在 commit 72ad 才更新文件)，已經可以使用較短且較為統一的指令 (以 <code>inv</code> 作為開頭)</p>
<p><img alt="after-invoke" src="/images/posts-image/2020-02-22-python-table-manner-series/after-invoke.jpg"/></p>
<p>除此之外，引入 invoke 後，也不用每次都去翻文件<br/>
<code>invoke --list</code> 可以列出所有可用的指令</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 列出可用的 invoke 指令</span>
<span class="c1"># p.s. invoke 指令可以縮寫為 inv</span>
$<span class="w"> </span>inv<span class="w"> </span>--list

Available<span class="w"> </span>tasks:

<span class="w">  </span>clean<span class="w">      </span>Remove<span class="w"> </span>all<span class="w"> </span>the<span class="w"> </span>tmp<span class="w"> </span>files<span class="w"> </span><span class="k">in</span><span class="w"> </span>.gitignore
<span class="w">  </span>develop<span class="w">    </span>Install<span class="w"> </span>script<span class="w"> </span><span class="k">in</span><span class="w"> </span>pipenv<span class="w"> </span>environment<span class="w"> </span><span class="k">in</span><span class="w"> </span>development<span class="w"> </span>mode
<span class="w">  </span>init-dev<span class="w">   </span>Install<span class="w"> </span>development<span class="w"> </span>dependencies
<span class="w">  </span>install<span class="w">    </span>Install<span class="w"> </span>script<span class="w"> </span><span class="k">in</span><span class="w"> </span>pipenv<span class="w"> </span>environment
<span class="w">  </span><span class="nb">test</span><span class="w">       </span>Run<span class="w"> </span>testcase
</code></pre></div>
<p>執行的方式則是在 invoke 後面直接加上任務名稱</p>
<p>e.g.,</p>
<div class="highlight"><pre><span></span><code>inv<span class="w"> </span>clean
</code></pre></div>
<h2 id="invoke_3">實作 invoke 任務</h2>
<p>我們先試著將前面的 <code>python setup.py develop</code> 改成 invoke 的任務</p>
<p>預設 invoke 會去找目錄下的 <code>tasks.py</code><br/>
所以第一步要先在專案最上層建立 <code>tasks.py</code><br/>
接著撰寫一個函式叫 <code>develop</code> ，這就會是之後的任務名稱 (i.e., 透過 <code>inv develop</code> 執行)<br/>
在函式前加上裝飾器 (decorator) <code>@task</code><br/>
invoke 會傳入一個 context 做為第一個參數 (Read More 👉 <a href="http://docs.pyinvoke.org/en/stable/getting-started.html#aside-what-exactly-is-this-context-arg-anyway">what exactly is this ‘context’ arg anyway?</a>)<br/>
(p.s. 原本的程式碼中是使用 <code>cmd</code> ，那是錯誤的用法)<br/>
最後就可以用這個 context （參數 <code>ctx</code>） 執行指令</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">invoke</span> <span class="kn">import</span> <span class="n">task</span>


<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">develop</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">"python setup.py develop"</span><span class="p">)</span>
</code></pre></div>
<p>如同先前所提到的，操作都應該在虛擬環境內被完成<br/>
所以我將 <code>pipenv run</code> 的前綴提出來<br/>
這樣就能確保之後的操作一定都會在虛擬環境內執行<br/>
如果之後更換了管理虛擬環境的工具（e.g. <code>poetry run</code>），也可以更輕易的改動 <code>tasks.py</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">invoke</span> <span class="kn">import</span> <span class="n">task</span>

<span class="n">PIPENV_PREFIX</span> <span class="o">=</span> <span class="s2">"pipenv run"</span>


<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">develop</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">PIPENV_PREFIX</span><span class="si">}</span><span class="s2"> python setup.py develop"</span><span class="p">)</span>
</code></pre></div>
<h2 id="_1">任務相依</h2>
<p>如果任務之間有相依性，可以在 <code>@task</code> 後加入 <code>pre</code> 或 <code>post</code><br/>
表示任務執行前或後還要執行其他任務</p>
<p>e.g., 在初始環境 (<code>init</code>) 前，常會先清除不必要的檔案 (<code>clean</code>)</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">invoke</span> <span class="kn">import</span> <span class="n">task</span>


<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">clean</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"clean up"</span><span class="p">)</span>


<span class="nd">@task</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="p">[</span><span class="n">clean</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"initial"</span><span class="p">)</span>
</code></pre></div>
<h2 id="_2">任務模組化</h2>
<p>當任務便多時，為了方便維護，就會傾向將相似的任務模組化<br/>
這時候就可以使用到 <code>namespace</code> 的概念<br/>
(Read More 👉 <a href="http://docs.pyinvoke.org/en/stable/concepts/namespaces.html">Constructing namespaces</a>)</p>
<p>不過我不會在這篇文章深入探討要怎麼說<br/>
一般來說，除非任務真的非常多，這是不太必要的</p>
<p>如果有興趣看我怎麼把 <a href="https://github.com/pycontw/pycontw-postevent-report-generator">pycontw-postevent-report-generator</a> 的任務模組化<br/>
可以參考 <a href="https://github.com/pycontw/pycontw-postevent-report-generator/commit/f1050eabf44a8b8e662370bd97b2a79ad57723c2">commit f105</a></p>
<p>最後修改後 <code>tasks</code> 套件中有這些模組</p>
<div class="highlight"><pre><span></span><code>├── tasks
│   ├── __init__.py
│   ├── build.py
│   ├── common.py
│   ├── env.py
│   ├── style.py
│   └── test.py
</code></pre></div>
<p>和各個模組下的指令</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>inv<span class="w"> </span>--list

Available<span class="w"> </span>tasks:

<span class="w">  </span>secure<span class="w">              </span>Check<span class="w"> </span>package<span class="w"> </span>security
<span class="w">  </span>build.clean<span class="w">         </span>Remove<span class="w"> </span>all<span class="w"> </span>the<span class="w"> </span>tmp<span class="w"> </span>files<span class="w"> </span><span class="k">in</span><span class="w"> </span>.gitignore
<span class="w">  </span>build.develop<span class="w">       </span>Install<span class="w"> </span>script<span class="w"> </span><span class="k">in</span><span class="w"> </span>pipenv<span class="w"> </span>environment<span class="w"> </span><span class="k">in</span><span class="w"> </span>development<span class="w"> </span>mode
<span class="w">  </span>build.install<span class="w">       </span>Install<span class="w"> </span>script<span class="w"> </span><span class="k">in</span><span class="w"> </span>pipenv<span class="w"> </span>environment
<span class="w">  </span>build.test-cli<span class="w">      </span>Test<span class="w"> </span>whether<span class="w"> </span>the<span class="w"> </span>cli<span class="w"> </span>is<span class="w"> </span>runnable
<span class="w">  </span>env.clean<span class="w">           </span>Remove<span class="w"> </span>virtual<span class="w"> </span>environment
<span class="w">  </span>env.init<span class="w">            </span>Install<span class="w"> </span>production<span class="w"> </span>dependencies
<span class="w">  </span>env.init-dev<span class="w">        </span>Install<span class="w"> </span>development<span class="w"> </span>dependencies
<span class="w">  </span>style.flake8<span class="w">        </span>Check<span class="w"> </span>style<span class="w"> </span>through<span class="w"> </span>flake8
<span class="w">  </span>style.mypy<span class="w">          </span>Check<span class="w"> </span>style<span class="w"> </span>through<span class="w"> </span>mypy
<span class="w">  </span>style.pylint<span class="w">        </span>Check<span class="w"> </span>style<span class="w"> </span>through<span class="w"> </span>pylint
<span class="w">  </span>style.reformat<span class="w">      </span>Reformat<span class="w"> </span>python<span class="w"> </span>files<span class="w"> </span>through<span class="w"> </span>black
<span class="w">  </span>style.run<span class="w"> </span><span class="o">(</span>style<span class="o">)</span><span class="w">   </span>Check<span class="w"> </span>style<span class="w"> </span>through<span class="w"> </span>linter<span class="w"> </span><span class="o">(</span>Note<span class="w"> </span>that<span class="w"> </span>pylint<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>included<span class="o">)</span>
<span class="w">  </span>test.cov<span class="w">            </span>Run<span class="w"> </span><span class="nb">test</span><span class="w"> </span>coverage<span class="w"> </span>check
<span class="w">  </span>test.run<span class="w"> </span><span class="o">(</span><span class="nb">test</span><span class="o">)</span><span class="w">     </span>Run<span class="w"> </span><span class="nb">test</span><span class="w"> </span>cases
</code></pre></div>
<h2 id="auto-completion">自動補完 （Auto-completion）</h2>
<p>工程師是很懶惰的<br/>
這種指令列工具沒有自動補完怎麼行<br/>
invoke 當然也想到了<br/>
透過參數 <code>--print-completion-script=[shell]</code> 就能取得 invoke 預先寫好的自動補完腳步<br/>
目前支援 bash, zsh, fish 三種 shell</p>
<p>e.g., 將 invoke 產生的 zsh 自動補完腳本寫入 <code>~/.zsh</code></p>
<div class="highlight"><pre><span></span><code>inv<span class="w"> </span>--print-completion-script<span class="o">=</span>zsh<span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.zshrc
</code></pre></div>
<h2 id="makefile">為什麼不用 Makefile 就好？</h2>
<p>因為有些 shell script 並不見得那麼好寫<br/>
（也可能只是我不熟...）</p>
<p>e.g.,</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">invoke</span> <span class="kn">import</span> <span class="n">task</span>


<span class="n">PIPENV_PREFIX</span> <span class="o">=</span> <span class="s2">"pipenv run"</span>


<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Remove all the tmp files in .gitignore"""</span>
    <span class="n">files_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">".gitignore"</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">input_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"#"</span><span class="p">):</span>
                <span class="n">files_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="n">cmd</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="sa">f</span><span class="s2">"rm -rf </span><span class="si">{</span><span class="s1">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">files_to_remove</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
<p>（雖然後來發現上面的一串，可以用 <code>git clean -Xdf</code> 取代...）</p>
<p>除此之外，invoke 也可以讓 shell script 的結果，直接跟 Python 互動<br/>
更容易實作出想要的功能</p>
<p>另外，推薦閱讀 <a href="https://interrupt.memfault.com/blog/building-a-cli-for-firmware-projects">Building a CLI for Firmware Projects using Invoke</a></p>
<h2 id="_3">其他進階應用</h2>
<ul>
<li>如何在任務加上參數？<ul>
<li>任務的函式後面加上除了 context 意外的參數</li>
<li>👉 <a href="http://docs.pyinvoke.org/en/stable/getting-started.html#task-parameters">Task parameters</a></li>
</ul>
</li>
<li>為什麼用 invoke 的結果跟指令列上的執行結果不完全相同？<ul>
<li>在 <code>run</code> 函式中加上 <code>pty=True</code> 參數通常能解決，但建議可以看看 invoke 為什麼不將這設定為預設行為</li>
<li>👉 <a href="http://www.pyinvoke.org/faq.html#why-is-my-command-behaving-differently-under-invoke-versus-being-run-by-hand">Why is my command behaving differently under Invoke versus being run by hand?</a></li>
</ul>
</li>
<li>如何在任務執行失敗時，只做警告，不要跳錯<ul>
<li>在 <code>run</code> 函式加上 <code>warn=True</code> (預設是 <code>False</code>)</li>
<li>👉 <a href="http://docs.pyinvoke.org/en/1.2/api/runners.html#invoke.runners.Runner.run">invoke.runners.Runner.run</a></li>
</ul>
</li>
</ul>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://wei-lee.me/pycon-note/posts/pycon-us-2019/2019/08/break-the-cycle-three-excellent-python-tools-to-automate-repetitive-tasks/">Break the Cycle: Three excellent Python tools to automate repetitive tasks - PyCon US 2019</a></li>
</ul>
</section>
<section class="post-footer">
<div class="post-share">
<span class="post-info-label">Share</span>
<a aria-label="Twitter" class="twitter" href="https://twitter.com/share?text=Python Table Manners - 管理繁瑣任務 &amp;url=https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-manage-trivial-tasks" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Twitter">
<i aria-hidden="true" class="icon icon-twitter"></i><span class="hidden">Twitter</span>
</a>
<a aria-label="Facebook" class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-manage-trivial-tasks" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Facebook">
<i aria-hidden="true" class="icon icon-facebook"></i><span class="hidden">Facebook</span>
</a>
<a aria-label="LinkedIn" class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-manage-trivial-tasks&amp;title=Python Table Manners - 管理繁瑣任務" onclick="window.open(this.href, 'linkedin-share', 'width=930,height=720');return false;" title="LinkedIn">
<i aria-hidden="true" class="icon icon-linkedin"></i><span class="hidden">LinkedIn</span>
</a>
<a aria-label="Email" class="email" href="mailto:?subject=Python Table Manners - 管理繁瑣任務&amp;body=https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-manage-trivial-tasks" title="Email">
<i aria-hidden="true" class="icon icon-mail"></i><span class="hidden">Email</span>
</a>
<div class="clear"></div>
</div>
<aside class="post-tags">
<a href="https://blog.wei-lee.me/tag/python.html">Python</a><a href="https://blog.wei-lee.me/tag/task.html">Task</a> </aside>
<div class="clear"></div>
<div class="series">
<p>This post is part 6 of the "Python Table Manners" series:</p>
<ol class="parts">
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-series">Python Table Manners 系列</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-dependency-mangement">Python Table Manners - 虛擬環境和套件管理</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-test-1">Python Table Manners - 測試 (一)</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-test-2">Python Table Manners - 測試 (二)</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-coding-style">Python Table Manners - 程式碼風格</a>
</li>
<li class="active">
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-manage-trivial-tasks">Python Table Manners - 管理繁瑣任務</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-pre-commit">Python Table Manners - pre-commit: git commit 前做完檢查</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/03/python-table-manners-commitizen">Python Table Manners - Commitizen: 規格化 commit message</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/03/python-table-manners-security">Python Table Manners - 安全性檢查</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/04/python-table-manners-documentation">Python Table Manners - 文件</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2020/12/python-table-manner-continuous-integration">Python Table Manners - 持續整合/部署</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2021/01/python-table-manners-cookiecutter">Python Table Manners - Cookiecutter 專案模板</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2021/01/python-table-manner-editor">Python Table Manners 番外 - 編輯器</a>
</li>
</ol>
</div>
</section>
<script type="text/javascript">var use_utterance = true;</script>
<section class="post-comments">
<script async="" crossorigin="anonymous" data-issue-term="https://blog.wei-lee.me/posts/tech/2020/02/python-table-manners-manage-trivial-tasks" data-label="blog-comment" data-repo="Lee-W/main-blog" data-theme="github-light" src="https://utteranc.es/client.js">
</script>
</section>
<aside class="post-nav">
<div class="clear"></div>
</aside>
</div>
</article>
</main>
<div class="nav-footer">
<nav aria-label="Footer" class="nav-wrapper">
<span class="nav-copy">Those aren't written down are meant to be forgotten © 2023
          <a class="nav-rss" href="https://blog.wei-lee.me/feeds/all.atom.xml" target="_blank" title="RSS"><i class="icon icon-rss"></i></a>
</span>
<span class="nav-credits">



          Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a> • Theme <a href="https://github.com/arulrajnet/attila" rel="nofollow">Attila</a> •
          <a class="menu-item js-theme" data-dark="Dark theme" data-light="Light theme" data-system="System theme" href="#">
<span class="theme-icon"></span><span class="theme-text">System theme</span>
</a>
</span>
</nav>
</div>
</section>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<!-- TODO: minify -->
<script src="https://blog.wei-lee.me/theme/js/jquery.fitvids.js" type="text/javascript"></script>
<script src="https://blog.wei-lee.me/theme/js/script.js" type="text/javascript"></script>
<script src="https://blog.wei-lee.me/theme/js/clipboard.min.js" type="text/javascript"></script>
<script src="https://blog.wei-lee.me/theme/js/copy-to-clipboard.js" type="text/javascript"></script>
<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3J7XQ46QH5"></script>
<script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-3J7XQ46QH5', { 'anonymize_ip': true });
    </script>
<script src="/pagefind/pagefind-ui.js"></script>
<script>
      window.addEventListener('DOMContentLoaded', (event) => {
          new PagefindUI({
              element: "#search",
              showImages: false,
          });
      });
  </script>
<!-- 	The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in article.html, but it needs to be included down here, after jQuery has already loaded. -->
<script>
  $(document).ready(function () {
    var viewport = $(window);
    var post = $('.post-content');
    // Responsive videos with fitVids
    post.fitVids();

    // Reading progress bar on window top
    function readingProgress() {
      var postBottom = post.offset().top + post.height();
      var viewportHeight = viewport.height();
      var progress = 100 - (((postBottom - (viewport.scrollTop() + viewportHeight) + viewportHeight / 3) / (postBottom - viewportHeight + viewportHeight / 3)) * 100);
      $('.progress-bar').css('width', progress + '%');
      (progress > 100) ? $('.progress-container').addClass('complete'): $('.progress-container').removeClass('complete');
    }
    readingProgress();
    // Trigger reading progress
    viewport.on({
      'scroll': function() {
        readingProgress();
      },
      'resize': function() {
        readingProgress();
      },
      'orientationchange': function() {
        readingProgress();
      }
    });

  });
</script>
</body>
</html>
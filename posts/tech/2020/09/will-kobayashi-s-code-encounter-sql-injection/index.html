
<!DOCTYPE html>

<html lang="zh-tw">
<head>
<meta charset="utf-8"/>
<meta charset="utf-8" content="text/html" http-equiv="Content-Type">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/>
<title>å°æ—çš„ç¨‹å¼æœƒä¸æœƒé‡åˆ° SQL Injection </title>
<meta content="True" name="HandheldFriendly"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="origin" name="referrer"/>
<meta content="Pelican" name="generator"/>
<link href="https://blog.wei-lee.me/posts/tech/2020/09/will-kobayashi-s-code-encounter-sql-injection" rel="canonical"/>
<!-- Feed -->
<link href="https://blog.wei-lee.me/feeds/all.atom.xml" rel="alternate" title="Those aren't written down are meant to be forgotten Full Atom Feed" type="application/atom+xml"/>
<!-- TODO: combine -->
<link href="https://blog.wei-lee.me/theme/css/style.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/pygments.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/pagefind-ui-custom.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/code.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/code-copy.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/custom.css" rel="stylesheet" type="text/css"/>
<link href="/pagefind/pagefind-ui.css" rel="stylesheet"/>
<!-- Custom fonts -->
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,300" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css"/>
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
<script>
    var siteUrl = 'https://blog.wei-lee.me';
  </script>
<script>
    var localTheme = localStorage.getItem('attila_theme');
    switch (localTheme) {
      case 'dark':
        document.documentElement.classList.add('theme-dark');
        break;
      case 'light':
        document.documentElement.classList.add('theme-light');
        break;
      default:
        break;
    }
  </script>
<meta content="å…¶å¯¦é€™ç¯‡æ–‡ç« æ‡‰è©²ä¸€å¹´å‰å°±è©²å¯«äº†... ä»Šå¹´ç‚ºäº†åœ¨ PyCon TW çš„ Lightning Talk æƒ³å€‹æ¢—ï¼Œå°±æ‹¿å‡ºä¾†è¬› (slide) æ²’æƒ³åˆ°è¢«æŠ•å½±æ©Ÿæ“ºäº†ä¸€é“......" name="description"/>
<meta content="Wei Lee" name="author"/>
<meta content="Python" name="tags"/>
<meta content="Anime" name="tags"/>
<!-- Open Graph -->
<meta content="Those aren't written down are meant to be forgotten" prefix="og: http://ogp.me/ns#" property="og:site_name">
<meta content="å°æ—çš„ç¨‹å¼æœƒä¸æœƒé‡åˆ° SQL Injection " prefix="og: http://ogp.me/ns#" property="og:title">
<meta content="å…¶å¯¦é€™ç¯‡æ–‡ç« æ‡‰è©²ä¸€å¹´å‰å°±è©²å¯«äº†... ä»Šå¹´ç‚ºäº†åœ¨ PyCon TW çš„ Lightning Talk æƒ³å€‹æ¢—ï¼Œå°±æ‹¿å‡ºä¾†è¬› (slide) æ²’æƒ³åˆ°è¢«æŠ•å½±æ©Ÿæ“ºäº†ä¸€é“......" prefix="og: http://ogp.me/ns#" property="og:description">
<meta content="zh-tw" prefix="og: http://ogp.me/ns#" property="og:locale">
<meta content="https://blog.wei-lee.me/posts/tech/2020/09/will-kobayashi-s-code-encounter-sql-injection" prefix="og: http://ogp.me/ns#" property="og:url"/>
<meta content="article" prefix="og: http://ogp.me/ns#" property="og:type"/>
<meta content="2020-09-22 12:50:00+08:00" prefix="og: http://ogp.me/ns#" property="article:published_time"/>
<meta content="" prefix="og: http://ogp.me/ns#" property="article:modified_time"/>
<meta content="https://blog.wei-lee.me/author/wei-lee.html" prefix="og: http://ogp.me/ns#" property="article:author"/>
<meta content="Tech" prefix="og: http://ogp.me/ns#" property="article:section">
<meta content="Python" prefix="og: http://ogp.me/ns#" property="article:tag"/>
<meta content="Anime" prefix="og: http://ogp.me/ns#" property="article:tag"/>
<meta content="https://blog.wei-lee.me/images/cover.jpeg" prefix="og: http://ogp.me/ns#" property="og:image"/>
<!-- Twitter Card -->
<meta content="summary_large_image" name="twitter:card"/>
<meta content="@clleew" name="twitter:site"/>
<meta content="å°æ—çš„ç¨‹å¼æœƒä¸æœƒé‡åˆ° SQL Injection " name="twitter:title"/>
<meta content="https://blog.wei-lee.me/posts/tech/2020/09/will-kobayashi-s-code-encounter-sql-injection" name="twitter:url"/>
<meta content="https://blog.wei-lee.me/images/cover.jpeg" name="twitter:image:src"/>
<meta content="å…¶å¯¦é€™ç¯‡æ–‡ç« æ‡‰è©²ä¸€å¹´å‰å°±è©²å¯«äº†... ä»Šå¹´ç‚ºäº†åœ¨ PyCon TW çš„ Lightning Talk æƒ³å€‹æ¢—ï¼Œå°±æ‹¿å‡ºä¾†è¬› (slide) æ²’æƒ³åˆ°è¢«æŠ•å½±æ©Ÿæ“ºäº†ä¸€é“......" name="twitter:description"/>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "å°æ—çš„ç¨‹å¼æœƒä¸æœƒé‡åˆ° SQL Injection",
  "headline": "å°æ—çš„ç¨‹å¼æœƒä¸æœƒé‡åˆ° SQL Injection",
  "datePublished": "2020-09-22 12:50:00+08:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Wei Lee",
    "url": "https://blog.wei-lee.me/author/wei-lee.html"
  },
  "image": "https://blog.wei-lee.me//images/cover.jpeg",
  "url": "https://blog.wei-lee.me/posts/tech/2020/09/will-kobayashi-s-code-encounter-sql-injection",
  "description": "å…¶å¯¦é€™ç¯‡æ–‡ç« æ‡‰è©²ä¸€å¹´å‰å°±è©²å¯«äº†... ä»Šå¹´ç‚ºäº†åœ¨ PyCon TW çš„ Lightning Talk æƒ³å€‹æ¢—ï¼Œå°±æ‹¿å‡ºä¾†è¬› (slide) æ²’æƒ³åˆ°è¢«æŠ•å½±æ©Ÿæ“ºäº†ä¸€é“......"
}
</script>
</meta></meta></meta></meta></meta></link></meta><link href="https://blog.wei-lee.me/posts/tech/2020/09/will-kobayashi-s-code-encounter-sql-injection" rel="canonical"/><script type="application/ld+json">{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "Those aren't written down are meant to be forgotten", "item": "https://blog.wei-lee.me"}, {"@type": "ListItem", "position": 2, "name": "Posts", "item": "https://blog.wei-lee.me/posts"}, {"@type": "ListItem", "position": 3, "name": "Tech", "item": "https://blog.wei-lee.me/posts/tech"}, {"@type": "ListItem", "position": 4, "name": "2020", "item": "https://blog.wei-lee.me/posts/tech/2020"}, {"@type": "ListItem", "position": 5, "name": "09", "item": "https://blog.wei-lee.me/posts/tech/2020/09"}, {"@type": "ListItem", "position": 6, "name": "Will kobayashi s code encounter sql injection", "item": "https://blog.wei-lee.me/posts/tech/2020/09/will-kobayashi-s-code-encounter-sql-injection"}, {"@type": "ListItem", "position": 7, "name": "Index", "item": "https://blog.wei-lee.me/posts/tech/2020/09/will-kobayashi-s-code-encounter-sql-injection/index.html"}]}</script><script type="application/ld+json">{"@context": "https://schema.org", "@type": "Article", "author": {"@type": "Person", "name": "Wei Lee"}, "publisher": {"@type": "Organization", "name": "Those aren't written down are meant to be forgotten"}, "headline": "å°æ—çš„ç¨‹å¼æœƒä¸æœƒé‡åˆ° SQL Injection", "about": "Tech", "datePublished": "2020-09-22 12:50"}</script><meta content="summary" name="twitter:card"/><meta content="https://blog.wei-lee.me/posts/tech/2020/09/will-kobayashi-s-code-encounter-sql-injection" property="og:url"/><meta content="article" property="og:type"/><meta content="å°æ—çš„ç¨‹å¼æœƒä¸æœƒé‡åˆ° SQL Injection" property="og:title"/><meta content="C" property="og:locale"/></head>
<body class="category-template">
<div class="nav-header">
<nav aria-label="Main" class="nav-wrapper">
<ul>
<li class="nav-ğŸ  Home" role="presentation"><a href="/"><span>ğŸ  Home</span></a></li>
<li class="nav-About Me" role="presentation"><a href="/pages/about-me.html"><span>About Me</span></a></li>
<li class="nav-ğŸ‘¨â€ğŸ’» Tech active" role="presentation"><a href="/category/tech.html"><span>ğŸ‘¨â€ğŸ’» Tech</span></a></li>
<li class="nav-ğŸ“š Book Digest" role="presentation"><a href="/category/book.html"><span>ğŸ“š Book Digest</span></a></li>
<li class="nav-ğŸ’¬ Gossiping" role="presentation"><a href="/category/gossiping.html"><span>ğŸ’¬ Gossiping</span></a></li>
<li class="nav-ğŸ·ï¸ Tags" role="presentation"><a href="/tags.html"><span>ğŸ·ï¸ Tags</span></a></li>
<li class="nav-ğŸ—„ï¸ Archives" role="presentation"><a href="/archives.html"><span>ğŸ—„ï¸ Archives</span></a></li>
<li class="nav-ğŸ“š Series" role="presentation"><a href="/series_list.html"><span>ğŸ“š Series</span></a></li>
<li class="nav-ğŸ” Search" role="presentation"><a href="/search.html"><span>ğŸ” Search</span></a></li>
</ul>
<ul class="nav-meta">
<li class="nav-linkedin"><a aria-label="Linkedin" href="https://tw.linkedin.com/in/clleew" target="_blank"><i aria-hidden="true" class="icon icon-linkedin"></i>
<span>Linkedin</span>
</a></li>
<li class="nav-github"><a aria-label="Github" href="https://github.com/Lee-W" target="_blank"><i aria-hidden="true" class="icon icon-github"></i>
<span>GitHub</span>
</a></li>
<li class="nav-twitter"><a aria-label="Twitter" href="https://twitter.com/clleew" target="_blank"><i aria-hidden="true" class="icon icon-twitter"></i>
<span>Twitter</span>
</a></li>
<li class="nav-search" style="display: none;">
<a title="Search">
<i aria-hidden="true" class="icon icon-search"></i>
<span>Search</span>
</a>
</li>
</ul> </nav>
<div class="nav-wrapper-control">
<div class="inner">
<a class="nav-menu" role="button"><i aria-hidden="true" class="icon icon-menu"></i>Menu</a>
<a class="nav-search" role="button" style="display: none;" title="Search"><i aria-hidden="true" class="icon icon-search"></i></a>
</div>
</div>
</div>
<div aria-label="Close" class="nav-close" role="button"></div>
<section class="page-wrapper" id="wrapper">
<!-- Progressbar -->
<div class="progress-container">
<span class="progress-bar"></span>
</div>
<!-- Page Header -->
<!-- Set your background image for this header on the line below. -->
<header class="post-header has-cover">
<div class="inner">
<span class="post-info">
<span class="post-type">Article</span>
<span class="post-count">Tech</span>
</span>
<h1 class="post-title">
            å°æ—çš„ç¨‹å¼æœƒä¸æœƒé‡åˆ° SQL Injection
        </h1>
<div class="post-meta">
<div class="post-meta-avatars">
<figure class="post-meta-avatar avatar">
<a class="author-avatar" href="https://blog.wei-lee.me/author/wei-lee.html">
<img alt="Wei Lee" class="author-profile-image" src="https://blog.wei-lee.me//images/avatar.jpeg"/>
</a>
</figure>
</div>
<h4 class="post-meta-author">
            Wei Lee
          </h4>
<time datetime="2020/09/22 - Tue">2020/09/22 - Tue</time>
          â€¢ 5 min read
        </div>
<div class="post-cover cover">
<img alt="Category Tech" src="https://blog.wei-lee.me/images/cover.jpeg"/>
</div>
</div>
</header>
<!-- Post content -->
<main class="content" data-pagefind-body="" role="main">
<article class="post">
<div class="inner">
<section class="post-content">
<p>å…¶å¯¦é€™ç¯‡æ–‡ç« æ‡‰è©²ä¸€å¹´å‰å°±è©²å¯«äº†...<br/>
ä»Šå¹´ç‚ºäº†åœ¨ PyCon TW çš„ Lightning Talk æƒ³å€‹æ¢—ï¼Œå°±æ‹¿å‡ºä¾†è¬› (<a href="https://speakerdeck.com/leew/xiao-lin-de-cheng-shi-ma-hui-bu-hui-yu-dao-sql-injection">slide</a>)<br/>
æ²’æƒ³åˆ°è¢«æŠ•å½±æ©Ÿæ“ºäº†ä¸€é“......</p>
<!--more-->
<div class="toc">
<ul>
<li><a href="#_1">å‰è¨€é›œè«‡</a></li>
<li><a href="#sql-injection">ä»€éº¼æ˜¯ SQL injection</a></li>
<li><a href="#webpy-sql-injection">web.py åˆ°åº•æœƒä¸æœƒæœ‰ SQL injectionï¼Ÿ</a><ul>
<li><a href="#_2">åˆå§‹åŒ–è³‡æ–™åº«</a></li>
<li><a href="#_3">å¯¦ä½œç™»å…¥åŠŸèƒ½</a></li>
<li><a href="#_4">è©²å¦‚ä½•ä¿®æ­£ï¼Ÿ</a></li>
</ul>
</li>
<li><a href="#_5">çŸ¥å…¶ç„¶é‚„è¦çŸ¥å…¶æ‰€ä»¥ç„¶å•Šï¼</a><ul>
<li><a href="#pdbpp">pdbpp</a></li>
<li><a href="#webpy">è¿½ web.py åŸå§‹ç¢¼</a></li>
</ul>
</li>
<li><a href="#_6">çµèª</a></li>
<li><a href="#one-more-thing">One more thing</a></li>
</ul>
</div>
<h2 id="_1">å‰è¨€é›œè«‡</h2>
<p>å»å¹´çœ‹äº†äº¬é˜¿å°¼çš„ä½œå“<a href="https://zh.wikipedia.org/wiki/%E5%B0%8F%E6%9E%97%E5%AE%B6%E7%9A%84%E9%BE%8D%E5%A5%B3%E5%83%95">å°æ—å®¶çš„é¾å¥³åƒ•</a></p>
<p>ç¬¬ä¸€é›†å°±ç™¼ç¾ä¸»è§’å°æ—ä¹Ÿæ˜¯å¯« Python çš„å·¥ç¨‹å¸«ï¼Œå°±é–‹å¿ƒåœ°åˆ†äº«äº†é€™å€‹æ¶ˆæ¯<br/>
<img alt="del" src="/images/posts-image/2020-will-kobayashi-s-code-encounter-sql-injection/del.jpg"/></p>
<p>æ²’æƒ³åˆ°é¦¬ä¸Šå°±æœ‰æœ‹å‹å•æˆ‘é€™æ®µç¨‹å¼ç¢¼æœƒä¸æœƒæœ‰ SQL injection<br/>
<img alt="will it encounter sql injection" src="/images/posts-image/2020-will-kobayashi-s-code-encounter-sql-injection/will it encounter sql injection.png"/></p>
<p>å–®çœ‹é€™ä¸€æ®µç¨‹å¼ç¢¼å…¶å¯¦å¾ˆé›£ç›´æ¥ä¸‹å®šè«–<br/>
ç•¢ç«Ÿ key æ ¹æœ¬å°±ä¸æœƒè¢«å¸¶å…¥ <code>session_id=$key</code>ï¼Œèª°çŸ¥é“ db æ€éº¼å¯¦ä½œçš„</p>
<p>ç•¶ç„¶ï¼Œæ—©å°±æœ‰äººæ³¨æ„åˆ°é€™æ®µç¨‹å¼ç¢¼äº†<br/>
å®ƒå‡ºè‡ª <a href="https://github.com/webpy/webpy/blob/webpy-0.39/web/session.py#L313">webpy/web/session.py</a></p>
<ul>
<li><a href="https://www.zhihu.com/question/51933296/answer/143492909">å¦‚ä½•è¯„ä»·äº¬éƒ½åŠ¨ç”»2017å¹´1æœˆæ–°ä½œ å°æ—å®¶çš„é¾™å¥³ä»†?</a><ul>
<li>é™¤äº†æ‰¾åˆ°ç¨‹å¼ç¢¼å¤–ï¼Œå®ƒé‚„åˆ—å‡ºäº†åŠ‡æƒ…çš„å…¶ä»– Python ç¨‹å¼ç¢¼ï¼Œä¸¦è¨è«–äº†äº¬éƒ½å‹•ç•«ä½¿ç”¨é€™æ®µç¨‹å¼ç¢¼æœƒä¸æœƒæœ‰æ³•å¾‹å•é¡Œ</li>
</ul>
</li>
<li><a href="https://qiita.com/ygkn/items/6b3be1afa31e4092826e">å°æ—ã•ã‚“ã¡ã®ãƒ¡ã‚¤ãƒ‰ãƒ©ã‚´ãƒ³ã§å‡ºã¦ããŸã‚³ãƒ¼ãƒ‰ï¼ˆå°æ—ã•ã‚“ã‚’æ¢ã›ï¼ï¼‰</a><ul>
<li>é€é <code>git blame</code> ä¾†æ‰¾å‡ºã€Œåˆ°åº•èª°æ˜¯å°æ—ï¼ã€</li>
</ul>
</li>
<li><a href="https://ponkatsu807462913.wordpress.com/tag/sql-injection/">Ponkatsu - Tag: sql injection</a><ul>
<li>ç›´æ¥é»å‡ºé€™æ®µç¨‹å¼ç¢¼æœƒé‡åˆ° SQL injection</li>
</ul>
</li>
</ul>
<p>ä½†èº«ç‚ºå·¥ç¨‹å¸«é‚„æ˜¯è¦è‡ªå·±é©—è­‰ä¸€ä¸‹åˆ°åº•æœƒä¸æœƒæœ‰ SQL injection</p>
<h2 id="sql-injection">ä»€éº¼æ˜¯ SQL injection</h2>
<p>æ ¹æ“š <a href="https://zh.wikipedia.org/wiki/SQL%E6%B3%A8%E5%85%A5">SQLæ³¨å…¥</a> ç¶­åŸºç™¾ç§‘é é¢çš„ä¾‹å­<br/>
å‡è¨­æœ‰ä¸€æ®µç”¢ç”Ÿ SQL å­—ä¸²çš„ç¨‹å¼ç¢¼æ˜¯é€™æ¨£å¯«çš„</p>
<div class="highlight"><pre><span></span><code><span class="n">sql_str</span> <span class="o">=</span> <span class="s2">"SELECT * FROM users WHERE (name = '"</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s2">"') and (pw = '"</span> <span class="o">+</span> <span class="n">password</span> <span class="o">+</span> <span class="s2">"');"</span>
</code></pre></div>
<p>åªè¦æ”»æ“Šè€…è¼¸å…¥äº†</p>
<div class="highlight"><pre><span></span><code><span class="n">username</span> <span class="o">=</span> <span class="s2">"1' OR '1'='1"</span>
<span class="n">password</span> <span class="o">=</span> <span class="s2">"1' OR '1'='1"</span>
</code></pre></div>
<p>å°±æœƒç”¢ç”Ÿ</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'1'</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="s1">'1'</span><span class="o">=</span><span class="s1">'1'</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">pw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'1'</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="s1">'1'</span><span class="o">=</span><span class="s1">'1'</span><span class="p">);</span>
</code></pre></div>
<p>å› ç‚º 1 ä¸€å®šç­‰æ–¼ 1ï¼Œé€™æ®µ SQL å°±æœƒç”¢ç”Ÿè·Ÿ <code>SELECT * FROM user;</code> ä¸€æ¨£çš„æ•ˆæœ<br/>
ä¹Ÿå°±æ˜¯æ”»æ“Šè€…åœ¨å®Œå…¨ä¸çŸ¥é“å¸³è™Ÿå¯†ç¢¼çš„æƒ…æ³ä¸‹ï¼Œå°±å¯ä»¥å–å¾—æ‰€æœ‰ users çš„å¸³è™Ÿå¯†ç¢¼</p>
<h2 id="webpy-sql-injection">web.py åˆ°åº•æœƒä¸æœƒæœ‰ SQL injectionï¼Ÿ</h2>
<p>å› ç‚ºå°æ—å®¶çš„é¾å¥³åƒ•æ˜¯åœ¨ 2017 å¹´çš„ 1 æœˆåˆ° 4 æœˆæ’­å‡º<br/>
æ ¹æ“š web.py çš„ <a href="https://github.com/webpy/webpy/tags">tags</a> é é¢ï¼Œåœ¨é‚£ä¹‹å¾Œçš„ç¬¬ä¸€å€‹ç™¼ä½ˆæ˜¯ <code>webpy-0.39</code><br/>
å¯ä»¥æ¨æ¸¬ï¼Œé€™æœ€æœ‰å¯èƒ½æ˜¯ç¬¬ä¸€å€‹åŒ…å«å°æ—æ’°å¯«ç¨‹å¼ç¢¼çš„ç™¼ä½ˆ</p>
<p><img alt="web.py release" src="/images/posts-image/2020-will-kobayashi-s-code-encounter-sql-injection/webpy tag.jpg"/></p>
<p>æˆ‘å€‘å…ˆå¾å®‰è£ <code>web.py==0.39</code> åˆ°è™›æ“¬ç’°å¢ƒä¸­é–‹å§‹<br/>
ï¼ˆp.s. web è·Ÿ py ä¸­é–“çš„ . æ˜¯å¿…è¦çš„ï¼Œå› ç‚ºçœŸçš„æœ‰å€‹å¥—ä»¶å« webpyï¼‰</p>
<div class="highlight"><pre><span></span><code>poetry<span class="w"> </span>add<span class="w"> </span>web.py<span class="o">==</span><span class="m">0</span>.39
</code></pre></div>
<p>å¾ˆä¸å¹¸ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯ Python 3ï¼Œæœƒé‡åˆ°ä»¥ä¸‹çš„éŒ¯èª¤è¨Šæ¯</p>
<div class="highlight"><pre><span></span><code>Creating virtualenv kobayashi-pwI4Cysh-py3.8 in /Users/weilee/Library/Caches/pypoetry/virtualenvs

Updating dependencies
Resolving dependencies... (0.1s)

Writing lock file


Package operations: 1 install, 0 updates, 0 removals

  - Installing web.py (0.39)

[EnvCommandError]
Command ['/Users/weilee/Library/Caches/pypoetry/virtualenvs/kobayashi-pwI4Cysh-py3.8/bin/pip', 'install', '--no-deps', 'web.py==0.39'] errored with the following return code 1, and output:
Collecting web.py==0.39
  Using cached web.py-0.39.tar.gz (93 kB)
    ERROR: Command errored out with exit status 1:
     command: /Users/weilee/Library/Caches/pypoetry/virtualenvs/kobayashi-pwI4Cysh-py3.8/bin/python -c 'import sys, setuptools, tokenize; sys.argv[0] = '"'"'/.../web.py/setup.py'"'"'; __file__='"'"'/.../web.py/setup.py'"'"';f=getattr(tokenize, '"'"'open'"'"', open)(__file__);code=f.read().replace('"'"'\r\n'"'"', '"'"'\n'"'"');f.close();exec(compile(code, __file__, '"'"'exec'"'"'))' egg_info --egg-base /...
         cwd: /.../web.py/
    Complete output (7 lines):
    Traceback (most recent call last):
      File "&lt;string&gt;", line 1, in &lt;module&gt;
      File "/.../web.py/setup.py", line 6, in &lt;module&gt;
        from web import __version__
      File "/.../web.py/web/__init__.py", line 14, in &lt;module&gt;
        import utils, db, net, wsgi, http, webapi, httpserver, debugerror
    ModuleNotFoundError: No module named 'utils'
    ----------------------------------------
ERROR: Command errored out with exit status 1: python setup.py egg_info Check the logs for full command output.
WARNING: You are using pip version 20.1.1; however, version 20.2.3 is available.
You should consider upgrading via the '/Users/weilee/Library/Caches/pypoetry/virtualenvs/kobayashi-pwI4Cysh-py3.8/bin/python -m pip install --upgrade pip' command.
</code></pre></div>
<p>web.py è¦åˆ° 0.40 æ‰æ”¯æ´ Python 3 (Ref: <a href="https://github.com/webpy/webpy/issues/180">python3 ImportError: No module named utils #180</a>)</p>
<p>å› ç‚ºæˆ‘ä¸å¤ªæƒ³æ¸¬è©¦ Python 2ï¼Œå°±å‡è¨­å°æ—çš„ç¨‹å¼ç¢¼åˆ° 0.40 éƒ½æ²’ä»€éº¼è¢«æ”¹å‹•åˆ°å¥½äº† ğŸ˜†</p>
<h3 id="_2">åˆå§‹åŒ–è³‡æ–™åº«</h3>
<p>è¦å¯¦é©—åˆ°åº•æœ‰æ²’æœ‰è¾¦æ³•å–å¾—è³‡æ–™åº«çš„è³‡æ–™ï¼Œç¸½æ˜¯è¦å…ˆæœ‰ä¸€å€‹è³‡æ–™åº«<br/>
é€™è£¡åšäº†ä¸‰ä»¶äº‹</p>
<ol>
<li>ç”¨ <code>sqlite3</code> è·Ÿ "kobayashi.db" å»ºç«‹é€£ç·š</li>
<li>å»ºç«‹ <code>USER</code> è³‡æ–™è¡¨</li>
<li>å°‡ "kobayashi", "tohru", "kanna", "elma" æ–°å¢åˆ° <code>USER</code> è³‡æ–™è¡¨ä¸­</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">sqlite3</span>


<span class="k">def</span> <span class="nf">init_db</span><span class="p">():</span>
    <span class="c1"># connect and create "kobayashi.db"</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">"kobayashi.db"</span><span class="p">)</span>

    <span class="c1"># create USER table</span>
    <span class="n">create_table_sql</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">    CREATE TABLE `USER` (</span>
<span class="s2">        `account`   TEXT NOT NULL UNIQUE,</span>
<span class="s2">        `password`  TEXT NOT NULL,</span>
<span class="s2">        PRIMARY KEY(`account`)</span>
<span class="s2">    );</span>
<span class="s2">    """</span>

    <span class="c1"># insert users into USER table</span>
    <span class="n">insert_user_sql</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">    INSERT INTO</span>
<span class="s2">        USER (account, password)</span>
<span class="s2">    VALUES</span>
<span class="s2">        ('kobayashi', '1'),</span>
<span class="s2">        ('tohru', '2'),</span>
<span class="s2">        ('kanna', '3'),</span>
<span class="s2">        ('elma', '3');</span>
<span class="s2">    """</span>

    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">create_table_sql</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">insert_user_sql</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">init_db</span><span class="p">()</span>
</code></pre></div>
<h3 id="_3">å¯¦ä½œç™»å…¥åŠŸèƒ½</h3>
<p><code>login</code> æœƒæŠŠä½¿ç”¨è€…è¼¸å…¥çš„ account è·Ÿ password å¸¶å…¥ <code>where</code><br/>
å¦‚æœåœ¨è³‡æ–™åº«æ‰¾åˆ°æ­£ç¢ºçš„åŒ¹é…ï¼Œå°±æœƒå›å‚³æ‰¾åˆ°çš„ç¬¬ä¸€ç­† user<br/>
å¦‚æœæ‰¾ä¸åˆ°å°±å›å‚³ <code>None</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span> <span class="nn">web</span>


<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">web</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">Storage</span><span class="p">]:</span>
    <span class="n">result_set</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"USER"</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="sa">f</span><span class="s2">"account ='</span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2">' AND password='</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">result_set</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"login succeeded"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">user</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"wrong username or password"</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
<p>é€™è£¡ç”¨ä¸‰å€‹æ¡ˆä¾‹ä¾†æ¸¬è©¦</p>
<ol>
<li>éŒ¯èª¤çš„å¸³è™Ÿå¯†ç¢¼ â†’ ä¸æ‡‰è©²å–å¾— user</li>
<li>æ­£ç¢ºçš„å¸³è™Ÿå¯†ç¢¼ â†’ æ‡‰è©²å–å¾— user</li>
<li>SQL injection â†’ ç†æƒ³ä¸Šï¼Œä¹Ÿä¸è©²å–å¾— user</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">database</span><span class="p">(</span><span class="n">dbn</span><span class="o">=</span><span class="s2">"sqlite"</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="s2">"kobayashi.db"</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">login</span><span class="p">(</span><span class="s2">"kobayashi"</span><span class="p">,</span> <span class="s2">""</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">login</span><span class="p">(</span><span class="s2">"kobayashi"</span><span class="p">,</span> <span class="s2">"1"</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">login</span><span class="p">(</span><span class="s2">"1' OR '1'='1"</span><span class="p">,</span> <span class="s2">"1' OR '1'='1"</span><span class="p">))</span>
</code></pre></div>
<p>ä½†é€™å€‹ä¸–ç•Œå§‹çµ‚ä¸ç†æƒ³ï¼ŒåŒ…å«äº† SQL injection çš„ç¨‹å¼æˆåŠŸå–å¾— user<br/>
ä¹‹æ‰€ä»¥åªå–åˆ°ä¸€ç­† userï¼Œæ˜¯å› ç‚º <code>login</code> åªæœƒå›å‚³ç¬¬ä¸€å€‹ç‰©ä»¶ï¼Œä½†é€™æ®µ SQL æ˜¯èƒ½å–åˆ°æ•´å€‹è³‡æ–™åº«çš„ user çš„</p>
<div class="highlight"><pre><span></span><code>0.0 (1): SELECT * FROM USER WHERE account ='kobayashi' AND password=''
wrong username or password
None

0.0 (2): SELECT * FROM USER WHERE account ='kobayashi' AND password='1'
login succeeded
&lt;Storage {'account': 'kobayashi', 'password': '1'}&gt;

0.0 (3): SELECT * FROM USER WHERE account ='1' OR '1'='1' AND password='1' OR '1'='1'
login succeeded
&lt;Storage {'account': 'kobayashi', 'password': '1'}&gt;
</code></pre></div>
<h3 id="_4">è©²å¦‚ä½•ä¿®æ­£ï¼Ÿ</h3>
<p>ä¿®æ­£çš„æ–¹å¼å¾ˆç°¡å–®ï¼Œåªè¦åœ¨å‘¼å« select çš„æ™‚å€™ç”¨ <code>vars</code> å°‡åƒæ•¸å¸¶é€² <code>where</code> å³å¯<br/>
å…¶å¯¦ web.py çš„æ–‡ä»¶å°±æœ‰å¯«äº† (Ref: <a href="https://webpy.org/cookbook/query">db.query</a>)</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">web</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">Storage</span><span class="p">]:</span>
    <span class="n">result_set</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="s2">"USER"</span><span class="p">,</span>
        <span class="n">where</span><span class="o">=</span><span class="sa">f</span><span class="s2">"account=$account AND password=$password"</span><span class="p">,</span>
        <span class="nb">vars</span><span class="o">=</span><span class="p">{</span><span class="s2">"account"</span><span class="p">:</span> <span class="n">account</span><span class="p">,</span> <span class="s2">"password"</span><span class="p">:</span> <span class="n">password</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">result_set</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"login succeeded"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">user</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"wrong username or password"</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
<p>é€™æ¬¡å°±ç®—ç”¨åŸæœ¬ SQL injetion çš„ä½œæ³•ï¼Œä¹Ÿå–ä¸åˆ°ä»»ä½•çš„è³‡æ–™<br/>
å› ç‚ºæ²’æœ‰ account æ˜¯ <code>"1' OR '1'='1"</code></p>
<div class="highlight"><pre><span></span><code>0.0 (3): SELECT * FROM USER WHERE account ="1' OR '1'='1" AND password="1' OR '1'='1"
wrong username or password
None
</code></pre></div>
<h2 id="_5">çŸ¥å…¶ç„¶é‚„è¦çŸ¥å…¶æ‰€ä»¥ç„¶å•Šï¼</h2>
<p>é™¤äº†çŸ¥é“æ€éº¼ä¿®æ­£å¤–ï¼Œæˆ‘é‚„æƒ³çŸ¥é“ web.py åšäº†ä»€éº¼<br/>
ä¸‹é¢å†—é•·çš„ç´€éŒ„æˆ‘è¿½ web.py åŸå§‹ç¢¼çš„éç¨‹</p>
<h3 id="pdbpp">pdbpp</h3>
<p>å¯«é€™ç¯‡æ–‡ç« æœ€å¤§çš„æ”¶ç©«ï¼Œå¤§æ¦‚å°±æ˜¯å¤§å¹…çš„æå‡äº†æˆ‘å° pdb çš„ç†Ÿæ‚‰åº¦<br/>
å‰›å¥½è½åˆ°å»£æ’­ <a href="https://pythonbytes.fm/">Python Bytes</a> æ¨è–¦çš„ <a href="https://github.com/pdbpp/pdbpp">pdbpp</a> å°±é †æ‰‹ç©äº†ä¸€ä¸‹<br/>
pdbpp åœ¨å®‰è£å¾Œæœƒå–ä»£åŸç”Ÿçš„ pdb<br/>
ä¸»è¦æœ‰é€™å…©å€‹åŠŸèƒ½æ¯” pdb å¥½ç”¨</p>
<ol>
<li>syntax highlight<ul>
<li>ä¸ééœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¦èƒ½å®¢è£½åŒ– highlight é¢¨æ ¼ï¼Œéœ€è¦ç›´æ¥å¾ master branch å®‰è£çš„ç‰ˆæœ¬ï¼Œç›®å‰é‚„æ²’æŠŠé€™å€‹ä¿®æ­£é‡‹å‡ºåˆ° PyPI ä¸Š</li>
</ul>
</li>
<li>sticky modeï¼ˆåœ¨é™¤éŒ¯å™¨çš„ä¸Šæ–¹ä¸€ç›´é¡¯ç¤ºç›®å‰è¿½åˆ°çš„ç¨‹å¼ç¢¼ï¼‰</li>
</ol>
<p><img alt="sticky mode example" src="/images/posts-image/2020-will-kobayashi-s-code-encounter-sql-injection/sticky mode.jpg"/></p>
<p>é †ä¾¿è¨˜éŒ„ä¸€ä¸‹å¸¸ç”¨åˆ°çš„ pdbpp æŒ‡ä»¤</p>
<ul>
<li><code>n</code>: ä¸‹ä¸€è¡Œ</li>
<li><code>s</code>: é€²åˆ°å‡½å¼</li>
<li><code>p [var]</code> (e.g., <code>p locals()</code>): å°å‡ºè®Šæ•¸ var</li>
<li><code>args</code>: å°å‡ºåƒæ•¸</li>
<li><code>ll</code>: é¡¯ç¤ºç¾åœ¨åœ¨åŸå§‹ç¢¼çš„å“ªè£¡ï¼ˆåŸæœ¬ pdb çš„ longlistï¼‰</li>
</ul>
<h3 id="webpy">è¿½ web.py åŸå§‹ç¢¼</h3>
<p>é€™éƒ¨åˆ†çš„ç´€éŒ„æ–¹å¼æœƒæ˜¯æ¯é€²åˆ°ä¸€æ¬¡å‡½å¼ (åœ¨ pdb è£¡é¢ä½¿ç”¨ <code>s</code>) å°±æœƒåŠ ä¸€å€‹å››ç´šæ¨™é¡Œ<br/>
å›åˆ°åŸæœ¬çš„å‡½å¼ï¼Œå‰‡æœƒåœ¨æ¨™é¡Œå¾Œé¢åŠ ä¸€å€‹ back</p>
<p>é¦–å…ˆç•¶ç„¶æ˜¯å¾ <code>login</code> å‘¼å«åˆ° <code>db.select</code> å‡½å¼é–‹å§‹è¿½å›å»</p>
<h4 id="webdbpydbselect">web/db.py::DB::select</h4>
<ul>
<li>ä½ç½®: <a href="https://github.com/webpy/webpy/blob/0.40/web/db.py#L845">web/db.py#L845</a></li>
</ul>
<p>è·‘å®Œ 874 è¡Œçš„ list comprehension å¾Œï¼Œ<code>clauses</code> æœƒåŒ…å«ä»¥ä¸‹å››å€‹éƒ¨åˆ†</p>
<div class="highlight"><pre><span></span><code>(Pdb++) p clauses
[&lt;sql: 'SELECT *'&gt;, &lt;sql: 'FROM USER'&gt;, &lt;sql: 'WHERE account ="1\' OR \'1\'=\'1" AND password="1\' OR \'1\'=\'1"'&gt;]
</code></pre></div>
<p>çœ‹èµ·ä¾†å·²ç¶“æˆåŠŸå°‡ç‰¹æ®Šå­—å…ƒè·³è„«ï¼Œè§£æ±º SQL injection<br/>
æ‰€ä»¥æ¥ä¸‹ä¾†è¦å»è¿½ç”¢ç”Ÿ <code>clause</code> çš„ <code>gen_clause</code></p>
<h4 id="webdbpydbgen_clause">web/db.py::DB::gen_clause</h4>
<ul>
<li>ä½ç½®: <a href="https://github.com/webpy/webpy/blob/0.40/web/db.py#L934">web/db.py#L934</a></li>
</ul>
<p><code>gen_clause</code> æœƒè¢«å‘¼å«ä¸‰æ¬¡ï¼Œç•¶è¼¸å…¥çš„åƒæ•¸ sql æ˜¯ <code>WHERE</code> æ™‚ï¼ŒæœƒåŸ·è¡Œåˆ° 948 è¡Œçš„ <code>nout = reparam(val, vars)</code><br/>
æ­¤æ™‚è¼¸å…¥çš„å„å€‹åƒæ•¸å¦‚ä¸‹</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">sql</span>
<span class="s1">'WHERE'</span>

<span class="p">(</span><span class="n">Pdb</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">val</span>
<span class="s1">'account =$account AND password=$password'</span>

<span class="p">(</span><span class="n">Pdb</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">vars</span>
<span class="p">{</span><span class="s1">'account'</span><span class="p">:</span><span class="w"> </span><span class="s2">"1' OR '1'='1"</span><span class="p">,</span><span class="w"> </span><span class="s1">'password'</span><span class="p">:</span><span class="w"> </span><span class="s2">"1' OR '1'='1"</span><span class="p">}</span>
</code></pre></div>
<h4 id="webdbpyreparam">web/db.py::reparam</h4>
<ul>
<li>ä½ç½®: <a href="https://github.com/webpy/webpy/blob/0.40/web/db.py#L344">web/db.py#L344</a></li>
<li>åƒæ•¸:<ul>
<li>val = <code>'account =$account AND password=$password'</code></li>
<li>vars = <code>{'account': "1' OR '1'='1", 'password': "1' OR '1'='1"}</code></li>
</ul>
</li>
</ul>
<p>ä¸€é€²åˆ° <code>reparm</code> ï¼Œé€™äº›å€¼å°±æœƒç¹¼çºŒè¢«å‚³åˆ° <code>safteval</code></p>
<h4 id="webdbpysafeevalsafeeval">web/db.py::SafeEval::safeeval</h4>
<ul>
<li>ä½ç½®: <a href="https://github.com/webpy/webpy/blob/0.40/web/db.py#L1699">web/db.py#L1699</a></li>
<li>å¸¶å…¥åƒæ•¸<ul>
<li>text = <code>'account =$account AND password=$password'</code></li>
<li>mapping = <code>{'account': "1' OR '1'='1", 'password': "1' OR '1'='1"}</code></li>
</ul>
</li>
</ul>
<p>1700 è¡Œçš„ <code>Parser</code> æœƒå°‡ text åˆ†è§£æˆå››å€‹ SQL çš„éƒ¨åˆ†ï¼Œä¸¦ä¸”å°‡ nodes é€£åŒ mapping ä¸€å€‹ä¸€å€‹å¸¶å…¥ <code>eval_node</code></p>
<div class="highlight"><pre><span></span><code>(Pdb++) p list(nodes)
[Node('text', 'account =', None), Node('param', 'account', None), Node('text', ' AND password=', None), Node('param', 'password', None)]
</code></pre></div>
<h4 id="webdbpysafeevaleval_node">web/db.py::SafeEval::eval_node</h4>
<ul>
<li>ä½ç½®: <a href="https://github.com/webpy/webpy/blob/0.40/web/db.py#L1703">web/db.py#L1703</a></li>
</ul>
<p><code>self.eval_expr</code> çš„åŠŸç”¨æ˜¯åœ¨è®“ <code>node[1]</code> èƒ½æŠ“åˆ° <code>"1' OR '1'='1"</code><br/>
æŠ“åˆ°äº†å­—ä¸² <code>"1' OR '1'='1"</code> å¾Œæœƒä¸Ÿåˆ° <code>sqlquote</code></p>
<h4 id="webdbpysqlquote">web/db.py::sqlquote</h4>
<ul>
<li>ä½ç½®: <a href="https://github.com/webpy/webpy/blob/0.40/web/db.py#L463">463è¡Œ</a></li>
<li>åƒæ•¸:<ul>
<li>a = <code>"1' OR '1'='1"</code></li>
</ul>
</li>
</ul>
<p>a æœƒåœ¨ 475 è¡Œè¢«åˆå§‹åŒ–æˆ <a href="https://github.com/webpy/webpy/blob/0.40/web/db.py#L93">SQLParam</a> ç‰©ä»¶ ï¼Œç„¶å¾Œå†ç”¢ç”Ÿ <a href="https://github.com/webpy/webpy/blob/0.40/web/db.py#L142">SQLQuery</a> ç‰©ä»¶</p>
<h4 id="webdbpysafeevaleval_node-back">web/db.py::SafeEval::eval_node (back)</h4>
<ul>
<li>ä½ç½®: <a href="https://github.com/webpy/webpy/blob/0.40/web/db.py#L1703">web/db.py#L1703</a></li>
</ul>
<p>å›åˆ° <code>eval_node</code> ï¼Œå°±æœƒæŠŠå‰›å‰›çš„çµæœ <code>&lt;sql: '"1\' OR \'1\'=\'1"'&gt;</code> (<code>SQLQuery</code> ç‰©ä»¶å°å‡ºçš„å½¢å¼) å›å‚³</p>
<h4 id="webdbpysafeevalsafeeval-back">web/db.py::SafeEval::safeeval (back)</h4>
<ul>
<li>ä½ç½®: <a href="https://github.com/webpy/webpy/blob/0.40/web/db.py#L1699">web/db.py#L1699</a></li>
</ul>
<p>1701 è¡Œçš„ <code>[self.eval_node(node, mapping) for node in nodes]</code> æœƒç”¢ç”Ÿ</p>
<!-- blacken-docs:off -->
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span>
<span class="p">[</span><span class="s1">'account ='</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">sql</span><span class="p">:</span> <span class="s1">'"1</span><span class="se">\'</span><span class="s1"> OR </span><span class="se">\'</span><span class="s1">1</span><span class="se">\'</span><span class="s1">=</span><span class="se">\'</span><span class="s1">1"'</span><span class="o">&gt;</span><span class="p">,</span> <span class="s1">' AND password='</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">sql</span><span class="p">:</span> <span class="s1">'"1</span><span class="se">\'</span><span class="s1"> OR </span><span class="se">\'</span><span class="s1">1</span><span class="se">\'</span><span class="s1">=</span><span class="se">\'</span><span class="s1">1"'</span><span class="o">&gt;</span><span class="p">]</span>
</code></pre></div>
<!-- blacken-docs:on -->
<p>é€™å€‹ list æœƒæ¥è‘—è¢«å¸¶å…¥ <code>SQLQuery.join</code> æ•´åˆæˆä¸€æ•´å€‹ SQL çš„ç‰‡æ®µ</p>
<h4 id="webdbpysqlqueryjoin">web/db.py::SQLQuery::join</h4>
<ul>
<li>ä½ç½®: <a href="https://github.com/webpy/webpy/blob/0.40/web/db.py#L254">web/db.py#L254</a></li>
</ul>
<p>277 ~ 285 è¡Œçš„ for loop åŸ·è¡Œå®Œæœƒç”¢ç”Ÿä¸€å€‹æ–°çš„ target (<code>SQLQuery</code> ç‰©ä»¶)</p>
<div class="highlight"><pre><span></span><code>(Pdb++) p target
&lt;sql: 'account ="1\' OR \'1\'=\'1" AND password="1\' OR \'1\'=\'1"'&gt;

(Pdb++) p target.items
['account =', &lt;param: "1' OR '1'='1"&gt;, ' AND password=', &lt;param: "1' OR '1'='1"&gt;]

(Pdb++) p target.values()
["1' OR '1'='1", "1' OR '1'='1"]

(Pdb++) p target.query()
'account =%s AND password=%s'
</code></pre></div>
<p>å¯ä»¥ç™¼ç¾é€™æ™‚å€™è¦å›å‚³çš„ <code>SQLQuery</code> ç‰©ä»¶å·²ç¶“æŠŠæŸ¥è©¢æ™‚è·Ÿè¦å¸¶å…¥çš„å€¼åˆ†é–‹å„²å­˜</p>
<h4 id="webdbpyreparamback">web/db.py::reparamï¼ˆbackï¼‰</h4>
<ul>
<li>ä½ç½®: <a href="https://github.com/webpy/webpy/blob/0.40/web/db.py#L344">web/db.py#L344</a></li>
</ul>
<h4 id="webdbpydbgen_clause-back">web/db.py::DB::gen_clause (back)</h4>
<ul>
<li>ä½ç½®: <a href="https://github.com/webpy/webpy/blob/0.40/web/db.py#L948">web/db.py#L948</a></li>
</ul>
<p>åœ¨ 956 è¡Œï¼Œå‰›å‰›å›å‚³çš„ <code>nout</code> æœƒé€é <code>xjoin</code> è·Ÿå­—ä¸² <code>WHERE</code> æ•´åˆæˆä¸€å€‹æ–°çš„ <code>SQLQuery</code> ç‰©ä»¶<br/>
å­—ä¸²è·Ÿ <code>SQLQuery</code> ç›¸åŠ çš„è¡Œç‚ºè¢«å®šç¾©åœ¨ <a href="https://github.com/webpy/webpy/blob/0.40/web/db.py#L196">196 è¡Œ</a> çš„ <code>__radd__</code><br/>
ä½†å› ç‚ºæ²’æœ‰ä»€éº¼å¤ªæ„æ–™ä¹‹å¤–çš„è¡Œç‚ºï¼Œé€™è£¡å°±ä¸ç¹¼çºŒè¿½ä¸‹å»äº†</p>
<h4 id="webdbpydbselect-back">web/db.py::DB::select (back)</h4>
<ul>
<li>ä½ç½®: <a href="https://github.com/webpy/webpy/blob/0.40/web/db.py#L874">web/db.py#L874</a></li>
</ul>
<p>å–å¾—äº†å›å‚³çš„ <code>clauses</code> å¾Œï¼Œå®ƒæœƒåœ¨ 879 è¡Œçš„ <code>SQLQuery.join</code> æ•´åˆæˆä¸€å€‹ <code>SQLQuery</code> ç‰©ä»¶<br/>
ç”¢ç”Ÿ <code>qout</code></p>
<div class="highlight"><pre><span></span><code>(Pdb++) p qout
&lt;sql: 'SELECT * FROM USER WHERE account ="1\' OR \'1\'=\'1" AND password="1\' OR \'1\'=\'1"'&gt;
</code></pre></div>
<p>æœ€å¾Œå°±è¦çœ‹ 884 è¡Œçš„ <code>self.query(qout, processed=True)</code> æ˜¯ä¸æ˜¯çœŸçš„æœƒä»¥åƒæ•¸åŒ–çš„æ–¹å¼åŸ·è¡Œé€™æ®µ SQL</p>
<h4 id="webdbpydbquery">web/db.py::DB::query</h4>
<ul>
<li>ä½ç½®: <a href="https://github.com/webpy/webpy/blob/0.40/web/db.py#L807">web/db.py#L807</a></li>
</ul>
<p>åŸ·è¡Œåˆ° 831 è¡Œ <code>self._db_execute(db_cursor, sql_query)</code> æ‰æœƒç”¨åˆ°å‚³é€²ä¾†çš„ <code>sql_query</code></p>
<h4 id="webdbpydb_db_execute">web/db.py::DB::_db_execute</h4>
<ul>
<li>ä½ç½®: <a href="https://github.com/webpy/webpy/blob/0.40/web/db.py#L750">web/db.py#L750</a></li>
</ul>
<p>åœ¨ 756 è¡Œçš„ <code>_process_query</code> ç”¢ç”Ÿè¦åŸ·è¡Œçš„ SQL query è·Ÿå®ƒçš„åƒæ•¸ï¼Œå›å‚³çš„çµæœåˆ†åˆ¥æ˜¯</p>
<ul>
<li>query = <code>'SELECT * FROM USER WHERE account =? AND password=?'</code></li>
<li>params = <code>["1' OR '1'='1", "1' OR '1'='1"])</code></li>
</ul>
<p>å†å¸¶åˆ° 757 è¡Œçš„<code>out = cur.execute(query, params)</code> ç›´æ¥å°è³‡æ–™åº«ä½œæŸ¥è©¢ï¼Œæ‰€ä»¥å°±ä¸æœƒé‡åˆ° SQL injection äº†</p>
<h4 id="delete">åŸæœ¬å¥½åƒæ˜¯è¦è¿½ delete æ‰å°</h4>
<p>é¡§è‘—é‡ç¾ç¶­åŸºç™¾ç§‘çš„ä¾‹å­ï¼Œç«Ÿç„¶å¿˜è¨˜äº†åŸæœ¬è¦è¿½çš„å…¶å¯¦æ˜¯å¦ä¸€æ®µç¨‹å¼ç¢¼<br/>
ä¸éæˆ‘æƒ³æœ¬è³ªæ‡‰è©²é‚„æ˜¯ç›¸åŒçš„<br/>
æœ‰èˆˆè¶£çš„è©±ï¼Œå¯ä»¥æ‹¿ä»¥ä¸‹é€™æ®µ SQL ä¾†æ¸¬æ¸¬çœ‹ delete çš„ SQL injection æ˜¯ä¸æ˜¯çœŸçš„èƒ½æ¸…ç©ºæ•´å€‹è³‡æ–™è¡¨<br/>
<strong>disclaimer: è«‹ä¸è¦æ‹¿å®ƒç”¨åœ¨æœƒå½±éŸ¿åˆ°å…¶ä»–äººçš„ç¨‹å¼ä¸Š (e.g., production ç’°å¢ƒ)</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="s1">''</span><span class="o">=</span><span class="s1">''</span>
</code></pre></div>
<p><img alt="xkcd joke" src="https://imgs.xkcd.com/comics/exploits_of_a_mom.png"/></p>
<blockquote>
<p>ä½ æ˜¯ä¸æ˜¯çœŸçš„æŠŠä½ çš„å…’å­å–åç‚º <code>Rober'); DROP TABLE Students;</code></p>
</blockquote>
<h2 id="_6">çµèª</h2>
<p>çµè«–æ˜¯ã€Œé›–ç„¶å°æ—çš„ç¨‹å¼ç¢¼å¯èƒ½é‡åˆ° SQL injectionï¼Œä½†ä¹Ÿå­˜åœ¨è‘—å¾ˆç°¡å–®çš„è§£æ±ºæ–¹æ¡ˆï¼Œåªè¦ä½¿ç”¨è€…æœ‰è®€æ–‡ä»¶ï¼Œæ‡‰è©²å°±ä¸æœƒé‡åˆ°ã€<br/>
æˆ‘å®Œå…¨ä¸æ˜¯è³‡è¨Šå®‰å…¨çš„å°ˆå®¶ï¼Œåªæ˜¯æŠ±æŒè‘—å°äº¬éƒ½å‹•ç•«å’Œ Python çš„æ„›ä¾†è¿½é€™æ®µç¨‹å¼ç¢¼<br/>
å¦‚æœæœ‰èªªéŒ¯æˆ–å¯ä»¥è£œå……çš„éƒ¨åˆ†ï¼Œå†éº»ç…©ç•™è¨€è®“æˆ‘çŸ¥é“ ğŸ™</p>
<p>å…¶å¯¦å°æ—å®¶çš„é¾å¥³åƒ•ï¼Œé‚„æœ‰å…¶ä»–å ´æ™¯ä¹Ÿæœ‰å‡ºç¾ Python<br/>
åƒæ˜¯é€™è£¡èªªäº†å°æ—è‡ªå¾é–‹å§‹å¯« Python å¾Œè®Šå¾—é–‹æœ—äº†è¨±å¤šå‘¢ï¼ˆèª¤</p>
<p><img alt="kobayashi becomes hayppier" src="/images/posts-image/2020-will-kobayashi-s-code-encounter-sql-injection/kobayashi becomes hayppier.png"/></p>
<p>æˆ‘ä¹Ÿæ˜¯è‡ªå¾å¯«äº† Python å¾Œï¼Œæ¯æ¬¡è€ƒè©¦éƒ½è€ƒ 100 åˆ†å‘¢ï¼ˆä¸¦æ²’æœ‰ï¼‰<br/>
æ‰€ä»¥å¤§å®¶ä¸€èµ·ä¾†å¯« Python å§ ğŸ<br/>
é‚£å¯« Python çš„äººæœ€å¥½çš„äº¤æµå¹³å°æ˜¯ä»€éº¼å‘¢ ğŸ¤”<br/>
ç•¶ç„¶æ˜¯ <a href="https://tw.pycon.org/">PyCon TW</a> å•Š ğŸ¤©<br/>
ä¾†ç•¶ PyCon TW å¿—å·¥ï¼Œè·Ÿå¤§å®¶äº¤æµ Pythonï¼Œè®Šæˆä¸€å€‹é–‹æœ—çš„äººå§ ğŸ’ª</p>
<h2 id="one-more-thing">One more thing</h2>
<p>å»å¹´ä¸ƒæœˆä¸€å ´ä¸å¹¸çš„ç¸±ç«æ¡ˆï¼Œå¤§å¤§çš„é‡å‰µäº†äº¬éƒ½å‹•ç•«<br/>
PyCon JP 2019 æ™‚ï¼Œæˆ‘ä¹Ÿå»äº†é·²å®®ç¥ç¤¾ç•™ä¸‹æˆ‘çš„ç¥ç¦<br/>
ä¸æœƒæ—¥æ–‡çš„æˆ‘ï¼Œå°±åªç°¡å–®çš„å¯«äº† <strong>Pray for Kyoani</strong></p>
<p><img alt="pray for kyoani" src="/images/posts-image/2020-will-kobayashi-s-code-encounter-sql-injection/pray for kyoani.jpg"/></p>
<p>å³ä¾¿å¦‚æ­¤ï¼Œäº¬é˜¿å°¼é‚„æ˜¯å¾ˆå¿«å°±ç«™èµ·ä¾†<br/>
ä¸€å¹´éå¾Œçš„ç¾åœ¨å®£å¸ƒã€Œå°æ—å®¶çš„é¾å¥³åƒ•å°‡æ–¼ 2021 å¹´é–‹æ’­ ã€ğŸ‰</p>
<blockquote class="twitter-tweet"><p dir="ltr" lang="ja">TVã‚¢ãƒ‹ãƒ¡ç¬¬2æœŸã€Œå°æ—ã•ã‚“ã¡ã®ãƒ¡ã‚¤ãƒ‰ãƒ©ã‚´ãƒ³Sã€2021å¹´æ”¾é€æ±ºå®šï¼Superã§SupremeãªSecond lifeãŒStartã—ã¾ã™ï¼<br/>ãã—ã¦ã€ãƒ¡ã‚¤ãƒ‰ãƒ©ã‚´ãƒ³S(èª­ã¿:ã‚¨ã‚¹)ãƒ†ã‚£ã‚¶ãƒ¼ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«å…¬é–‹ï¼ãƒ†ã‚£ã‚¶ãƒ¼ã‚µã‚¤ãƒˆã‚‚ãœã²ãƒã‚§ãƒƒã‚¯ãŠé¡˜ã„ã—ã¾ã™ï¼ã€€<a href="https://t.co/pKOgbEe3sL">https://t.co/pKOgbEe3sL</a> <a href="https://twitter.com/hashtag/meidragon?src=hash&amp;ref_src=twsrc%5Etfw">#meidragon</a> <a href="https://t.co/XoyiBPbnvt">pic.twitter.com/XoyiBPbnvt</a></p>â€” TVã‚¢ãƒ‹ãƒ¡ã€Œå°æ—ã•ã‚“ã¡ã®ãƒ¡ã‚¤ãƒ‰ãƒ©ã‚´ãƒ³Sã€å…¬å¼ (@maidragon_anime) <a href="https://twitter.com/maidragon_anime/status/1292838380187746305?ref_src=twsrc%5Etfw">August 10, 2020</a></blockquote>
<script async="" charset="utf-8" src="https://platform.twitter.com/widgets.js"></script>
</section>
<section class="post-footer">
<div class="post-share">
<span class="post-info-label">Share</span>
<a aria-label="Twitter" class="twitter" href="https://twitter.com/share?text=å°æ—çš„ç¨‹å¼æœƒä¸æœƒé‡åˆ° SQL Injection &amp;url=https://blog.wei-lee.me/posts/tech/2020/09/will-kobayashi-s-code-encounter-sql-injection" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Twitter">
<i aria-hidden="true" class="icon icon-twitter"></i><span class="hidden">Twitter</span>
</a>
<a aria-label="Facebook" class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.wei-lee.me/posts/tech/2020/09/will-kobayashi-s-code-encounter-sql-injection" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Facebook">
<i aria-hidden="true" class="icon icon-facebook"></i><span class="hidden">Facebook</span>
</a>
<a aria-label="LinkedIn" class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://blog.wei-lee.me/posts/tech/2020/09/will-kobayashi-s-code-encounter-sql-injection&amp;title=å°æ—çš„ç¨‹å¼æœƒä¸æœƒé‡åˆ° SQL Injection" onclick="window.open(this.href, 'linkedin-share', 'width=930,height=720');return false;" title="LinkedIn">
<i aria-hidden="true" class="icon icon-linkedin"></i><span class="hidden">LinkedIn</span>
</a>
<a aria-label="Email" class="email" href="mailto:?subject=å°æ—çš„ç¨‹å¼æœƒä¸æœƒé‡åˆ° SQL Injection&amp;body=https://blog.wei-lee.me/posts/tech/2020/09/will-kobayashi-s-code-encounter-sql-injection" title="Email">
<i aria-hidden="true" class="icon icon-mail"></i><span class="hidden">Email</span>
</a>
<div class="clear"></div>
</div>
<aside class="post-tags">
<a href="https://blog.wei-lee.me/tag/python.html">Python</a><a href="https://blog.wei-lee.me/tag/anime.html">Anime</a> </aside>
<div class="clear"></div>
</section>
<script type="text/javascript">var use_utterance = true;</script>
<section class="post-comments">
<script async="" crossorigin="anonymous" data-issue-term="https://blog.wei-lee.me/posts/tech/2020/09/will-kobayashi-s-code-encounter-sql-injection" data-label="blog-comment" data-repo="Lee-W/main-blog" data-theme="github-light" src="https://utteranc.es/client.js">
</script>
</section>
<aside class="post-nav">
<div class="clear"></div>
</aside>
</div>
</article>
</main>
<div class="nav-footer">
<nav aria-label="Footer" class="nav-wrapper">
<span class="nav-copy">Those aren't written down are meant to be forgotten Â© 2023
          <a class="nav-rss" href="https://blog.wei-lee.me/feeds/all.atom.xml" target="_blank" title="RSS"><i class="icon icon-rss"></i></a>
</span>
<span class="nav-credits">



          Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a> â€¢ Theme <a href="https://github.com/arulrajnet/attila" rel="nofollow">Attila</a> â€¢
          <a class="menu-item js-theme" data-dark="Dark theme" data-light="Light theme" data-system="System theme" href="#">
<span class="theme-icon"></span><span class="theme-text">System theme</span>
</a>
</span>
</nav>
</div>
</section>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
<!-- TODO: minify -->
<script src="https://blog.wei-lee.me/theme/js/jquery.fitvids.js" type="text/javascript"></script>
<script src="https://blog.wei-lee.me/theme/js/script.js" type="text/javascript"></script>
<script src="https://blog.wei-lee.me/theme/js/clipboard.min.js" type="text/javascript"></script>
<script src="https://blog.wei-lee.me/theme/js/copy-to-clipboard.js" type="text/javascript"></script>
<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3J7XQ46QH5"></script>
<script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-3J7XQ46QH5', { 'anonymize_ip': true });
    </script>
<script src="/pagefind/pagefind-ui.js"></script>
<script>
      window.addEventListener('DOMContentLoaded', (event) => {
          new PagefindUI({
              element: "#search",
              showImages: false,
          });
      });
  </script>
<!-- 	The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in article.html, but it needs to be included down here, after jQuery has already loaded. -->
<!-- Add MathJax and FontAwesome for Asciidoc -->\
<script>
  $(document).ready(function () {
    var viewport = $(window);
    var post = $('.post-content');
    // Responsive videos with fitVids
    post.fitVids();

    var mdSelector=".highlight pre code";
    var rstSelector=".highlight pre code";
    // For ":source-highlighter: highlight.js`" in asciidoc
    var adocSelector="pre.highlight > code[data-lang]"
    var selector=mdSelector;
    // Format code blocks and add line numbers
    function codestyling() {
      $(selector).each(function(i, e) {
        // Code highlight
        hljs.highlightElement(e);
        // No lines for plain text blocks
        if (!$(this).hasClass('language-text')) {
          var code = $(this);
          // Calculate amount of lines
          var lines = code.html().split(/\n(?!$)/g).length;
          var numbers = [];
          if (lines > 1) {
            lines++;
          }
          for (i = 1; i < lines; i++) {
            numbers += '<span class="line" aria-hidden="true">' + i + '</span>';
          }
          code.parent().append('<div class="lines">' + numbers + '</div>');
        }
      });
    }

    // Format code blocks only
    function codestylingWithoutLineNumbers() {
      $(selector).each(function(i, e) {
        // Code highlight
        hljs.highlightElement(e);
      });
    }

    codestylingWithoutLineNumbers();
    // Reading progress bar on window top
    function readingProgress() {
      var postBottom = post.offset().top + post.height();
      var viewportHeight = viewport.height();
      var progress = 100 - (((postBottom - (viewport.scrollTop() + viewportHeight) + viewportHeight / 3) / (postBottom - viewportHeight + viewportHeight / 3)) * 100);
      $('.progress-bar').css('width', progress + '%');
      (progress > 100) ? $('.progress-container').addClass('complete'): $('.progress-container').removeClass('complete');
    }
    readingProgress();
    // Trigger reading progress
    viewport.on({
      'scroll': function() {
        readingProgress();
      },
      'resize': function() {
        readingProgress();
      },
      'orientationchange': function() {
        readingProgress();
      }
    });

  });
</script>
</body>
</html>
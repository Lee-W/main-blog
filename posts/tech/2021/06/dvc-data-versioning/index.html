
<!DOCTYPE html>

<html lang="zh-tw">
<head>
<meta charset="utf-8"/>
<meta charset="utf-8" content="text/html" http-equiv="Content-Type">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/>
<title>DVC - Data Versioning </title>
<meta content="True" name="HandheldFriendly"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="origin" name="referrer"/>
<meta content="Pelican" name="generator"/>
<link href="https://blog.wei-lee.me/posts/tech/2021/06/dvc-data-versioning" rel="canonical"/>
<!-- Feed -->
<link href="https://blog.wei-lee.me/feeds/all.atom.xml" rel="alternate" title="Those aren't written down are meant to be forgotten Full Atom Feed" type="application/atom+xml"/>
<!-- TODO: combine -->
<link href="https://blog.wei-lee.me/theme/css/style.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/pygments.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/pagefind-ui-custom.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/code.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/code-copy.css" rel="stylesheet" type="text/css"/>
<link href="https://blog.wei-lee.me/theme/css/custom.css" rel="stylesheet" type="text/css"/>
<link href="/pagefind/pagefind-ui.css" rel="stylesheet"/>
<!-- Custom fonts -->
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,300" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css"/>
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
<script>
    var siteUrl = 'https://blog.wei-lee.me';
  </script>
<script>
    var localTheme = localStorage.getItem('attila_theme');
    switch (localTheme) {
      case 'dark':
        document.documentElement.classList.add('theme-dark');
        break;
      case 'light':
        document.documentElement.classList.add('theme-light');
        break;
      default:
        break;
    }
  </script>
<meta content="About DVC (Data Version Control) How to use DVC? Install DVC globally Take a look at the example project Install DVC into the virtual..." name="description"/>
<meta content="Wei Lee" name="author"/>
<meta content="Data" name="tags"/>
<meta content="Version Control" name="tags"/>
<meta content="DVC" name="tags"/>
<!-- Open Graph -->
<meta content="Those aren't written down are meant to be forgotten" prefix="og: http://ogp.me/ns#" property="og:site_name">
<meta content="DVC - Data Versioning " prefix="og: http://ogp.me/ns#" property="og:title">
<meta content="About DVC (Data Version Control) How to use DVC? Install DVC globally Take a look at the example project Install DVC into the virtual..." prefix="og: http://ogp.me/ns#" property="og:description">
<meta content="zh-tw" prefix="og: http://ogp.me/ns#" property="og:locale">
<meta content="https://blog.wei-lee.me/posts/tech/2021/06/dvc-data-versioning" prefix="og: http://ogp.me/ns#" property="og:url">
<meta content="article" prefix="og: http://ogp.me/ns#" property="og:type"/>
<meta content="2021-06-14 15:18:00+08:00" prefix="og: http://ogp.me/ns#" property="article:published_time"/>
<meta content="" prefix="og: http://ogp.me/ns#" property="article:modified_time"/>
<meta content="https://blog.wei-lee.me/author/wei-lee.html" prefix="og: http://ogp.me/ns#" property="article:author"/>
<meta content="Tech" prefix="og: http://ogp.me/ns#" property="article:section">
<meta content="Data" prefix="og: http://ogp.me/ns#" property="article:tag"/>
<meta content="Version Control" prefix="og: http://ogp.me/ns#" property="article:tag"/>
<meta content="DVC" prefix="og: http://ogp.me/ns#" property="article:tag"/>
<meta content="https://blog.wei-lee.me//images/cover.jpeg" prefix="og: http://ogp.me/ns#" property="og:image"/>
<!-- Twitter Card -->
<meta content="summary_large_image" name="twitter:card"/>
<meta content="@clleew" name="twitter:site"/>
<meta content="DVC - Data Versioning " name="twitter:title"/>
<meta content="https://blog.wei-lee.me/posts/tech/2021/06/dvc-data-versioning" name="twitter:url"/>
<meta content="https://blog.wei-lee.me//images/cover.jpeg" name="twitter:image:src"/>
<meta content="About DVC (Data Version Control) How to use DVC? Install DVC globally Take a look at the example project Install DVC into the virtual..." name="twitter:description"/>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "DVC - Data Versioning",
  "headline": "DVC - Data Versioning",
  "datePublished": "2021-06-14 15:18:00+08:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Wei Lee",
    "url": "https://blog.wei-lee.me/author/wei-lee.html"
  },
  "image": "https://blog.wei-lee.me//images/cover.jpeg",
  "url": "https://blog.wei-lee.me/posts/tech/2021/06/dvc-data-versioning",
  "description": "About DVC (Data Version Control) How to use DVC? Install DVC globally Take a look at the example project Install DVC into the virtual..."
}
</script>
</meta></meta></meta></meta></meta></meta></link></meta><link href="https://blog.wei-lee.me/posts/tech/2021/06/dvc-data-versioning" rel="canonical"/><script type="application/ld+json">{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "Those aren't written down are meant to be forgotten", "item": "https://blog.wei-lee.me"}, {"@type": "ListItem", "position": 2, "name": "Posts", "item": "https://blog.wei-lee.me/posts"}, {"@type": "ListItem", "position": 3, "name": "Tech", "item": "https://blog.wei-lee.me/posts/tech"}, {"@type": "ListItem", "position": 4, "name": "2021", "item": "https://blog.wei-lee.me/posts/tech/2021"}, {"@type": "ListItem", "position": 5, "name": "06", "item": "https://blog.wei-lee.me/posts/tech/2021/06"}, {"@type": "ListItem", "position": 6, "name": "Dvc data versioning", "item": "https://blog.wei-lee.me/posts/tech/2021/06/dvc-data-versioning"}, {"@type": "ListItem", "position": 7, "name": "Index", "item": "https://blog.wei-lee.me/posts/tech/2021/06/dvc-data-versioning/index.html"}]}</script><script type="application/ld+json">{"@context": "https://schema.org", "@type": "Article", "author": {"@type": "Person", "name": "Wei Lee"}, "publisher": {"@type": "Organization", "name": "Those aren't written down are meant to be forgotten"}, "headline": "DVC - Data Versioning", "about": "Tech", "datePublished": "2021-06-14 15:18"}</script></head>
<body class="category-template">
<div class="nav-header">
<nav aria-label="Main" class="nav-wrapper">
<ul>
<li class="nav-ğŸ  Home" role="presentation"><a href="/"><span>ğŸ  Home</span></a></li>
<li class="nav-About Me" role="presentation"><a href="/pages/about-me.html"><span>About Me</span></a></li>
<li class="nav-ğŸ—„ï¸ Archives" role="presentation"><a href="/archives.html"><span>ğŸ—„ï¸ Archives</span></a></li>
<li class="nav-ğŸ“š Series" role="presentation"><a href="/series_list.html"><span>ğŸ“š Series</span></a></li>
<li class="nav-ğŸ” Search" role="presentation"><a href="/search.html"><span>ğŸ” Search</span></a></li>
<li role="presentation"><a href="https://blog.wei-lee.me/category/book.html"><span>Book</span></a></li>
<li role="presentation"><a href="https://blog.wei-lee.me/category/gossiping.html"><span>Gossiping</span></a></li>
<li class="nav-tech active" role="presentation"><a href="https://blog.wei-lee.me/category/tech.html"><span>Tech</span></a></li>
</ul>
<ul class="nav-meta">
<li class="nav-linkedin"><a aria-label="Linkedin" href="https://tw.linkedin.com/in/clleew" target="_blank"><i aria-hidden="true" class="icon icon-linkedin"></i>
<span>Linkedin</span>
</a></li>
<li class="nav-github"><a aria-label="Github" href="https://github.com/Lee-W" target="_blank"><i aria-hidden="true" class="icon icon-github"></i>
<span>GitHub</span>
</a></li>
<li class="nav-twitter"><a aria-label="Twitter" href="https://twitter.com/clleew" target="_blank"><i aria-hidden="true" class="icon icon-twitter"></i>
<span>Twitter</span>
</a></li>
<li class="nav-search" style="display: none;">
<a title="Search">
<i aria-hidden="true" class="icon icon-search"></i>
<span>Search</span>
</a>
</li>
</ul> </nav>
<div class="nav-wrapper-control">
<div class="inner">
<a class="nav-menu" role="button"><i aria-hidden="true" class="icon icon-menu"></i>Menu</a>
<a class="nav-search" role="button" style="display: none;" title="Search"><i aria-hidden="true" class="icon icon-search"></i></a>
</div>
</div>
</div>
<div aria-label="Close" class="nav-close" role="button"></div>
<section class="page-wrapper" id="wrapper">
<!-- Progressbar -->
<div class="progress-container">
<span class="progress-bar"></span>
</div>
<!-- Page Header -->
<!-- Set your background image for this header on the line below. -->
<header class="post-header has-cover">
<div class="inner">
<span class="post-info">
<span class="post-type">Article</span>
<span class="post-count">Tech</span>
</span>
<h1 class="post-title">
            DVC - Data Versioning
        </h1>
<div class="post-meta">
<div class="post-meta-avatars">
<figure class="post-meta-avatar avatar">
<a class="author-avatar" href="https://blog.wei-lee.me/author/wei-lee.html">
<img alt="Wei Lee" class="author-profile-image" src="https://blog.wei-lee.me//images/avatar.jpeg"/>
</a>
</figure>
</div>
<h4 class="post-meta-author">
            Wei Lee
          </h4>
<time datetime="2021/06/14 - Mon">2021/06/14 - Mon</time>
          â€¢ 7 min read
        </div>
<div class="post-cover cover">
<img alt="Category Tech" src="https://blog.wei-lee.me//images/cover.jpeg"/>
</div>
</div>
</header>
<!-- Post content -->
<main class="content" data-pagefind-body="" role="main">
<article class="post">
<div class="inner">
<section class="post-content">
<!--more-->
<div class="toc">
<ul>
<li><a href="#about-dvc-data-version-control">About DVC (Data Version Control)</a></li>
<li><a href="#how-to-use-dvc">How to use DVC?</a><ul>
<li><a href="#install-dvc-globally">Install DVC globally</a></li>
<li><a href="#take-a-look-at-the-example-project">Take a look at the example project</a></li>
<li><a href="#install-dvc-into-the-virtual-environment">Install DVC into the virtual environment</a></li>
<li><a href="#initialize-dvc">Initialize DVC</a></li>
<li><a href="#add-dvc-remote">Add DVC remote</a></li>
<li><a href="#track-data-through-dvc">Track data through DVC</a></li>
<li><a href="#fetch-data-from-dvc-remote-storage">Fetch data from DVC remote storage</a></li>
<li><a href="#add-data-changes-into-dvc">Add data changes into DVC</a></li>
<li><a href="#fetch-code-and-data-changes-from-remote">Fetch code and data changes from remote</a></li>
</ul>
</li>
<li><a href="#reference">Reference</a></li>
</ul>
</div>
<h2 id="about-dvc-data-version-control">About DVC (Data Version Control)</h2>
<ul>
<li>What's DVC?<ul>
<li>version control system for data science and machine learning</li>
<li>compatible with git (it's based on git)</li>
</ul>
</li>
<li>What can DVC do?<ul>
<li>track<ul>
<li>data</li>
<li>model</li>
<li>pipeline</li>
<li>metrics</li>
</ul>
</li>
<li>use storage directly</li>
<li>no external services needed</li>
</ul>
</li>
<li>Who are the targeted users of DVC?<ul>
<li>ML research / engineer</li>
<li>DevOps &amp; Engineers</li>
</ul>
</li>
<li>Why DVC?<ul>
<li>It links your data, model, and pipelines with your metrics.<ul>
<li>reproducibility</li>
<li>trackable</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Read <a href="https://dvc.org/doc/use-cases/versioning-data-and-model-files">DVC - Versioning Data and Models</a> for more use cases</p>
<h2 id="how-to-use-dvc">How to use DVC?</h2>
<h3 id="install-dvc-globally">Install DVC globally</h3>
<p>I suggest using <a href="https://pypa.github.io/pipx/">pipx</a> if you're to install DVC globally. However, an even better way is to install it inside the virtual environment within your project.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pipx
$<span class="w"> </span>pipx<span class="w"> </span>install<span class="w"> </span>dvc
$<span class="w"> </span>dvc<span class="w"> </span>--version

<span class="m">2</span>.3.0
</code></pre></div>
<p>DVC also provides <a href="https://dvc.org/doc/install/completion">Shell Completion</a> and <a href="https://dvc.org/doc/install/plugins">Syntax Highlighting Plugins</a> for popular editors.</p>
<h3 id="take-a-look-at-the-example-project">Take a look at the example project</h3>
<p>I'll use <a href="https://github.com/Lee-W/dvc_example/">dvc_example</a> to demonstrate how I applied DVC to an existing machine learning project. The example is based on <a href="https://scikit-learn.org/0.24/auto_examples/classification/plot_digits_classification.html">Recognizing hand-written digits</a> from scikit-learn documentation. All the DVC parts start from <a href="https://github.com/Lee-W/dvc_example/tree/v1-base">v1-base</a>. You can <code>git checkout</code> to the tag to follow along.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/Lee-W/dvc_example/<span class="w"> </span>--branch<span class="w"> </span>v1-base
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>dvc_example
$<span class="w"> </span>tree
.
â”œâ”€â”€<span class="w"> </span>LICENSE
â”œâ”€â”€<span class="w"> </span>Pipfile
â”œâ”€â”€<span class="w"> </span>Pipfile.lock
â”œâ”€â”€<span class="w"> </span>digit_recognizer
â”‚<span class="w">   </span>â”œâ”€â”€<span class="w"> </span>__init__.py
â”‚<span class="w">   </span>â””â”€â”€<span class="w"> </span>digit_recognizer.py
â”œâ”€â”€<span class="w"> </span>docs
â”‚<span class="w">   </span>â””â”€â”€<span class="w"> </span>README.md
â”œâ”€â”€<span class="w"> </span>mkdocs.yml
â”œâ”€â”€<span class="w"> </span>output
â””â”€â”€<span class="w"> </span>tasks.py
</code></pre></div>
<p>To set up the development environment, you'll need <a href="https://pipenv.pypa.io/en/latest/">pipenv</a> and <a href="https://www.pyinvoke.org/">invoke</a>. If you run into an error when running <code>pipenv install</code>, you can run <code>export SYSTEM_VERSION_COMPAT=1</code> before it. It's an open issue (<a href="https://github.com/pypa/pipenv/issues/4564#issuecomment-756625303">Issue with NumPy, macOS 11 Big Sur, Python 3.9.1 Does pipenv not use the latest pip? #4564</a>) of pipenv as of now. Or, you can just run the following commands.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># install needed tools</span>
pipx<span class="w"> </span>install<span class="w"> </span>pipenv<span class="w"> </span>invoke

<span class="c1"># set up environments</span>
invoke<span class="w"> </span>init-dev
</code></pre></div>
<p>We'll use <a href="https://github.com/Lee-W/dvc_example/blob/v1-base/digit_recognizer/digit_recognizer.py">digit_recognizer/digit_recognizer.py</a> for training a model that can recognize handwritten digits.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">()</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">process_data</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">train_model</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">predicted_y</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">output_results</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predicted_y</span><span class="p">)</span>
    <span class="n">output_metrics</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predicted_y</span><span class="p">)</span>
</code></pre></div>
<h3 id="install-dvc-into-the-virtual-environment">Install DVC into the virtual environment</h3>
<div class="highlight"><pre><span></span><code>pipenv<span class="w"> </span>install<span class="w"> </span>dvc
</code></pre></div>
<p>If you're to save data to remote storage, you might need to install extra dependencies.<br/>
(e.g., <code>pipenv install dvc[s3]</code>)</p>
<ul>
<li>Supported types<ul>
<li><code>[s3]</code></li>
<li><code>[azure]</code></li>
<li><code>[gdrive]</code></li>
<li><code>[gs]</code></li>
<li><code>[oss]</code></li>
<li><code>[ssh]</code></li>
</ul>
</li>
</ul>
<p>Or, use <code>pipenv install dvc[all]</code> to install them all</p>
<p>Read <a href="https://dvc.org/doc/command-reference/remote">dvc remote</a> for more information</p>
<h3 id="initialize-dvc">Initialize DVC</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># initialize DVC configurations</span>
$<span class="w"> </span>pipenv<span class="w"> </span>run<span class="w"> </span>dvc<span class="w"> </span>init

<span class="c1"># see what's created by DVC</span>
$<span class="w"> </span>tree<span class="w"> </span>.dvc

.dvc
â”œâ”€â”€<span class="w"> </span>config
â””â”€â”€<span class="w"> </span>plots
<span class="w">    </span>â”œâ”€â”€<span class="w"> </span>confusion.json
<span class="w">    </span>â”œâ”€â”€<span class="w"> </span>confusion_normalized.json
<span class="w">    </span>â”œâ”€â”€<span class="w"> </span>default.json
<span class="w">    </span>â”œâ”€â”€<span class="w"> </span>linear.json
<span class="w">    </span>â”œâ”€â”€<span class="w"> </span>scatter.json
<span class="w">    </span>â””â”€â”€<span class="w"> </span>smooth.json

<span class="c1"># track DVC configuration through git</span>
$<span class="w"> </span>git<span class="w"> </span>add<span class="w"> </span>.dvc

<span class="c1"># git commit</span>
$<span class="w"> </span>pipenv<span class="w"> </span>run<span class="w"> </span>cz<span class="w"> </span>commit
</code></pre></div>
<h3 id="add-dvc-remote">Add DVC remote</h3>
<p>I'll use another local directory <code>../dvc_remote</code> as our remote storage. You can change it to s3 or other remote storage.</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>../dvc_remote
dvc<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>--default<span class="w"> </span><span class="nb">local</span><span class="w"> </span>../dvc_remote
</code></pre></div>
<p>Through <code>--default</code> flag, we can push/pull from <code>local</code> remote without specifying remote name.</p>
<p>Let see what's changed in <code>.dvc/config</code>.</p>
<div class="highlight"><pre><span></span><code><span class="na">$ cat .dvc/config</span>

<span class="k">[core]</span>
<span class="na">remote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">local</span>
<span class="k">['remote "local"']</span>
<span class="na">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">../../dvc_remote</span>
</code></pre></div>
<p>The url is <code>../../dvc_remote</code> instead of <code>../dvc_remote</code> because it's the relative path to <code>.dvc</code>. As we've not yet push anything to our pseudo remote, <code>../dvc_remote</code> is still empty.</p>
<h3 id="track-data-through-dvc">Track data through DVC</h3>
<p>By this time, the data is loaded through <a href="https://scikit-learn.org/0.24/modules/generated/sklearn.datasets.load_digits.html">sklearn.datasets.load_digits</a>. We're going to change it to read from static file in <code>data/</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">load_data</span><span class="p">():</span>
    <span class="c1"># Load data</span>
    <span class="n">digits</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_digits</span><span class="p">()</span>
    <span class="o">...</span>
</code></pre></div>
<p>We can use the following script to output the digit data into <code>data/</code>. Note that it's a one-time use script. We won't add it into git.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>

<span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s2">"data"</span><span class="p">)</span>

<span class="n">digits</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_digits</span><span class="p">()</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">digits</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"data/digit_data.csv"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">digits</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"data/digit_target.csv"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
<p>We'll need to make changes to <code>load_data</code> and <code>main</code> functions to read data from these files.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">X_path</span><span class="p">,</span> <span class="n">y_path</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">X_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
        <span class="n">csv_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONNUMERIC</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">csv_reader</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">y_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
        <span class="n">csv_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONNUMERIC</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv_reader</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>

<span class="o">......</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="s2">"data/digit_data.csv"</span><span class="p">,</span> <span class="s2">"data/digit_target.csv"</span><span class="p">)</span>
    <span class="o">......</span>
</code></pre></div>
<p>Run <code>pipenv run python digit_recognizer/digit_recognizer.py</code> to check whether everything works as we expected. If so, add these code changes into git.</p>
<p>Next, add <code>data/</code> to DVC.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pipenv<span class="w"> </span>run<span class="w"> </span>dvc<span class="w"> </span>add<span class="w"> </span>data

<span class="m">100</span>%<span class="w"> </span>Add<span class="p">|</span>â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ<span class="p">|</span><span class="m">1</span>/1<span class="w"> </span><span class="o">[</span><span class="m">00</span>:00,<span class="w">  </span><span class="m">2</span>.14file/s<span class="o">]</span>

To<span class="w"> </span>track<span class="w"> </span>the<span class="w"> </span>changes<span class="w"> </span>with<span class="w"> </span>git,<span class="w"> </span>run:

git<span class="w"> </span>add<span class="w"> </span>data.dvc<span class="w"> </span>.gitignore
</code></pre></div>
<p><code>dvc add</code> creates a <code>data.dvc</code> file to track <code>data/</code> and add it into <code>.gitignore</code> so that <code>data/</code> will only be tracked through DVC but not git.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Add DVC files into git track</span>
git<span class="w"> </span>add<span class="w"> </span>.gitignore<span class="w"> </span>data.dvc

<span class="c1"># git commit</span>
pipenv<span class="w"> </span>run<span class="w"> </span>cz<span class="w"> </span>commit
</code></pre></div>
<p>In <code>data.dvc</code>, we can see 2 files (<code>digit_data.csv</code> and <code>digit_target.csv</code>) are tracked.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>cat<span class="w"> </span>data.dvc

outs:
-<span class="w"> </span>md5:<span class="w"> </span>b8d81f4964ecb86739c79c833fb491f3.dir
<span class="w">  </span>size:<span class="w"> </span><span class="m">494728</span>
<span class="w">  </span>nfiles:<span class="w"> </span><span class="m">2</span>
<span class="w">  </span>path:<span class="w"> </span>data
</code></pre></div>
<p>Push these tracked data into DVC remote</p>
<div class="highlight"><pre><span></span><code>dvc<span class="w"> </span>push
</code></pre></div>
<p>See what's changed in our repo storage <code>../dvc_remote</code></p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tree<span class="w"> </span>../dvc_remote

../dvc_remote
â”œâ”€â”€<span class="w"> </span><span class="m">02</span>
â”‚<span class="w">   </span>â””â”€â”€<span class="w"> </span>b861b6dc8e08da6d66547860f69277
â”œâ”€â”€<span class="w"> </span>8c
â”‚<span class="w">   </span>â””â”€â”€<span class="w"> </span>ba569595920d230ade453b150f372b
â””â”€â”€<span class="w"> </span>b8
<span class="w">    </span>â””â”€â”€<span class="w"> </span>d81f4964ecb86739c79c833fb491f3.dir

<span class="m">3</span><span class="w"> </span>directories,<span class="w"> </span><span class="m">3</span><span class="w"> </span>files
</code></pre></div>
<p>The md5 value of our tracked data is <code>b8d81f4964ecb86739c79c833fb491f3.dir</code>. There's also a corresponding file in <code>../dvc_remote/b8/d81f4964ecb86739c79c833fb491f3.dir</code>.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>cat<span class="w"> </span>../dvc_remote/b8/d81f4964ecb86739c79c833fb491f3.dir

<span class="o">[{</span><span class="s2">"md5"</span>:<span class="w"> </span><span class="s2">"02b861b6dc8e08da6d66547860f69277"</span>,<span class="w"> </span><span class="s2">"relpath"</span>:<span class="w"> </span><span class="s2">"digit_data.csv"</span><span class="o">}</span>,<span class="w"> </span><span class="o">{</span><span class="s2">"md5"</span>:<span class="w"> </span><span class="s2">"8cba569595920d230ade453b150f372b"</span>,<span class="w"> </span><span class="s2">"relpath"</span>:<span class="w"> </span><span class="s2">"digit_target.csv"</span><span class="o">}]</span>%
</code></pre></div>
<p>This file indicates where the actual data sources are stored in <code>../dvc_remote</code>.</p>
<p>In conclusion, if we want to know how data is stored through DVC,</p>
<ol>
<li>find the md5 value in <code>*.dvc</code> in our project</li>
<li>find the path that matches this md5 value in our remote storage</li>
<li>use the md5 value specified in the previous step to find the data sources in our remote storage</li>
</ol>
<p>But most of the time, we don't need to do so. We can leave the tracking work to DVC.</p>
<h3 id="fetch-data-from-dvc-remote-storage">Fetch data from DVC remote storage</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># temporary delete our data locally</span>
$<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>data

<span class="c1"># check whether DVC actually tracks our data</span>
$<span class="w"> </span>dvc<span class="w"> </span>status

data.dvc:
changed<span class="w"> </span>outs:
<span class="w">    </span>deleted:<span class="w">            </span>data

<span class="c1"># bring our data back from remote storage</span>
$<span class="w"> </span>dvc<span class="w"> </span>checkout<span class="w"> </span>data

data
â”œâ”€â”€<span class="w"> </span>digit_data.csv
â””â”€â”€<span class="w"> </span>digit_target.csv
</code></pre></div>
<h3 id="add-data-changes-into-dvc">Add data changes into DVC</h3>
<p>To demonstrate how DVC track data changes, let's remove the last 2 rows from <code>data/digit_data.csv</code> and <code>data/digit_target.csv</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># check what's changed</span>
$<span class="w"> </span>dvc<span class="w"> </span>status

data.dvc:
changed<span class="w"> </span>outs:
<span class="w">    </span>modified:<span class="w">           </span>data

<span class="c1"># Add these changes to DVC and git</span>
$<span class="w"> </span>dvc<span class="w"> </span>add
$<span class="w"> </span>git<span class="w"> </span>add<span class="w"> </span>data.dvc
<span class="c1"># git commit</span>
$<span class="w"> </span>pipenv<span class="w"> </span>run<span class="w"> </span>cz<span class="w"> </span>commit

<span class="c1"># Push these changes to our remote storage</span>
$<span class="w"> </span>dvc<span class="w"> </span>push
</code></pre></div>
<p>The md5 value has been changed, and the size of our data is smaller than our previous record, 494728.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>cat<span class="w"> </span>data.dvc

outs:
-<span class="w"> </span>md5:<span class="w"> </span>a333e114a49194e823ab9a4fa9e33ee9.dir
<span class="w">  </span>size:<span class="w"> </span><span class="m">494172</span>
<span class="w">  </span>nfiles:<span class="w"> </span><span class="m">2</span>
<span class="w">  </span>path:<span class="w"> </span>data
</code></pre></div>
<p>More files are added to <code>../dvc_remote</code> due to the data changes. You can follow the steps in the previous section to see what're actually store.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tree<span class="w"> </span>../dvc_remote

../dvc_remote
â”œâ”€â”€<span class="w"> </span><span class="m">02</span>
â”‚<span class="w">   </span>â””â”€â”€<span class="w"> </span>b861b6dc8e08da6d66547860f69277
â”œâ”€â”€<span class="w"> </span>2a
â”‚<span class="w">   </span>â””â”€â”€<span class="w"> </span>6cfa13365ac9b3af5146133aca6789
â”œâ”€â”€<span class="w"> </span>8c
â”‚<span class="w">   </span>â””â”€â”€<span class="w"> </span>ba569595920d230ade453b150f372b
â”œâ”€â”€<span class="w"> </span><span class="m">94</span>
â”‚<span class="w">   </span>â””â”€â”€<span class="w"> </span>2481fce846fb9750b7b8023c80a5ef
â”œâ”€â”€<span class="w"> </span>a3
â”‚<span class="w">   </span>â””â”€â”€<span class="w"> </span>33e114a49194e823ab9a4fa9e33ee9.dir
â””â”€â”€<span class="w"> </span>b8
<span class="w">    </span>â””â”€â”€<span class="w"> </span>d81f4964ecb86739c79c833fb491f3.dir

<span class="m">6</span><span class="w"> </span>directories,<span class="w"> </span><span class="m">6</span><span class="w"> </span>files
</code></pre></div>
<p>Let's <code>git checkout</code> to the previous git commit to see what happens if we only revert the changes in <code>data.dvc</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># or "git checkout v2-track-data"</span>
git<span class="w"> </span>checkout<span class="w"> </span>HEAD~1
</code></pre></div>
<p>After running <code>wc -l data/digit_data.csv</code>, we'll still find 1795 rows instead of 1797 rows in the previous stage. That's because we need to run <code>dvc checkout</code> as well.</p>
<p>We might easily forget this step. Thus, DVC implements a git-hook that can trigger <code>dvc checkout</code> right after <code>git checkout</code>. You can install these git-hooks through <code>dvc install</code>. These hooks are added into <code>.git/hooks</code>. If you want to know the detail of what's added, read <a href="https://dvc.org/doc/command-reference/install">dvc install</a>.</p>
<p>Test these steps again. There should be an additional line after running <code>git checkout</code>. This is the output message of <code>dvc checkout</code>.</p>
<div class="highlight"><pre><span></span><code>M       data/
</code></pre></div>
<p>Push our code to a remote git repository</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>origin<span class="w"> </span>&lt;REMOTE<span class="w"> </span>GIT<span class="w"> </span>REPO&gt;
git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>main
</code></pre></div>
<h3 id="fetch-code-and-data-changes-from-remote">Fetch code and data changes from remote</h3>
<p>We've already pushed all the code and data changes to remote. Let's see how we could reproduce in another environment.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># check what's in our repo</span>
$<span class="w"> </span>dvc<span class="w"> </span>list<span class="w"> </span>&lt;REMOTE<span class="w"> </span>GIT<span class="w"> </span>REPO&gt;

.dvcignore
.github
.gitignore
LICENSE
Pipfile
Pipfile.lock
data
data.dvc
digit_recognizer
docs
mkdocs.yml
output
tasks.py
</code></pre></div>
<p>Although git does not track <code>data/</code>, we can still list it through DVC.</p>
<p>Because we use relative path <code>../dvc_remote</code> as DVC remote storage, we need to create the new project in the same layer as <code>dvc_example</code>. We'll clone the project into <code>../dvc_example_on_another_machine</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Clone repo git repo</span>
$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>&lt;YOUR<span class="w"> </span>REMOTE<span class="w"> </span>GIT<span class="w"> </span>REPO&gt;<span class="w"> </span>../dvc_example_on_another_machine
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>../dvc_example_on_another_machine
$<span class="w"> </span>tree<span class="w"> </span>.

.
â”œâ”€â”€<span class="w"> </span>LICENSE
â”œâ”€â”€<span class="w"> </span>Pipfile
â”œâ”€â”€<span class="w"> </span>Pipfile.lock
â”œâ”€â”€<span class="w"> </span>data.dvc
â”œâ”€â”€<span class="w"> </span>digit_recognizer
â”‚<span class="w">   </span>â”œâ”€â”€<span class="w"> </span>__init__.py
â”‚<span class="w">   </span>â””â”€â”€<span class="w"> </span>digit_recognizer.py
â”œâ”€â”€<span class="w"> </span>docs
â”‚<span class="w">   </span>â””â”€â”€<span class="w"> </span>README.md
â”œâ”€â”€<span class="w"> </span>mkdocs.yml
â”œâ”€â”€<span class="w"> </span>output
â””â”€â”€<span class="w"> </span>tasks.py

<span class="m">3</span><span class="w"> </span>directories,<span class="w"> </span><span class="m">9</span><span class="w"> </span>files
</code></pre></div>
<p>As you can see, <code>data/</code> has not yet been added to the project. We can now pull data from our DVC remote storage.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># pull data from default DVC remote storage</span>
$<span class="w"> </span>dvc<span class="w"> </span>pull

A<span class="w">   </span>data/
<span class="m">1</span><span class="w"> </span>file<span class="w"> </span>added<span class="w"> </span>and<span class="w"> </span><span class="m">2</span><span class="w"> </span>files<span class="w"> </span>fetched

<span class="c1"># `data` has now been added to the project</span>
$<span class="w"> </span>tree<span class="w"> </span>.

.
â”œâ”€â”€<span class="w"> </span>LICENSE
â”œâ”€â”€<span class="w"> </span>Pipfile
â”œâ”€â”€<span class="w"> </span>Pipfile.lock
â”œâ”€â”€<span class="w"> </span>data
â”‚<span class="w">   </span>â”œâ”€â”€<span class="w"> </span>digit_data.csv
â”‚<span class="w">   </span>â””â”€â”€<span class="w"> </span>digit_target.csv
â”œâ”€â”€<span class="w"> </span>data.dvc
â”œâ”€â”€<span class="w"> </span>digit_recognizer
â”‚<span class="w">   </span>â”œâ”€â”€<span class="w"> </span>__init__.py
â”‚<span class="w">   </span>â””â”€â”€<span class="w"> </span>digit_recognizer.py
â”œâ”€â”€<span class="w"> </span>docs
â”‚<span class="w">   </span>â””â”€â”€<span class="w"> </span>README.md
â”œâ”€â”€<span class="w"> </span>mkdocs.yml
â”œâ”€â”€<span class="w"> </span>output
â””â”€â”€<span class="w"> </span>tasks.py

<span class="m">4</span><span class="w"> </span>directories,<span class="w"> </span><span class="m">11</span><span class="w"> </span>files
</code></pre></div>
<p>That's all for data versioning in DVC. In the next post, We'll continue on versioning a data pipeline, tracking parameters and metrics. We won't need <code>dvc_example_on_another_machine</code> for the following steps. Feel free to remove it and change directory back to <code>dvc_example</code>.</p>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://dvc.org/">DVC</a></li>
<li><a href="https://stanford-cs329s.github.io/syllabus.html">CS 329S: Machine Learning Systems Design</a></li>
</ul>
</section>
<section class="post-footer">
<div class="post-share">
<span class="post-info-label">Share</span>
<a aria-label="Twitter" class="twitter" href="https://twitter.com/share?text=DVC - Data Versioning &amp;url=https://blog.wei-lee.me/posts/tech/2021/06/dvc-data-versioning" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Twitter">
<i aria-hidden="true" class="icon icon-twitter"></i><span class="hidden">Twitter</span>
</a>
<a aria-label="Facebook" class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.wei-lee.me/posts/tech/2021/06/dvc-data-versioning" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Facebook">
<i aria-hidden="true" class="icon icon-facebook"></i><span class="hidden">Facebook</span>
</a>
<a aria-label="LinkedIn" class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://blog.wei-lee.me/posts/tech/2021/06/dvc-data-versioning&amp;title=DVC - Data Versioning" onclick="window.open(this.href, 'linkedin-share', 'width=930,height=720');return false;" title="LinkedIn">
<i aria-hidden="true" class="icon icon-linkedin"></i><span class="hidden">LinkedIn</span>
</a>
<a aria-label="Email" class="email" href="mailto:?subject=DVC - Data Versioning&amp;body=https://blog.wei-lee.me/posts/tech/2021/06/dvc-data-versioning" title="Email">
<i aria-hidden="true" class="icon icon-mail"></i><span class="hidden">Email</span>
</a>
<div class="clear"></div>
</div>
<aside class="post-tags">
<a href="https://blog.wei-lee.me/tag/data.html">Data</a><a href="https://blog.wei-lee.me/tag/version-control.html">Version Control</a><a href="https://blog.wei-lee.me/tag/dvc.html">DVC</a> </aside>
<div class="clear"></div>
<div class="series">
<p>This post is part 1 of the "Data Version Control Tutorial" series:</p>
<ol class="parts">
<li class="active">
<a href="https://blog.wei-lee.me/posts/tech/2021/06/dvc-data-versioning">DVC - Data Versioning</a>
</li>
<li>
<a href="https://blog.wei-lee.me/posts/tech/2021/06/dvc-pipeline-versioning">DVC - Pipeline Versioning</a>
</li>
</ol>
</div>
</section>
<script type="text/javascript">var use_utterance = true;</script>
<section class="post-comments">
<script async="" crossorigin="anonymous" data-issue-term="https://blog.wei-lee.me/posts/tech/2021/06/dvc-data-versioning" data-label="blog-comment" data-repo="Lee-W/main-blog" data-theme="github-light" src="https://utteranc.es/client.js">
</script>
</section>
<aside class="post-nav">
<div class="clear"></div>
</aside>
</div>
</article>
</main>
<div class="nav-footer">
<nav aria-label="Footer" class="nav-wrapper">
<span class="nav-copy">Those aren't written down are meant to be forgotten Â© 2023
          <a class="nav-rss" href="https://blog.wei-lee.me/feeds/all.atom.xml" target="_blank" title="RSS"><i class="icon icon-rss"></i></a>
</span>
<span class="nav-credits">



          Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a> â€¢ Theme <a href="https://github.com/arulrajnet/attila" rel="nofollow">Attila</a> â€¢
          <a class="menu-item js-theme" data-dark="Dark theme" data-light="Light theme" data-system="System theme" href="#">
<span class="theme-icon"></span><span class="theme-text">System theme</span>
</a>
</span>
</nav>
</div>
</section>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<!-- TODO: minify -->
<script src="https://blog.wei-lee.me/theme/js/jquery.fitvids.js" type="text/javascript"></script>
<script src="https://blog.wei-lee.me/theme/js/script.js" type="text/javascript"></script>
<script src="https://blog.wei-lee.me/theme/js/clipboard.min.js" type="text/javascript"></script>
<script src="https://blog.wei-lee.me/theme/js/copy-to-clipboard.js" type="text/javascript"></script>
<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3J7XQ46QH5"></script>
<script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-3J7XQ46QH5', { 'anonymize_ip': true });
    </script>
<script src="/pagefind/pagefind-ui.js"></script>
<script>
      window.addEventListener('DOMContentLoaded', (event) => {
          new PagefindUI({
              element: "#search",
              showImages: false,
          });
      });
  </script>
<!-- 	The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in article.html, but it needs to be included down here, after jQuery has already loaded. -->
<script>
  $(document).ready(function () {
    var viewport = $(window);
    var post = $('.post-content');
    // Responsive videos with fitVids
    post.fitVids();

    // Reading progress bar on window top
    function readingProgress() {
      var postBottom = post.offset().top + post.height();
      var viewportHeight = viewport.height();
      var progress = 100 - (((postBottom - (viewport.scrollTop() + viewportHeight) + viewportHeight / 3) / (postBottom - viewportHeight + viewportHeight / 3)) * 100);
      $('.progress-bar').css('width', progress + '%');
      (progress > 100) ? $('.progress-container').addClass('complete'): $('.progress-container').removeClass('complete');
    }
    readingProgress();
    // Trigger reading progress
    viewport.on({
      'scroll': function() {
        readingProgress();
      },
      'resize': function() {
        readingProgress();
      },
      'orientationchange': function() {
        readingProgress();
      }
    });

  });
</script>
</body>
</html>